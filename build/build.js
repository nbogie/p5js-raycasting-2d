"use strict";
var Particle = (function () {
    function Particle(pos) {
        this.pos = pos.copy();
    }
    Particle.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
    };
    Particle.prototype.update = function () { };
    Particle.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Particle.createRandom = function () {
        return new Particle(randomScreenPosition());
    };
    return Particle;
}());
var Ray = (function () {
    function Ray(origin, angleRads) {
        this.isRenderAsCobweb = false;
        this.isDrawGhostRay = true;
        this.isDrawRayToFirstIntersection = true;
        this.isDrawIntersections = false;
        this.origin = origin.copy();
        this.dir = p5.Vector.fromAngle(angleRads);
        this.intersectionPoints = [];
        this.recalculateFarEnd();
        this.movementPhase = random(10000);
        this.speed = 1;
    }
    Ray.prototype.setPosition = function (pos) {
        this.origin.x = pos.x;
        this.origin.y = pos.y;
        this.recalculateFarEnd();
    };
    Ray.prototype.updateDirty = function (walls) {
        this.recalculateFarEnd();
        this.recalculateIntersections(walls);
    };
    Ray.prototype.lookAt = function (targetPos) {
        var deltaToTarget = targetPos.copy().sub(this.origin);
        var angleToTarget = atan2(deltaToTarget.y, deltaToTarget.x);
        this.dir = p5.Vector.fromAngle(angleToTarget);
        this.recalculateFarEnd();
    };
    Ray.createRandom = function () {
        return new Ray(randomScreenPosition(), random(0, TWO_PI));
    };
    Ray.prototype.intersectionWithWall = function (wall) {
        var answer = collideLineLine(wall.a.x, wall.a.y, wall.b.x, wall.b.y, this.origin.x, this.origin.y, this.farEnd.x, this.farEnd.y);
        if (answer) {
            return createVector(answer.x, answer.y);
        }
    };
    Ray.prototype.nearestIntersection = function () {
        var _this = this;
        if (this.intersectionPoints.length > 0) {
            return minBy(this.intersectionPoints, function (pt) { return -_this.origin.dist(pt); });
        }
        else {
            return undefined;
        }
    };
    Ray.prototype.calculateIntersections = function (walls) {
        var res = [];
        for (var _i = 0, walls_1 = walls; _i < walls_1.length; _i++) {
            var wall = walls_1[_i];
            var intersection = this.intersectionWithWall(wall);
            if (intersection) {
                res.push(intersection);
            }
        }
        return res;
    };
    Ray.prototype.recalculateIntersections = function (walls) {
        this.intersectionPoints = this.calculateIntersections(walls);
    };
    Ray.prototype.recalculateFarEnd = function () {
        this.farEnd = this.origin.copy().add(this.dir.copy().mult(width));
    };
    Ray.prototype.updateWithRoaming = function (walls, mousePos) {
        var newPos = null;
        var offset = createVector(0, 0);
        offset.x = map(noise(this.movementPhase + 33333 + frameCount / 100), 0, 1, -1, 1);
        offset.y = map(noise(this.movementPhase + frameCount / 100), 0, 1, -1, 1);
        var attractVec = this.origin
            .copy()
            .sub(mousePosAsVector())
            .normalize();
        newPos = this.origin.copy().add(attractVec.mult(this.speed));
        newPos.add(offset);
        this.setPosition(newPos);
        this.lookAt(mousePos);
        this.updateDirty(walls);
        var newSpeed = this.speed + (this.canSeePoint(mousePosAsVector()) ? -0.1 : 0.1);
        if (Math.abs(newSpeed) < 3) {
            this.speed = newSpeed;
        }
    };
    Ray.prototype.drawLitLineSegment = function (a, b) {
        if (this.isRenderAsCobweb) {
            for (var i = 0; i < 20; i++) {
                var pt = a.copy().lerp(b, i / 10);
                square(pt.x, pt.y, 1);
            }
        }
        else {
            line(a.x, a.y, b.x, b.y);
        }
    };
    Ray.prototype.drawRayUntilFirstIntersection = function () {
        var o = this.origin;
        var end = o.copy().add(this.dir.copy().mult(40));
        if (this.isDrawGhostRay) {
            stroke(255, 255, 255, 10);
            strokeWeight(0.3);
            line(o.x, o.y, this.farEnd.x, this.farEnd.y);
        }
        var nearPt = this.nearestIntersection();
        if (this.isDrawRayToFirstIntersection) {
            if (nearPt) {
                stroke("white");
                strokeWeight(2);
                this.drawLitLineSegment(o, nearPt);
            }
        }
        if (this.isDrawIntersections) {
            for (var _i = 0, _a = this.intersectionPoints; _i < _a.length; _i++) {
                var iPt = _a[_i];
                fill("green");
                circle(iPt.x, iPt.y, 2);
            }
            var first = this.nearestIntersection();
            if (first) {
                fill("white");
                circle(first.x, first.y, 2);
            }
        }
    };
    Ray.prototype.canSeePoint = function (target) {
        var nearestIsect = this.nearestIntersection();
        var distToTarget = this.origin.dist(target);
        return nearestIsect && this.origin.dist(nearestIsect) < distToTarget;
    };
    Ray.prototype.drawAgentCanSeePlayer = function () {
        var o = this.origin;
        var end = o.copy().add(this.dir.copy().mult(40));
        noStroke();
        if (this.canSeePoint(mousePosAsVector())) {
            fill(0, 0, 0, 20);
            circle(o.x, o.y, 8);
        }
        else {
            var distToMousePointer = this.origin.dist(mousePosAsVector());
            var brightness_1 = map(distToMousePointer, 0, max(width, height), 255, 0);
            var litColor = color(255, 255, 255, brightness_1);
            fill(litColor);
            circle(o.x, o.y, 8);
        }
    };
    return Ray;
}());
var Structure = (function () {
    function Structure(center, radius, numSides) {
        var myColor = this.randomColor();
        this.movementSpeed = -random(1, 5);
        if (numSides === 2) {
            var singleWall = Wall.createRandom();
            singleWall.myColor = myColor;
            this.walls = [singleWall];
            this.center = singleWall.midPoint();
        }
        else {
            this.center = center.copy();
            var vertices = [];
            for (var i = 0; i < numSides; i++) {
                var angle = (i * TWO_PI) / numSides;
                vertices.push(p5.Vector.fromAngle(angle)
                    .mult(radius)
                    .add(this.center));
            }
            var walls = [];
            for (var i = 0; i < numSides; i++) {
                var v1 = vertices[i];
                var v2 = i === numSides - 1 ? vertices[0] : vertices[i + 1];
                var wall = new Wall(v1, v2);
                wall.myColor = myColor;
                walls.push(wall);
            }
            this.walls = walls;
        }
    }
    Structure.prototype.randomColor = function () {
        return random([
            color(250, 105, 0),
            color(105, 210, 231),
            color(167, 219, 216),
            color(243, 134, 48)
        ]);
    };
    Structure.prototype.update = function () {
        var move = this.movementSpeed;
        if (this.center.x + move < 0) {
            move += width;
        }
        this.center.x += move;
        for (var _i = 0, _a = this.walls; _i < _a.length; _i++) {
            var wall = _a[_i];
            wall.translate(createVector(move, 0));
        }
    };
    Structure.prototype.draw = function () {
        for (var _i = 0, _a = this.walls; _i < _a.length; _i++) {
            var wall = _a[_i];
            wall.draw();
        }
        beginShape();
        for (var _b = 0, _c = this.walls; _b < _c.length; _b++) {
            var wall = _c[_b];
            for (var _d = 0, _e = [wall.a, wall.b]; _d < _e.length; _d++) {
                var pt = _e[_d];
                vertex(pt.x, pt.y);
            }
        }
        endShape(CLOSE);
    };
    Structure.createRandom = function () {
        var center = randomScreenPosition();
        var numSides = random([2, 2, 2, 3, 4, 5, 8]);
        return new Structure(center, random(20, random(100, 200)), numSides);
    };
    return Structure;
}());
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function centerPos() {
    return createVector(width / 2, height / 2);
}
function collideLineLine(x1, y1, x2, y2, x3, y3, x4, y4) {
    var intersection;
    var uA = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    var uB = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {
        var intersectionX = x1 + uA * (x2 - x1);
        var intersectionY = y1 + uA * (y2 - y1);
        intersection = {
            x: intersectionX,
            y: intersectionY
        };
        return intersection;
    }
    return null;
}
function minBy(list, fn) {
    if (list.length < 0) {
        return null;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
var Wall = (function () {
    function Wall(a, b) {
        this.a = a.copy();
        this.b = b.copy();
        this.myColor = color(243, 134, 48);
    }
    Wall.prototype.draw = function () {
        stroke(this.myColor);
        strokeWeight(4);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
        noStroke();
        fill(this.myColor);
        [this.a, this.b].forEach(function (pt) {
            circle(pt.x, pt.y, 5);
        });
    };
    Wall.prototype.midPoint = function () {
        return this.a.copy().lerp(this.b, 0.5);
    };
    Wall.prototype.length = function () {
        return dist(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Wall.prototype.translate = function (offset) {
        for (var _i = 0, _a = [this.a, this.b]; _i < _a.length; _i++) {
            var pt = _a[_i];
            pt.x += offset.x;
            pt.y += offset.y;
        }
    };
    Wall.createRandom = function () {
        var p1 = randomScreenPosition();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(random(40, 400)));
        return new Wall(p1, p2);
    };
    return Wall;
}());
p5.disableFriendlyErrors = true;
var isDebugging = false;
var gWalls = [];
var gAgentRays = [];
var gPlayerRays = [];
var gPlayer = null;
var gNumWalls = 20;
var gNumAgents = 100;
var gNumPlayerRays = 100;
var gNumStructures = 30;
var gStructures = [];
function setup() {
    createCanvas(windowWidth, windowHeight);
    repeat(gNumStructures, function () {
        var structure = Structure.createRandom();
        gStructures.push(structure);
        gWalls = gWalls.concat(structure.walls);
    });
    repeat(gNumAgents, function () {
        gAgentRays.push(Ray.createRandom());
    });
    repeat(gNumPlayerRays, function (ix) {
        var angle = (ix * TWO_PI) / gNumPlayerRays;
        gPlayerRays.push(new Ray(mousePosAsVector(), angle));
    });
    gPlayer = Particle.createRandom();
    mouseX = centerPos().x;
    mouseY = centerPos().y;
}
function testCase() {
    var ray = new Ray(createVector(115, 870), createVector(-0.98, 0.18).heading());
    var wall = new Wall(createVector(37, 520), createVector(350, 440));
    ray.intersectionWithWall(wall);
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function update() {
    gPlayer.setPosition(mousePosAsVector());
    gPlayer.update();
    for (var _i = 0, gStructures_1 = gStructures; _i < gStructures_1.length; _i++) {
        var s = gStructures_1[_i];
        s.update();
    }
    for (var _a = 0, gAgentRays_1 = gAgentRays; _a < gAgentRays_1.length; _a++) {
        var ray = gAgentRays_1[_a];
        ray.updateWithRoaming(gWalls, mousePosAsVector());
    }
    for (var _b = 0, gPlayerRays_1 = gPlayerRays; _b < gPlayerRays_1.length; _b++) {
        var ray = gPlayerRays_1[_b];
        ray.setPosition(mousePosAsVector());
        ray.recalculateIntersections(gWalls);
    }
}
function draw() {
    update();
    background(0);
    fill("black");
    noStroke();
    for (var _i = 0, gStructures_2 = gStructures; _i < gStructures_2.length; _i++) {
        var s = gStructures_2[_i];
        s.draw();
    }
    for (var _a = 0, gWalls_1 = gWalls; _a < gWalls_1.length; _a++) {
        var wall = gWalls_1[_a];
        wall.draw();
    }
    for (var _b = 0, gAgentRays_2 = gAgentRays; _b < gAgentRays_2.length; _b++) {
        var ray = gAgentRays_2[_b];
        ray.drawAgentCanSeePlayer();
    }
    for (var _c = 0, gPlayerRays_2 = gPlayerRays; _c < gPlayerRays_2.length; _c++) {
        var ray = gPlayerRays_2[_c];
        ray.drawRayUntilFirstIntersection();
    }
    gPlayer.draw();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUGFydGljbGUudHMiLCJSYXkudHMiLCJTdHJ1Y3R1cmUudHMiLCJVdGlscy50cyIsIldhbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQWI7SUFHRSxrQkFBWSxHQUFjO1FBQ3hCLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFDRCx1QkFBSSxHQUFKO1FBQ0UsUUFBUSxFQUFFLENBQUM7UUFDWCxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDZCxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDZCxDQUFDO0lBQ0QseUJBQU0sR0FBTixjQUFVLENBQUM7SUFFWCw4QkFBVyxHQUFYLFVBQVksR0FBYztRQUN4QixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ25CLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDckIsQ0FBQztJQUVNLHFCQUFZLEdBQW5CO1FBQ0UsT0FBTyxJQUFJLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUNILGVBQUM7QUFBRCxDQUFDLEFBdkJELElBdUJDO0FDdkJEO0lBZ0JFLGFBQVksTUFBaUIsRUFBRSxTQUFpQjtRQWRoRCxxQkFBZ0IsR0FBRyxLQUFLLENBQUM7UUFDekIsbUJBQWMsR0FBWSxJQUFJLENBQUM7UUFDL0IsaUNBQTRCLEdBQVksSUFBSSxDQUFDO1FBQzdDLHdC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QUcsQ0FBQyxDQUFDLENBQUM7QUFDN0MsQ0FBQztBQUdELFNBQVMsZUFBZSxDQUN0QixFQUFVLEVBQ1YsRUFBVSxFQUNWLEVBQVUsRUFDVixFQUFVLEVBQ1YsRUFBVSxFQUNWLEVBQVUsRUFDVixFQUFVLEVBQ1YsRUFBVTtJQUVWLElBQUksWUFBWSxDQUFDO0lBR2pCLElBQUksRUFBRSxHQUNKLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2xELElBQUksRUFBRSxHQUNKLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBR2xELElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRTtRQUU1QyxJQUFJLGFBQWEsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQ3hDLElBQUksYUFBYSxHQUFHLEVBQUUsR0FB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QkFBcUIsRUFBRSxDQUFDO0tBQzdCO0lBQ0QsS0FBZ0IsVUFBVyxFQUFYLDJCQUFXLEVBQVgseUJBQVcsRUFBWCxJQUFXLEVBQUU7UUFBeEIsSUFBSSxHQUFHLG9CQUFBO1FBQ1YsR0FBRyxDQUFDLDZCQUE2QixFQUFFLENBQUM7S0FDckM7SUFDRCxPQUFPLENBQUMsSUFBSSxFQUFFLENBQUM7QUFDakIsQ0FBQyIsInNvdXJjZXNDb250ZW50IjpbIlwidXNlIHN0cmljdFwiO1xuXG5wNS5kaXNhYmxlRnJpZW5kbHlFcnJvcnMgPSB0cnVlO1xuY29uc3QgaXNEZWJ1Z2dpbmcgPSBmYWxzZTtcbmxldCBnV2FsbHM6IFdhbGxbXSA9IFtdO1xubGV0IGdBZ2VudFJheXM6IFJheVtdID0gW107XG5sZXQgZ1BsYXllclJheXM6IFJheVtdID0gW107XG5sZXQgZ1BsYXllcjogUGFydGljbGUgPSBudWxsO1xubGV0IGdOdW1XYWxsczogbnVtYmVyID0gMjA7XG5sZXQgZ051bUFnZW50czogbnVtYmVyID0gMTAwO1xubGV0IGdOdW1QbGF5ZXJSYXlzOiBudW1iZXIgPSAxMDA7XG5sZXQgZ051bVN0cnVjdHVyZXMgPSAzMDtcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogU0VUVVBcbiAqL1xuY29uc3QgZ1N0cnVjdHVyZXM6IFN0cnVjdHVyZVtdID0gW107XG5mdW5jdGlvbiBzZXR1cCgpIHtcbiAgY3JlYXRlQ2FudmFzKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQpO1xuXG4gIHJlcGVhdChnTnVtU3RydWN0dXJlcywgKCkgPT4ge1xuICAgIGNvbnN0IHN0cnVjdHVyZSA9IFN0cnVjdHVyZS5jcmVhdGVSYW5kb20oKTtcbiAgICBnU3RydWN0dXJlcy5wdXNoKHN0cnVjdHVyZSk7XG4gICAgZ1dhbGxzID0gZ1dhbGxzLmNvbmNhdChzdHJ1Y3R1cmUud2FsbHMpO1xuICB9KTtcblxuICByZXBlYXQoZ051bUFnZW50cywgKCkgPT4ge1xuICAgIGdBZ2VudFJheXMucHVzaChSYXkuY3JlYXRlUmFuZG9tKCkpO1xuICB9KTtcblxuICByZXBlYXQoZ051bVBsYXllclJheXMsIGl4ID0+IHtcbiAgICBjb25zdCBhbmdsZSA9IChpeCAqIFRXT19QSSkgLyBnTnVtUGxheWVyUmF5cztcbiAgICBnUGxheWVyUmF5cy5wdXNoKG5ldyBSYXkobW91c2VQb3NBc1ZlY3RvcigpLCBhbmdsZSkpO1xuICB9KTtcblxuICBnUGxheWVyID0gUGFydGljbGUuY3JlYXRlUmFuZG9tKCk7XG4gIG1vdXNlWCA9IGNlbnRlclBvcygpLng7XG4gIG1vdXNlWSA9IGNlbnRlclBvcygpLnk7XG59XG5cbmZ1bmN0aW9uIHRlc3RDYXNlKCkge1xuICBjb25zdCByYXk6IFJheSA9IG5ldyBSYXkoXG4gICAgY3JlYXRlVmVjdG9yKDExNSwgODcwKSxcbiAgICBjcmVhdGVWZWN0b3IoLTAuOTgsIDAuMTgpLmhlYWRpbmcoKVxuICApO1xuICBjb25zdCB3YWxsID0gbmV3IFdhbGwoY3JlYXRlVmVjdG9yKDM3LCA1MjApLCBjcmVhdGVWZWN0b3IoMzUwLCA0NDApKTtcbiAgcmF5LmludGVyc2VjdGlvbldpdGhXYWxsKHdhbGwpO1xufVxuXG5mdW5jdGlvbiBtb3VzZVBvc0FzVmVjdG9yKCkge1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKG1vdXNlWCwgbW91c2VZKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgZ1BsYXllci5zZXRQb3NpdGlvbihtb3VzZVBvc0FzVmVjdG9yKCkpO1xuICBnUGxheWVyLnVwZGF0ZSgpO1xuXG4gIGZvciAobGV0IHMgb2YgZ1N0cnVjdHVyZXMpIHtcbiAgICBzLnVwZGF0ZSgpO1xuICB9XG4gIGZvciAobGV0IHJheSBvZiBnQWdlbnRSYXlzKSB7XG4gICAgcmF5LnVwZGF0ZVdpdGhSb2FtaW5nKGdXYWxscywgbW91c2VQb3NBc1ZlY3RvcigpKTtcbiAgfVxuXG4gIGZvciAobGV0IHJheSBvZiBnUGxheWVyUmF5cykge1xuICAgIHJheS5zZXRQb3NpdGlvbihtb3VzZVBvc0FzVmVjdG9yKCkpO1xuICAgIHJheS5yZWNhbGN1bGF0ZUludGVyc2VjdGlvbnMoZ1dhbGxzKTtcbiAgfVxufVxuLypcbiAqIERSQVdcbiAqL1xuZnVuY3Rpb24gZHJhdygpIHtcbiAgdXBkYXRlKCk7XG4gIGJhY2tncm91bmQoMCk7XG4gIGZpbGwoXCJibGFja1wiKTtcbiAgbm9TdHJva2UoKTtcblxuICBmb3IgKGxldCBzIG9mIGdTdHJ1Y3R1cmVzKSB7XG4gICAgcy5kcmF3KCk7XG4gIH1cbiAgZm9yIChsZXQgd2FsbCBvZiBnV2FsbHMpIHtcbiAgICB3YWxsLmRyYXcoKTtcbiAgfVxuICBmb3IgKGxldCByYXkgb2YgZ0FnZW50UmF5cykge1xuICAgIHJheS5kcmF3QWdlbnRDYW5TZWVQbGF5ZXIoKTtcbiAgfVxuICBmb3IgKGxldCByYXkgb2YgZ1BsYXllclJheXMpIHtcbiAgICByYXkuZHJhd1JheVVudGlsRmlyc3RJbnRlcnNlY3Rpb24oKTtcbiAgfVxuICBnUGxheWVyLmRyYXcoKTtcbn1cbiIsImNsYXNzIFBhcnRpY2xlIHtcbiAgcG9zOiBwNS5WZWN0b3I7XG5cbiAgY29uc3RydWN0b3IocG9zOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLnBvcyA9IHBvcy5jb3B5KCk7XG4gIH1cbiAgZHJhdygpIHtcbiAgICBub1N0cm9rZSgpO1xuICAgIGZpbGwoXCJibGFja1wiKTtcbiAgICByZWN0TW9kZShDRU5URVIpO1xuICAgIHNxdWFyZSh0aGlzLnBvcy54LCB0aGlzLnBvcy55LCAzKTtcbiAgICBmaWxsKDAsIDIwKTtcbiAgfVxuICB1cGRhdGUoKSB7fVxuXG4gIHNldFBvc2l0aW9uKHBvczogcDUuVmVjdG9yKSB7XG4gICAgdGhpcy5wb3MueCA9IHBvcy54O1xuICAgIHRoaXMucG9zLnkgPSBwb3MueTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSYW5kb20oKSB7XG4gICAgcmV0dXJuIG5ldyBQYXJ0aWNsZShyYW5kb21TY3JlZW5Qb3NpdGlvbigpKTtcbiAgfVxufVxuIiwiY2xhc3MgUmF5IHtcbiAgLy9UT0RPOiBzcGxpdCB0aGlzIG91dCBpbnRvIGFuIGFnZW50IHdoaWNoIGhhcyBhbiBvcmlnaW4gYW5kIGEgcmF5LCB3aXRoIHRoZSByYXkgaGFuZGxpbmcgb25seSBoYW5kbGluZyBkZWNpZGluZyBsaW5lIG9mIHNpZ2h0IGFuZCBpbnRlcnNlY3Rpb24gcG9pbnRzLlxuICBpc1JlbmRlckFzQ29id2ViID0gZmFsc2U7XG4gIGlzRHJhd0dob3N0UmF5OiBib29sZWFuID0gdHJ1ZTtcbiAgaXNEcmF3UmF5VG9GaXJzdEludGVyc2VjdGlvbjogYm9vbGVhbiA9IHRydWU7XG4gIGlzRHJhd0ludGVyc2VjdGlvbnM6IGJvb2xlYW4gPSBmYWxzZTtcbiAgb3JpZ2luOiBwNS5WZWN0b3I7XG4gIG1vdmVtZW50UGhhc2U6IG51bWJlcjtcbiAgc3BlZWQ6IG51bWJlcjsgLy8gbW92ZSBvdXQgdG8gcGFydGljbGUgb2Ygb3JpZ2luXG5cbiAgLy9yYXkgaXMgY29uY2VwdHVhbGx5IGluZmluaXRlIGxlbmd0aCB3aXRoIG9ubHkgb25lIGVuZCwgYnV0IHRoaXMgaGFjayBpcyB1c2VmdWwgZm9yIGludGVyc2VjdGlvbiBhbmQgcmVuZGVyaW5nLlxuICBmYXJFbmQ6IHA1LlZlY3RvcjsgLy9hIGhhY2suICBvZmZzY3JlZW4gXCJmYXIgZW5kXCIuXG5cbiAgZGlyOiBwNS5WZWN0b3I7XG4gIGludGVyc2VjdGlvblBvaW50czogcDUuVmVjdG9yW107XG5cbiAgY29uc3RydWN0b3Iob3JpZ2luOiBwNS5WZWN0b3IsIGFuZ2xlUmFkczogbnVtYmVyKSB7XG4gICAgdGhpcy5vcmlnaW4gPSBvcmlnaW4uY29weSgpO1xuICAgIHRoaXMuZGlyID0gcDUuVmVjdG9yLmZyb21BbmdsZShhbmdsZVJhZHMpO1xuICAgIHRoaXMuaW50ZXJzZWN0aW9uUG9pbnRzID0gW107XG4gICAgdGhpcy5yZWNhbGN1bGF0ZUZhckVuZCgpO1xuICAgIHRoaXMubW92ZW1lbnRQaGFzZSA9IHJhbmRvbSgxMDAwMCk7XG4gICAgdGhpcy5zcGVlZCA9IDE7XG4gIH1cblxuICBzZXRQb3NpdGlvbihwb3M6IHA1LlZlY3Rvcikge1xuICAgIHRoaXMub3JpZ2luLnggPSBwb3MueDtcbiAgICB0aGlzLm9yaWdpbi55ID0gcG9zLnk7XG4gICAgdGhpcy5yZWNhbGN1bGF0ZUZhckVuZCgpO1xuICB9XG5cbiAgdXBkYXRlRGlydHkod2FsbHM6IFdhbGxbXSkge1xuICAgIHRoaXMucmVjYWxjdWxhdGVGYXJFbmQoKTtcbiAgICB0aGlzLnJlY2FsY3VsYXRlSW50ZXJzZWN0aW9ucyh3YWxscyk7XG4gIH1cbiAgbG9va0F0KHRhcmdldFBvczogcDUuVmVjdG9yKSB7XG4gICAgY29uc3QgZGVsdGFUb1RhcmdldCA9IHRhcmdldFBvcy5jb3B5KCkuc3ViKHRoaXMub3JpZ2luKTtcbiAgICAvL25vdGU6IHBhcmFtIG9yZGVyOiB5IHRoZW4geFxuICAgIGNvbnN0IGFuZ2xlVG9UYXJnZXQgPSBhdGFuMihkZWx0YVRvVGFyZ2V0LnksIGRlbHRhVG9UYXJnZXQueCk7XG4gICAgdGhpcy5kaXIgPSBwNS5WZWN0b3IuZnJvbUFuZ2xlKGFuZ2xlVG9UYXJnZXQpO1xuICAgIHRoaXMucmVjYWxjdWxhdGVGYXJFbmQoKTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSYW5kb20oKSB7XG4gICAgcmV0dXJuIG5ldyBSYXkocmFuZG9tU2NyZWVuUG9zaXRpb24oKSwgcmFuZG9tKDAsIFRXT19QSSkpO1xuICB9XG4gIGludGVyc2VjdGlvbldpdGhXYWxsKHdhbGw6IFdhbGwpOiBwNS5WZWN0b3Ige1xuICAgIGNvbnN0IGFuc3dlciA9IGNvbGxpZGVMaW5lTGluZShcbiAgICAgIHdhbGwuYS54LFxuICAgICAgd2FsbC5hLnksXG4gICAgICB3YWxsLmIueCxcbiAgICAgIHdhbGwuYi55LFxuICAgICAgdGhpcy5vcmlnaW4ueCxcbiAgICAgIHRoaXMub3JpZ2luLnksXG4gICAgICB0aGlzLmZhckVuZC54LFxuICAgICAgdGhpcy5mYXJFbmQueVxuICAgICk7XG5cbiAgICBpZiAoYW5zd2VyKSB7XG4gICAgICByZXR1cm4gY3JlYXRlVmVjdG9yKGFuc3dlci54LCBhbnN3ZXIueSk7XG4gICAgfVxuICB9XG5cbiAgbmVhcmVzdEludGVyc2VjdGlvbigpOiBwNS5WZWN0b3Ige1xuICAgIGlmICh0aGlzLmludGVyc2VjdGlvblBvaW50cy5sZW5ndGggPiAwKSB7XG4gICAgICByZXR1cm4gbWluQnkoXG4gICAgICAgIHRoaXMuaW50ZXJzZWN0aW9uUG9pbnRzLFxuICAgICAgICAocHQ6IHA1LlZlY3RvcikgPT4gLXRoaXMub3JpZ2luLmRpc3QocHQpXG4gICAgICApO1xuICAgIH0gZWxzZSB7XG4gICAgICByZXR1cm4gdW5kZWZpbmVkO1xuICAgIH1cbiAgfVxuICBjYWxjdWxhdGVJbnRlcnNlY3Rpb25zKHdhbGxzOiBXYWxsW10pOiBwNS5WZWN0b3JbXSB7XG4gICAgY29uc3QgcmVzOiBwNS5WZWN0b3JbXSA9IFtdO1xuICAgIGZvciAobGV0IHdhbGwgb2Ygd2FsbHMpIHtcbiAgICAgIGNvbnN0IGludGVyc2VjdGlvbiA9IHRoaXMuaW50ZXJzZWN0aW9uV2l0aFdhbGwod2FsbCk7XG4gICAgICBpZiAoaW50ZXJzZWN0aW9uKSB7XG4gICAgICAgIHJlcy5wdXNoKGludGVyc2VjdGlvbik7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiByZXM7XG4gIH1cbiAgcmVjYWxjdWxhdGVJbnRlcnNlY3Rpb25zKHdhbGxzOiBXYWxsW10pIHtcbiAgICB0aGlzLmludGVyc2VjdGlvblBvaW50cyA9IHRoaXMuY2FsY3VsYXRlSW50ZXJzZWN0aW9ucyh3YWxscyk7XG4gIH1cblxuICByZWNhbGN1bGF0ZUZhckVuZCgpOiB2b2lkIHtcbiAgICB0aGlzLmZhckVuZCA9IHRoaXMub3JpZ2luLmNvcHkoKS5hZGQodGhpcy5kaXIuY29weSgpLm11bHQod2lkdGgpKTtcbiAgfVxuXG4gIHVwZGF0ZVdpdGhSb2FtaW5nKHdhbGxzOiBXYWxsW10sIG1vdXNlUG9zOiBwNS5WZWN0b3IpOiB2b2lkIHtcbiAgICBsZXQgbmV3UG9zOiBwNS5WZWN0b3IgPSBudWxsO1xuXG4gICAgY29uc3Qgb2Zmc2V0ID0gY3JlYXRlVmVjdG9yKDAsIDApO1xuICAgIG9mZnNldC54ID0gbWFwKFxuICAgICAgbm9pc2UodGhpcy5tb3ZlbWVudFBoYXNlICsgMzMzMzMgKyBmcmFtZUNvdW50IC8gMTAwKSxcbiAgICAgIDAsXG4gICAgICAxLFxuICAgICAgLTEsXG4gICAgICAxXG4gICAgKTtcbiAgICBvZmZzZXQueSA9IG1hcChub2lzZSh0aGlzLm1vdmVtZW50UGhhc2UgKyBmcmFtZUNvdW50IC8gMTAwKSwgMCwgMSwgLTEsIDEpO1xuXG4gICAgY29uc3QgYXR0cmFjdFZlYyA9IHRoaXMub3JpZ2luXG4gICAgICAuY29weSgpXG4gICAgICAuc3ViKG1vdXNlUG9zQXNWZWN0b3IoKSlcbiAgICAgIC5ub3JtYWxpemUoKTtcbiAgICBuZXdQb3MgPSB0aGlzLm9yaWdpbi5jb3B5KCkuYWRkKGF0dHJhY3RWZWMubXVsdCh0aGlzLnNwZWVkKSk7XG5cbiAgICBuZXdQb3MuYWRkKG9mZnNldCk7XG5cbiAgICB0aGlzLnNldFBvc2l0aW9uKG5ld1Bvcyk7XG4gICAgdGhpcy5sb29rQXQobW91c2VQb3MpO1xuICAgIHRoaXMudXBkYXRlRGlydHkod2FsbHMpO1xuICAgIGNvbnN0IG5ld1NwZWVkID1cbiAgICAgIHRoaXMuc3BlZWQgKyAodGhpcy5jYW5TZWVQb2ludChtb3VzZVBvc0FzVmVjdG9yKCkpID8gLTAuMSA6IDAuMSk7XG4gICAgaWYgKE1hdGguYWJzKG5ld1NwZWVkKSA8IDMpIHtcbiAgICAgIHRoaXMuc3BlZWQgPSBuZXdTcGVlZDtcbiAgICB9XG4gIH1cbiAgZHJhd0xpdExpbmVTZWdtZW50KGE6IHA1LlZlY3RvciwgYjogcDUuVmVjdG9yKTogdm9pZCB7XG4gICAgaWYgKHRoaXMuaXNSZW5kZXJBc0NvYndlYikge1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCAyMDsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHB0ID0gYS5jb3B5KCkubGVycChiLCBpIC8gMTApO1xuICAgICAgICBzcXVhcmUocHQueCwgcHQueSwgMSk7XG4gICAgICB9XG4gICAgfSBlbHNlIHtcbiAgICAgIGxpbmUoYS54LCBhLnksIGIueCwgYi55KTtcbiAgICB9XG4gIH1cblxuICBkcmF3UmF5VW50aWxGaXJzdEludGVyc2VjdGlvbigpIHtcbiAgICBjb25zdCBvID0gdGhpcy5vcmlnaW47XG4gICAgY29uc3QgZW5kID0gby5jb3B5KCkuYWRkKHRoaXMuZGlyLmNvcHkoKS5tdWx0KDQwKSk7XG5cbiAgICAvL2RyYXcgdG8gZmFyIChvZmYtc2NyZWVuKSBlbmRcbiAgICBpZiAodGhpcy5pc0RyYXdHaG9zdFJheSkge1xuICAgICAgc3Ryb2tlKDI1NSwgMjU1LCAyNTUsIDEwKTtcbiAgICAgIHN0cm9rZVdlaWdodCgwLjMpO1xuICAgICAgbGluZShvLngsIG8ueSwgdGhpcy5mYXJFbmQueCwgdGhpcy5mYXJFbmQueSk7XG4gICAgfVxuICAgIGNvbnN0IG5lYXJQdCA9IHRoaXMubmVhcmVzdEludGVyc2VjdGlvbigpO1xuICAgIGlmICh0aGlzLmlzRHJhd1JheVRvRmlyc3RJbnRlcnNlY3Rpb24pIHtcbiAgICAgIGlmIChuZWFyUHQpIHtcbiAgICAgICAgc3Ryb2tlKFwid2hpdGVcIik7XG4gICAgICAgIHN0cm9rZVdlaWdodCgyKTtcbiAgICAgICAgdGhpcy5kcmF3TGl0TGluZVNlZ21lbnQobywgbmVhclB0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAodGhpcy5pc0RyYXdJbnRlcnNlY3Rpb25zKSB7XG4gICAgICBmb3IgKGxldCBpUHQgb2YgdGhpcy5pbnRlcnNlY3Rpb25Qb2ludHMpIHtcbiAgICAgICAgZmlsbChcImdyZWVuXCIpO1xuICAgICAgICBjaXJjbGUoaVB0LngsIGlQdC55LCAyKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZpcnN0ID0gdGhpcy5uZWFyZXN0SW50ZXJzZWN0aW9uKCk7XG4gICAgICBpZiAoZmlyc3QpIHtcbiAgICAgICAgZmlsbChcIndoaXRlXCIpO1xuICAgICAgICBjaXJjbGUoZmlyc3QueCwgZmlyc3QueSwgMik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGNhblNlZVBvaW50KHRhcmdldDogcDUuVmVjdG9yKSB7XG4gICAgY29uc3QgbmVhcmVzdElzZWN0OiBwNS5WZWN0b3IgPSB0aGlzLm5lYXJlc3RJbnRlcnNlY3Rpb24oKTtcbiAgICBjb25zdCBkaXN0VG9UYXJnZXQgPSB0aGlzLm9yaWdpbi5kaXN0KHRhcmdldCk7XG4gICAgcmV0dXJuIG5lYXJlc3RJc2VjdCAmJiB0aGlzLm9yaWdpbi5kaXN0KG5lYXJlc3RJc2VjdCkgPCBkaXN0VG9UYXJnZXQ7XG4gIH1cblxuICBkcmF3QWdlbnRDYW5TZWVQbGF5ZXIoKSB7XG4gICAgY29uc3QgbyA9IHRoaXMub3JpZ2luO1xuICAgIGNvbnN0IGVuZCA9IG8uY29weSgpLmFkZCh0aGlzLmRpci5jb3B5KCkubXVsdCg0MCkpO1xuXG4gICAgLy9kcmF3IHN0YXJ0IHBvaW50XG4gICAgbm9TdHJva2UoKTtcbiAgICBpZiAodGhpcy5jYW5TZWVQb2ludChtb3VzZVBvc0FzVmVjdG9yKCkpKSB7XG4gICAgICBmaWxsKDAsIDAsIDAsIDIwKTtcbiAgICAgIGNpcmNsZShvLngsIG8ueSwgOCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGRpc3RUb01vdXNlUG9pbnRlciA9IHRoaXMub3JpZ2luLmRpc3QobW91c2VQb3NBc1ZlY3RvcigpKTtcbiAgICAgIGNvbnN0IGJyaWdodG5lc3MgPSBtYXAoZGlzdFRvTW91c2VQb2ludGVyLCAwLCBtYXgod2lkdGgsIGhlaWdodCksIDI1NSwgMCk7XG4gICAgICBjb25zdCBsaXRDb2xvcjogcDUuQ29sb3IgPSBjb2xvcigyNTUsIDI1NSwgMjU1LCBicmlnaHRuZXNzKTtcbiAgICAgIGZpbGwobGl0Q29sb3IpO1xuICAgICAgY2lyY2xlKG8ueCwgby55LCA4KTtcbiAgICB9XG4gIH1cbn1cbiIsImNsYXNzIFN0cnVjdHVyZSB7XG4gIHJhbmRvbUNvbG9yKCk6IHA1LkNvbG9yIHtcbiAgICByZXR1cm4gcmFuZG9tKFtcbiAgICAgIGNvbG9yKDI1MCwgMTA1LCAwKSxcbiAgICAgIGNvbG9yKDEwNSwgMjEwLCAyMzEpLFxuICAgICAgY29sb3IoMTY3LCAyMTksIDIxNiksXG4gICAgICBjb2xvcigyNDMsIDEzNCwgNDgpXG4gICAgXSk7XG4gIH1cblxuICBjZW50ZXI6IHA1LlZlY3RvcjtcbiAgd2FsbHM6IFdhbGxbXTtcbiAgbW92ZW1lbnRTcGVlZDogbnVtYmVyO1xuICBjb25zdHJ1Y3RvcihjZW50ZXI6IHA1LlZlY3RvciwgcmFkaXVzOiBudW1iZXIsIG51bVNpZGVzOiBudW1iZXIpIHtcbiAgICBjb25zdCBteUNvbG9yID0gdGhpcy5yYW5kb21Db2xvcigpO1xuICAgIHRoaXMubW92ZW1lbnRTcGVlZCA9IC1yYW5kb20oMSwgNSk7XG4gICAgaWYgKG51bVNpZGVzID09PSAyKSB7XG4gICAgICBjb25zdCBzaW5nbGVXYWxsID0gV2FsbC5jcmVhdGVSYW5kb20oKTtcbiAgICAgIHNpbmdsZVdhbGwubXlDb2xvciA9IG15Q29sb3I7XG4gICAgICB0aGlzLndhbGxzID0gW3NpbmdsZVdhbGxdO1xuICAgICAgdGhpcy5jZW50ZXIgPSBzaW5nbGVXYWxsLm1pZFBvaW50KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2VudGVyID0gY2VudGVyLmNvcHkoKTtcblxuICAgICAgY29uc3QgdmVydGljZXMgPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU2lkZXM7IGkrKykge1xuICAgICAgICBjb25zdCBhbmdsZSA9IChpICogVFdPX1BJKSAvIG51bVNpZGVzO1xuICAgICAgICB2ZXJ0aWNlcy5wdXNoKFxuICAgICAgICAgIHA1LlZlY3Rvci5mcm9tQW5nbGUoYW5nbGUpXG4gICAgICAgICAgICAubXVsdChyYWRpdXMpXG4gICAgICAgICAgICAuYWRkKHRoaXMuY2VudGVyKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3Qgd2FsbHM6IFdhbGxbXSA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1TaWRlczsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHYxID0gdmVydGljZXNbaV07XG4gICAgICAgIGNvbnN0IHYyID0gaSA9PT0gbnVtU2lkZXMgLSAxID8gdmVydGljZXNbMF0gOiB2ZXJ0aWNlc1tpICsgMV07XG4gICAgICAgIGNvbnN0IHdhbGwgPSBuZXcgV2FsbCh2MSwgdjIpO1xuICAgICAgICB3YWxsLm15Q29sb3IgPSBteUNvbG9yO1xuICAgICAgICB3YWxscy5wdXNoKHdhbGwpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLndhbGxzID0gd2FsbHM7XG4gICAgfVxuICB9XG4gIHVwZGF0ZSgpIHtcbiAgICBsZXQgbW92ZTogbnVtYmVyID0gdGhpcy5tb3ZlbWVudFNwZWVkO1xuICAgIGlmICh0aGlzLmNlbnRlci54ICsgbW92ZSA8IDApIHtcbiAgICAgIG1vdmUgKz0gd2lkdGg7XG4gICAgfVxuXG4gICAgdGhpcy5jZW50ZXIueCArPSBtb3ZlO1xuICAgIGZvciAobGV0IHdhbGwgb2YgdGhpcy53YWxscykge1xuICAgICAgd2FsbC50cmFuc2xhdGUoY3JlYXRlVmVjdG9yKG1vdmUsIDApKTtcbiAgICB9XG4gIH1cbiAgZHJhdygpIHtcbiAgICBmb3IgKGxldCB3YWxsIG9mIHRoaXMud2FsbHMpIHtcbiAgICAgIHdhbGwuZHJhdygpO1xuICAgIH1cbiAgICBiZWdpblNoYXBlKCk7XG4gICAgZm9yIChsZXQgd2FsbCBvZiB0aGlzLndhbGxzKSB7XG4gICAgICBmb3IgKGxldCBwdCBvZiBbd2FsbC5hLCB3YWxsLmJdKSB7XG4gICAgICAgIHZlcnRleChwdC54LCBwdC55KTtcbiAgICAgIH1cbiAgICB9XG4gICAgZW5kU2hhcGUoQ0xPU0UpO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbSgpIHtcbiAgICBjb25zdCBjZW50ZXIgPSByYW5kb21TY3JlZW5Qb3NpdGlvbigpO1xuICAgIGNvbnN0IG51bVNpZGVzID0gcmFuZG9tKFsyLCAyLCAyLCAzLCA0LCA1LCA4XSk7XG4gICAgcmV0dXJuIG5ldyBTdHJ1Y3R1cmUoY2VudGVyLCByYW5kb20oMjAsIHJhbmRvbSgxMDAsIDIwMCkpLCBudW1TaWRlcyk7XG4gIH1cbn1cbiIsImZ1bmN0aW9uIHJlcGVhdChudW06IG51bWJlciwgZm46IChpeDogbnVtYmVyKSA9PiB2b2lkKSB7XG4gIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtOyBpKyspIHtcbiAgICBmbihpKTtcbiAgfVxufVxuZnVuY3Rpb24gcmFuZG9tU2NyZWVuUG9zaXRpb24oKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3RvcihyYW5kb20od2lkdGgpLCByYW5kb20oaGVpZ2h0KSk7XG59XG5cbmZ1bmN0aW9uIHJhbmRvbUludChtaW46IG51bWJlciwgbWF4OiBudW1iZXIpOiBudW1iZXIge1xuICByZXR1cm4gcm91bmQocmFuZG9tKG1pbiwgbWF4KSk7XG59XG5cbmZ1bmN0aW9uIHRyYW5zbGF0ZVRvVmVjKHBvczogcDUuVmVjdG9yKTogdm9pZCB7XG4gIHRyYW5zbGF0ZShwb3MueCwgcG9zLnkpO1xufVxuXG5mdW5jdGlvbiBjZW50ZXJQb3MoKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcih3aWR0aCAvIDIsIGhlaWdodCAvIDIpO1xufVxuXG4vL1Rha2VuIGZyb20gaHR0cHM6Ly9naXRodWIuY29tL2Jtb3Jlbi9wNS5jb2xsaWRlMkRcbmZ1bmN0aW9uIGNvbGxpZGVMaW5lTGluZShcbiAgeDE6IG51bWJlcixcbiAgeTE6IG51bWJlcixcbiAgeDI6IG51bWJlcixcbiAgeTI6IG51bWJlcixcbiAgeDM6IG51bWJlcixcbiAgeTM6IG51bWJlcixcbiAgeDQ6IG51bWJlcixcbiAgeTQ6IG51bWJlclxuKSB7XG4gIGxldCBpbnRlcnNlY3Rpb247XG5cbiAgLy8gY2FsY3VsYXRlIHRoZSBkaXN0YW5jZSB0byBpbnRlcnNlY3Rpb24gcG9pbnRcbiAgbGV0IHVBID1cbiAgICAoKHg0IC0geDMpICogKHkxIC0geTMpIC0gKHk0IC0geTMpICogKHgxIC0geDMpKSAvXG4gICAgKCh5NCAtIHkzKSAqICh4MiAtIHgxKSAtICh4NCAtIHgzKSAqICh5MiAtIHkxKSk7XG4gIGxldCB1QiA9XG4gICAgKCh4MiAtIHgxKSAqICh5MSAtIHkzKSAtICh5MiAtIHkxKSAqICh4MSAtIHgzKSkgL1xuICAgICgoeTQgLSB5MykgKiAoeDIgLSB4MSkgLSAoeDQgLSB4MykgKiAoeTIgLSB5MSkpO1xuXG4gIC8vIGlmIHVBIGFuZCB1QiBhcmUgYmV0d2VlbiAwLTEsIGxpbmVzIGFyZSBjb2xsaWRpbmdcbiAgaWYgKHVBID49IDAgJiYgdUEgPD0gMSAmJiB1QiA+PSAwICYmIHVCIDw9IDEpIHtcbiAgICAvLyBjYWxjIHRoZSBwb2ludCB3aGVyZSB0aGUgbGluZXMgbWVldFxuICAgIGxldCBpbnRlcnNlY3Rpb25YID0geDEgKyB1QSAqICh4MiAtIHgxKTtcbiAgICBsZXQgaW50ZXJzZWN0aW9uWSA9IHkxICsgdUEgKiAoeTIgLSB5MSk7XG5cbiAgICBpbnRlcnNlY3Rpb24gPSB7XG4gICAgICB4OiBpbnRlcnNlY3Rpb25YLFxuICAgICAgeTogaW50ZXJzZWN0aW9uWVxuICAgIH07XG4gICAgcmV0dXJuIGludGVyc2VjdGlvbjtcbiAgfVxuICByZXR1cm4gbnVsbDtcbn1cblxuZnVuY3Rpb24gbWluQnk8VD4obGlzdDogVFtdLCBmbjogKGl0ZW06IFQpID0+IG51bWJlcik6IFQge1xuICBpZiAobGlzdC5sZW5ndGggPCAwKSB7XG4gICAgcmV0dXJuIG51bGw7XG4gIH1cbiAgbGV0IHJlY29yZEl0ZW0gPSBsaXN0WzBdO1xuICBsZXQgcmVjb3JkV2VpZ2h0ID0gZm4obGlzdFswXSk7XG4gIGZvciAobGV0IGl0ZW0gb2YgbGlzdCkge1xuICAgIGNvbnN0IHdlaWdodCA9IGZuKGl0ZW0pO1xuICAgIGlmICh3ZWlnaHQgPiByZWNvcmRXZWlnaHQpIHtcbiAgICAgIHJlY29yZFdlaWdodCA9IHdlaWdodDtcbiAgICAgIHJlY29yZEl0ZW0gPSBpdGVtO1xuICAgIH1cbiAgfVxuICByZXR1cm4gcmVjb3JkSXRlbTtcbn1cbiIsImNsYXNzIFdhbGwge1xuICBhOiBwNS5WZWN0b3I7XG4gIGI6IHA1LlZlY3RvcjtcblxuICBteUNvbG9yOiBwNS5Db2xvcjtcblxuICBjb25zdHJ1Y3RvcihhOiBwNS5WZWN0b3IsIGI6IHA1LlZlY3Rvcikge1xuICAgIHRoaXMuYSA9IGEuY29weSgpO1xuICAgIHRoaXMuYiA9IGIuY29weSgpO1xuICAgIHRoaXMubXlDb2xvciA9IGNvbG9yKDI0MywgMTM0LCA0OCk7XG4gIH1cbiAgZHJhdygpIHtcbiAgICBzdHJva2UodGhpcy5teUNvbG9yKTtcbiAgICBzdHJva2VXZWlnaHQoNCk7XG4gICAgbGluZSh0aGlzLmEueCwgdGhpcy5hLnksIHRoaXMuYi54LCB0aGlzLmIueSk7XG5cbiAgICBub1N0cm9rZSgpO1xuICAgIGZpbGwodGhpcy5teUNvbG9yKTtcbiAgICBbdGhpcy5hLCB0aGlzLmJdLmZvckVhY2gocHQgPT4ge1xuICAgICAgY2lyY2xlKHB0LngsIHB0LnksIDUpO1xuICAgIH0pO1xuICB9XG4gIG1pZFBvaW50KCk6IHA1LlZlY3RvciB7XG4gICAgcmV0dXJuIHRoaXMuYS5jb3B5KCkubGVycCh0aGlzLmIsIDAuNSk7XG4gIH1cblxuICBsZW5ndGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gZGlzdCh0aGlzLmEueCwgdGhpcy5hLnksIHRoaXMuYi54LCB0aGlzLmIueSk7XG4gIH1cblxuICB0cmFuc2xhdGUob2Zmc2V0OiBwNS5WZWN0b3IpIHtcbiAgICBmb3IgKGxldCBwdCBvZiBbdGhpcy5hLCB0aGlzLmJdKSB7XG4gICAgICBwdC54ICs9IG9mZnNldC54O1xuICAgICAgcHQueSArPSBvZmZzZXQueTtcbiAgICB9XG4gIH1cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbSgpIHtcbiAgICBjb25zdCBwMSA9IHJhbmRvbVNjcmVlblBvc2l0aW9uKCk7XG4gICAgY29uc3QgcDIgPSBwMS5jb3B5KCkuYWRkKHA1LlZlY3Rvci5yYW5kb20yRCgpLm11bHQocmFuZG9tKDQwLCA0MDApKSk7XG4gICAgcmV0dXJuIG5ldyBXYWxsKHAxLCBwMik7XG4gIH1cbn1cbiJdfQ==