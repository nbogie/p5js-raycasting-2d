"use strict";
var Particle = (function () {
    function Particle(pos) {
        this.pos = pos.copy();
    }
    Particle.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
    };
    Particle.prototype.update = function () { };
    Particle.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Particle.createRandom = function () {
        return new Particle(randomScreenPosition());
    };
    return Particle;
}());
var Ray = (function () {
    function Ray(origin, angleRads) {
        this.isDrawGhostRay = true;
        this.isDrawRayToFirstIntersection = true;
        this.isDrawIntersections = true;
        this.origin = origin.copy();
        this.dir = p5.Vector.fromAngle(angleRads);
        this.intersectionPoints = [];
        this.updateFarEnd();
        this.movementPhase = random(10000);
    }
    Ray.prototype.setPosition = function (pos) {
        this.origin.x = pos.x;
        this.origin.y = pos.y;
        this.updateFarEnd();
    };
    Ray.prototype.updateDirty = function (walls) {
        this.updateFarEnd();
        this.updateIntersections(walls);
    };
    Ray.prototype.lookAt = function (targetPos) {
        var deltaToTarget = targetPos.copy().sub(this.origin);
        var angleToTarget = atan2(deltaToTarget.y, deltaToTarget.x);
        this.dir = p5.Vector.fromAngle(angleToTarget);
        this.updateFarEnd();
    };
    Ray.createRandom = function () {
        return new Ray(randomScreenPosition(), random(0, TWO_PI));
    };
    Ray.prototype.intersectionWithWall = function (wall) {
        var answer = collideLineLine(wall.a.x, wall.a.y, wall.b.x, wall.b.y, this.origin.x, this.origin.y, this.farEnd.x, this.farEnd.y);
        if (answer) {
            return createVector(answer.x, answer.y);
        }
    };
    Ray.prototype.nearestIntersection = function () {
        var _this = this;
        if (this.intersectionPoints.length > 0) {
            return minBy(this.intersectionPoints, function (pt) { return -_this.origin.dist(pt); });
        }
        else {
            return undefined;
        }
    };
    Ray.prototype.calculateIntersections = function (walls) {
        var res = [];
        for (var _i = 0, walls_1 = walls; _i < walls_1.length; _i++) {
            var wall = walls_1[_i];
            var intersection = this.intersectionWithWall(wall);
            if (intersection) {
                res.push(intersection);
            }
        }
        return res;
    };
    Ray.prototype.updateIntersections = function (walls) {
        this.intersectionPoints = this.calculateIntersections(walls);
    };
    Ray.prototype.updateFarEnd = function () {
        this.farEnd = this.origin.copy().add(this.dir.copy().mult(width));
    };
    Ray.prototype.updateWithRoaming = function (walls, mousePos) {
        var offset = createVector(0, 0);
        offset.x = map(noise(this.movementPhase + 33333 + frameCount / 100), 0, 1, -1, 1);
        offset.y = map(noise(this.movementPhase + frameCount / 100), 0, 1, -1, 1);
        var newPos = this.origin.copy().add(offset);
        this.setPosition(newPos);
        this.lookAt(mousePos);
        this.updateDirty(walls);
    };
    Ray.prototype.drawRayUntilFirstIntersection = function () {
        var o = this.origin;
        var end = o.copy().add(this.dir.copy().mult(40));
        if (this.isDrawGhostRay) {
            stroke(255, 255, 255, 10);
            strokeWeight(0.3);
            line(o.x, o.y, this.farEnd.x, this.farEnd.y);
        }
        var nearPt = this.nearestIntersection();
        if (this.isDrawRayToFirstIntersection) {
            if (nearPt) {
                stroke("white");
                strokeWeight(2);
                line(o.x, o.y, nearPt.x, nearPt.y);
            }
        }
        if (this.isDrawIntersections) {
            for (var _i = 0, _a = this.intersectionPoints; _i < _a.length; _i++) {
                var iPt = _a[_i];
                fill("red");
                circle(iPt.x, iPt.y, 2);
            }
        }
    };
    Ray.prototype.drawAgentCanSeePlayer = function () {
        var o = this.origin;
        var end = o.copy().add(this.dir.copy().mult(40));
        var nearPt = this.nearestIntersection();
        noStroke();
        var distToMousePointer = this.origin.dist(mousePosAsVector());
        if (nearPt && this.origin.dist(nearPt) < distToMousePointer) {
            fill(0, 0, 0, 20);
            circle(o.x, o.y, 8);
        }
        else {
            var brightness_1 = map(distToMousePointer, 0, max(width, height), 255, 0);
            var litColor = color(255, 255, 255, brightness_1);
            fill(litColor);
            circle(o.x, o.y, 8);
        }
    };
    return Ray;
}());
var Structure = (function () {
    function Structure(center, radius, numSides) {
        this.center = center.copy();
        var vertices = [];
        for (var i = 0; i < numSides; i++) {
            var angle = (i * TWO_PI) / numSides;
            vertices.push(p5.Vector.fromAngle(angle)
                .mult(radius)
                .add(this.center));
        }
        var walls = [];
        for (var i = 0; i < numSides; i++) {
            var v1 = vertices[i];
            var v2 = i === numSides - 1 ? vertices[0] : vertices[i + 1];
            walls.push(new Wall(v1, v2));
        }
        this.walls = walls;
    }
    Structure.prototype.draw = function () {
        for (var _i = 0, _a = this.walls; _i < _a.length; _i++) {
            var wall = _a[_i];
            wall.draw();
        }
    };
    Structure.createRandom = function () {
        var center = randomScreenPosition();
        return new Structure(center, random(20, 200), random([3, 4, 5, 8]));
    };
    return Structure;
}());
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function centerPos() {
    return createVector(width / 2, height / 2);
}
function collideLineLine(x1, y1, x2, y2, x3, y3, x4, y4) {
    var intersection;
    var uA = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    var uB = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {
        var intersectionX = x1 + uA * (x2 - x1);
        var intersectionY = y1 + uA * (y2 - y1);
        intersection = {
            x: intersectionX,
            y: intersectionY
        };
        return intersection;
    }
    return null;
}
function minBy(list, fn) {
    if (list.length < 0) {
        return null;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
var Wall = (function () {
    function Wall(a, b) {
        this.a = a.copy();
        this.b = b.copy();
    }
    Wall.prototype.draw = function () {
        stroke(243, 134, 48);
        strokeWeight(4);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
        noStroke();
        fill("white");
        [this.a, this.b].forEach(function (pt) {
            circle(pt.x, pt.y, 3);
        });
    };
    Wall.prototype.length = function () {
        return dist(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Wall.createRandom = function () {
        var p1 = randomScreenPosition();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(random(40, 400)));
        return new Wall(p1, p2);
    };
    return Wall;
}());
var isDebugging = false;
var gWalls = [];
var gAgentRays = [];
var gPlayerRays = [];
var gPlayer = null;
var gNumWalls = 20;
var gNumAgents = 100;
var gNumPlayerRays = 100;
var gNumStructures = 7;
var gStructures = [];
function setup() {
    createCanvas(windowWidth, windowHeight);
    repeat(gNumStructures, function () {
        var structure = Structure.createRandom();
        gStructures.push(structure);
        gWalls = gWalls.concat(structure.walls);
    });
    repeat(gNumWalls, function () {
        gWalls.push(Wall.createRandom());
    });
    repeat(gNumAgents, function () {
        gAgentRays.push(Ray.createRandom());
    });
    repeat(gNumPlayerRays, function (ix) {
        var angle = (ix * TWO_PI) / gNumPlayerRays;
        gPlayerRays.push(new Ray(mousePosAsVector(), angle));
    });
    gPlayer = Particle.createRandom();
}
function testCase() {
    var ray = new Ray(createVector(115, 870), createVector(-0.98, 0.18).heading());
    var wall = new Wall(createVector(37, 520), createVector(350, 440));
    ray.intersectionWithWall(wall);
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function update() {
    gPlayer.setPosition(mousePosAsVector());
    gPlayer.update();
    for (var _i = 0, gAgentRays_1 = gAgentRays; _i < gAgentRays_1.length; _i++) {
        var ray = gAgentRays_1[_i];
        ray.updateWithRoaming(gWalls, mousePosAsVector());
    }
    for (var _a = 0, gPlayerRays_1 = gPlayerRays; _a < gPlayerRays_1.length; _a++) {
        var ray = gPlayerRays_1[_a];
        ray.setPosition(mousePosAsVector());
        ray.updateIntersections(gWalls);
    }
}
function draw() {
    update();
    background(0);
    fill("black");
    noStroke();
    for (var _i = 0, gWalls_1 = gWalls; _i < gWalls_1.length; _i++) {
        var wall = gWalls_1[_i];
        wall.draw();
    }
    for (var _a = 0, gAgentRays_2 = gAgentRays; _a < gAgentRays_2.length; _a++) {
        var ray = gAgentRays_2[_a];
        ray.drawAgentCanSeePlayer();
    }
    for (var _b = 0, gPlayerRays_2 = gPlayerRays; _b < gPlayerRays_2.length; _b++) {
        var ray = gPlayerRays_2[_b];
        ray.drawRayUntilFirstIntersection();
    }
    gPlayer.draw();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiUGFydGljbGUudHMiLCJSYXkudHMiLCJTdHJ1Y3R1cmUudHMiLCJVdGlscy50cyIsIldhbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQWI7SUFHRSxrQkFBWSxHQUFjO1FBQ3hCLElBQUksQ0FBQyxHQUFHLEdBQUcsR0FBRyxDQUFDLElBQUksRUFBRSxDQUFDO0lBQ3hCLENBQUM7SUFDRCx1QkFBSSxHQUFKO1FBQ0UsUUFBUSxFQUFFLENBQUM7UUFDWCxJQUFJLENBQUMsT0FBTyxDQUFDLENBQUM7UUFDZCxRQUFRLENBQUMsTUFBTSxDQUFDLENBQUM7UUFDakIsTUFBTSxDQUFDLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxFQUFFLENBQUMsQ0FBQyxDQUFDO1FBQ2xDLElBQUksQ0FBQyxDQUFDLEVBQUUsRUFBRSxDQUFDLENBQUM7SUFDZCxDQUFDO0lBQ0QseUJBQU0sR0FBTixjQUFVLENBQUM7SUFFWCw4QkFBVyxHQUFYLFVBQVksR0FBYztRQUN4QixJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsR0FBRyxHQUFHLENBQUMsQ0FBQyxDQUFDO1FBQ25CLElBQUksQ0FBQyxHQUFHLENBQUMsQ0FBQyxHQUFHLEdBQUcsQ0FBQyxDQUFDLENBQUM7SUFDckIsQ0FBQztJQUVNLHFCQUFZLEdBQW5CO1FBQ0UsT0FBTyxJQUFJLFFBQVEsQ0FBQyxvQkFBb0IsRUFBRSxDQUFDLENBQUM7SUFDOUMsQ0FBQztJQUNILGVBQUM7QUFBRCxDQUFDLEFBdkJELElBdUJDO0FDdkJEO0lBYUUsYUFBWSxNQUFpQixFQUFFLFNBQWlCO1FBWmhELG1CQUFjLEdBQVksSUFBSSxDQUFDO1FBQy9CLGlDQUE0QixHQUFZLElBQUksQ0FBQztRQUM3Qyx3QkFBbUIsR0FBWSxJQUFJLENBQUM7UUFXbEMsSUFB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LEtBQUssR0FBRyxDQUFDLEVBQUUsTUFBTSxHQUFHLENBQUMsQ0FBQyxDQUFDO0FBQzdDLENBQUM7QUFHRCxTQUFTLGVBQWUsQ0FDdEIsRUFBVSxFQUNWLEVBQVUsRUFDVixFQUFVLEVBQ1YsRUFBVSxFQUNWLEVBQVUsRUFDVixFQUFVLEVBQ1YsRUFBVSxFQUNWLEVBQVU7SUFFVixJQUFJLFlBQVksQ0FBQztJQUdqQixJQUFJLEVBQUUsR0FDSixDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUNsRCxJQUFJLEVBQUUsR0FDSixDQUFDLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFDO1FBQy9DLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUMsQ0FBQztJQUdsRCxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLEVBQUU7UUFFNUMsSUFBSSxhQUFhLEdBQUcsRUFBRSxHQUFHLEVBQUUsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQztR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O0lBQ2QsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO0lBQ2QsUUFBUSxFQUFFLENBQUM7SUFFWCxLQUFpQixVQUFNLEVBQU4saUJBQU0sRUFBTixvQkFBTSxFQUFOLElBQU0sRUFBRTtRQUFwQixJQUFJLElBQUksZUFBQTtRQUNYLElBQUksQ0FBQyxJQUFJLEVBQUUsQ0FBQztLQUNiO0lBQ0QsS0FBZ0IsVUFBVSxFQUFWLHlCQUFVLEVBQVYsd0JBQVUsRUFBVixJQUFVLEVBQUU7UUFBdkIsSUFBSSxHQUFHLG1CQUFBO1FBQ1YsR0FBRyxDQUFDLHFCQUFxQixFQUFFLENBQUM7S0FDN0I7SUFDRCxLQUFnQixVQUFXLEVBQVgsMkJBQVcsRUFBWCx5QkFBVyxFQUFYLElBQVcsRUFBRTtRQUF4QixJQUFJLEdBQUcsb0JBQUE7UUFDVixHQUFHLENBQUMsNkJBQTZCLEVBQUUsQ0FBQztLQUNyQztJQUNELE9BQU8sQ0FBQyxJQUFJLEVBQUUsQ0FBQztBQUNqQixDQUFDIiwic291cmNlc0NvbnRlbnQiOlsiXCJ1c2Ugc3RyaWN0XCI7XG5cbi8vcDUuZGlzYWJsZUZyaWVuZGx5RXJyb3JzID0gdHJ1ZTtcbmNvbnN0IGlzRGVidWdnaW5nID0gZmFsc2U7XG5sZXQgZ1dhbGxzOiBXYWxsW10gPSBbXTtcbmxldCBnQWdlbnRSYXlzOiBSYXlbXSA9IFtdO1xubGV0IGdQbGF5ZXJSYXlzOiBSYXlbXSA9IFtdO1xubGV0IGdQbGF5ZXI6IFBhcnRpY2xlID0gbnVsbDtcbmxldCBnTnVtV2FsbHM6IG51bWJlciA9IDIwO1xubGV0IGdOdW1BZ2VudHM6IG51bWJlciA9IDEwMDtcbmxldCBnTnVtUGxheWVyUmF5czogbnVtYmVyID0gMTAwO1xubGV0IGdOdW1TdHJ1Y3R1cmVzID0gNztcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogU0VUVVBcbiAqL1xuY29uc3QgZ1N0cnVjdHVyZXM6IFN0cnVjdHVyZVtdID0gW107XG5mdW5jdGlvbiBzZXR1cCgpIHtcbiAgY3JlYXRlQ2FudmFzKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQpO1xuXG4gIHJlcGVhdChnTnVtU3RydWN0dXJlcywgKCkgPT4ge1xuICAgIGNvbnN0IHN0cnVjdHVyZSA9IFN0cnVjdHVyZS5jcmVhdGVSYW5kb20oKTtcbiAgICBnU3RydWN0dXJlcy5wdXNoKHN0cnVjdHVyZSk7XG4gICAgZ1dhbGxzID0gZ1dhbGxzLmNvbmNhdChzdHJ1Y3R1cmUud2FsbHMpO1xuICB9KTtcblxuICByZXBlYXQoZ051bVdhbGxzLCAoKSA9PiB7XG4gICAgZ1dhbGxzLnB1c2goV2FsbC5jcmVhdGVSYW5kb20oKSk7XG4gIH0pO1xuICByZXBlYXQoZ051bUFnZW50cywgKCkgPT4ge1xuICAgIGdBZ2VudFJheXMucHVzaChSYXkuY3JlYXRlUmFuZG9tKCkpO1xuICB9KTtcblxuICByZXBlYXQoZ051bVBsYXllclJheXMsIGl4ID0+IHtcbiAgICBjb25zdCBhbmdsZSA9IChpeCAqIFRXT19QSSkgLyBnTnVtUGxheWVyUmF5cztcbiAgICBnUGxheWVyUmF5cy5wdXNoKG5ldyBSYXkobW91c2VQb3NBc1ZlY3RvcigpLCBhbmdsZSkpO1xuICB9KTtcblxuICBnUGxheWVyID0gUGFydGljbGUuY3JlYXRlUmFuZG9tKCk7XG59XG5cbmZ1bmN0aW9uIHRlc3RDYXNlKCkge1xuICBjb25zdCByYXk6IFJheSA9IG5ldyBSYXkoXG4gICAgY3JlYXRlVmVjdG9yKDExNSwgODcwKSxcbiAgICBjcmVhdGVWZWN0b3IoLTAuOTgsIDAuMTgpLmhlYWRpbmcoKVxuICApO1xuICBjb25zdCB3YWxsID0gbmV3IFdhbGwoY3JlYXRlVmVjdG9yKDM3LCA1MjApLCBjcmVhdGVWZWN0b3IoMzUwLCA0NDApKTtcbiAgcmF5LmludGVyc2VjdGlvbldpdGhXYWxsKHdhbGwpO1xufVxuXG5mdW5jdGlvbiBtb3VzZVBvc0FzVmVjdG9yKCkge1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKG1vdXNlWCwgbW91c2VZKTtcbn1cbmZ1bmN0aW9uIHVwZGF0ZSgpIHtcbiAgZ1BsYXllci5zZXRQb3NpdGlvbihtb3VzZVBvc0FzVmVjdG9yKCkpO1xuICBnUGxheWVyLnVwZGF0ZSgpO1xuXG4gIGZvciAobGV0IHJheSBvZiBnQWdlbnRSYXlzKSB7XG4gICAgcmF5LnVwZGF0ZVdpdGhSb2FtaW5nKGdXYWxscywgbW91c2VQb3NBc1ZlY3RvcigpKTtcbiAgfVxuXG4gIGZvciAobGV0IHJheSBvZiBnUGxheWVyUmF5cykge1xuICAgIHJheS5zZXRQb3NpdGlvbihtb3VzZVBvc0FzVmVjdG9yKCkpO1xuICAgIHJheS51cGRhdGVJbnRlcnNlY3Rpb25zKGdXYWxscyk7XG4gIH1cbn1cbi8qXG4gKiBEUkFXXG4gKi9cbmZ1bmN0aW9uIGRyYXcoKSB7XG4gIHVwZGF0ZSgpO1xuICBiYWNrZ3JvdW5kKDApO1xuICBmaWxsKFwiYmxhY2tcIik7XG4gIG5vU3Ryb2tlKCk7XG5cbiAgZm9yIChsZXQgd2FsbCBvZiBnV2FsbHMpIHtcbiAgICB3YWxsLmRyYXcoKTtcbiAgfVxuICBmb3IgKGxldCByYXkgb2YgZ0FnZW50UmF5cykge1xuICAgIHJheS5kcmF3QWdlbnRDYW5TZWVQbGF5ZXIoKTtcbiAgfVxuICBmb3IgKGxldCByYXkgb2YgZ1BsYXllclJheXMpIHtcbiAgICByYXkuZHJhd1JheVVudGlsRmlyc3RJbnRlcnNlY3Rpb24oKTtcbiAgfVxuICBnUGxheWVyLmRyYXcoKTtcbn1cbiIsImNsYXNzIFBhcnRpY2xlIHtcbiAgcG9zOiBwNS5WZWN0b3I7XG5cbiAgY29uc3RydWN0b3IocG9zOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLnBvcyA9IHBvcy5jb3B5KCk7XG4gIH1cbiAgZHJhdygpIHtcbiAgICBub1N0cm9rZSgpO1xuICAgIGZpbGwoXCJibGFja1wiKTtcbiAgICByZWN0TW9kZShDRU5URVIpO1xuICAgIHNxdWFyZSh0aGlzLnBvcy54LCB0aGlzLnBvcy55LCAzKTtcbiAgICBmaWxsKDAsIDIwKTtcbiAgfVxuICB1cGRhdGUoKSB7fVxuXG4gIHNldFBvc2l0aW9uKHBvczogcDUuVmVjdG9yKSB7XG4gICAgdGhpcy5wb3MueCA9IHBvcy54O1xuICAgIHRoaXMucG9zLnkgPSBwb3MueTtcbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSYW5kb20oKSB7XG4gICAgcmV0dXJuIG5ldyBQYXJ0aWNsZShyYW5kb21TY3JlZW5Qb3NpdGlvbigpKTtcbiAgfVxufVxuIiwiY2xhc3MgUmF5IHtcbiAgaXNEcmF3R2hvc3RSYXk6IGJvb2xlYW4gPSB0cnVlO1xuICBpc0RyYXdSYXlUb0ZpcnN0SW50ZXJzZWN0aW9uOiBib29sZWFuID0gdHJ1ZTtcbiAgaXNEcmF3SW50ZXJzZWN0aW9uczogYm9vbGVhbiA9IHRydWU7XG4gIG9yaWdpbjogcDUuVmVjdG9yO1xuICBtb3ZlbWVudFBoYXNlOiBudW1iZXI7XG5cbiAgLy9yYXkgaXMgY29uY2VwdHVhbGx5IGluZmluaXRlIGxlbmd0aCB3aXRoIG9ubHkgb25lIGVuZCwgYnV0IHRoaXMgaGFjayBpcyB1c2VmdWwgZm9yIGludGVyc2VjdGlvbiBhbmQgcmVuZGVyaW5nLlxuICBmYXJFbmQ6IHA1LlZlY3RvcjsgLy9hIGhhY2suICBvZmZzY3JlZW4gXCJmYXIgZW5kXCIuXG5cbiAgZGlyOiBwNS5WZWN0b3I7XG4gIGludGVyc2VjdGlvblBvaW50czogcDUuVmVjdG9yW107XG5cbiAgY29uc3RydWN0b3Iob3JpZ2luOiBwNS5WZWN0b3IsIGFuZ2xlUmFkczogbnVtYmVyKSB7XG4gICAgdGhpcy5vcmlnaW4gPSBvcmlnaW4uY29weSgpO1xuICAgIHRoaXMuZGlyID0gcDUuVmVjdG9yLmZyb21BbmdsZShhbmdsZVJhZHMpO1xuICAgIHRoaXMuaW50ZXJzZWN0aW9uUG9pbnRzID0gW107XG4gICAgdGhpcy51cGRhdGVGYXJFbmQoKTtcbiAgICB0aGlzLm1vdmVtZW50UGhhc2UgPSByYW5kb20oMTAwMDApO1xuICB9XG5cbiAgc2V0UG9zaXRpb24ocG9zOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLm9yaWdpbi54ID0gcG9zLng7XG4gICAgdGhpcy5vcmlnaW4ueSA9IHBvcy55O1xuICAgIHRoaXMudXBkYXRlRmFyRW5kKCk7XG4gIH1cblxuICB1cGRhdGVEaXJ0eSh3YWxsczogV2FsbFtdKSB7XG4gICAgdGhpcy51cGRhdGVGYXJFbmQoKTtcbiAgICB0aGlzLnVwZGF0ZUludGVyc2VjdGlvbnMod2FsbHMpO1xuICB9XG4gIGxvb2tBdCh0YXJnZXRQb3M6IHA1LlZlY3Rvcikge1xuICAgIGNvbnN0IGRlbHRhVG9UYXJnZXQgPSB0YXJnZXRQb3MuY29weSgpLnN1Yih0aGlzLm9yaWdpbik7XG4gICAgLy9ub3RlOiBwYXJhbSBvcmRlcjogeSB0aGVuIHhcbiAgICBjb25zdCBhbmdsZVRvVGFyZ2V0ID0gYXRhbjIoZGVsdGFUb1RhcmdldC55LCBkZWx0YVRvVGFyZ2V0LngpO1xuICAgIHRoaXMuZGlyID0gcDUuVmVjdG9yLmZyb21BbmdsZShhbmdsZVRvVGFyZ2V0KTtcbiAgICB0aGlzLnVwZGF0ZUZhckVuZCgpO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbSgpIHtcbiAgICByZXR1cm4gbmV3IFJheShyYW5kb21TY3JlZW5Qb3NpdGlvbigpLCByYW5kb20oMCwgVFdPX1BJKSk7XG4gIH1cbiAgaW50ZXJzZWN0aW9uV2l0aFdhbGwod2FsbDogV2FsbCk6IHA1LlZlY3RvciB7XG4gICAgY29uc3QgYW5zd2VyID0gY29sbGlkZUxpbmVMaW5lKFxuICAgICAgd2FsbC5hLngsXG4gICAgICB3YWxsLmEueSxcbiAgICAgIHdhbGwuYi54LFxuICAgICAgd2FsbC5iLnksXG4gICAgICB0aGlzLm9yaWdpbi54LFxuICAgICAgdGhpcy5vcmlnaW4ueSxcbiAgICAgIHRoaXMuZmFyRW5kLngsXG4gICAgICB0aGlzLmZhckVuZC55XG4gICAgKTtcblxuICAgIGlmIChhbnN3ZXIpIHtcbiAgICAgIHJldHVybiBjcmVhdGVWZWN0b3IoYW5zd2VyLngsIGFuc3dlci55KTtcbiAgICB9XG4gIH1cblxuICBuZWFyZXN0SW50ZXJzZWN0aW9uKCk6IHA1LlZlY3RvciB7XG4gICAgaWYgKHRoaXMuaW50ZXJzZWN0aW9uUG9pbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBtaW5CeShcbiAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25Qb2ludHMsXG4gICAgICAgIChwdDogcDUuVmVjdG9yKSA9PiAtdGhpcy5vcmlnaW4uZGlzdChwdClcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG4gIGNhbGN1bGF0ZUludGVyc2VjdGlvbnMod2FsbHM6IFdhbGxbXSk6IHA1LlZlY3RvcltdIHtcbiAgICBjb25zdCByZXM6IHA1LlZlY3RvcltdID0gW107XG4gICAgZm9yIChsZXQgd2FsbCBvZiB3YWxscykge1xuICAgICAgY29uc3QgaW50ZXJzZWN0aW9uID0gdGhpcy5pbnRlcnNlY3Rpb25XaXRoV2FsbCh3YWxsKTtcbiAgICAgIGlmIChpbnRlcnNlY3Rpb24pIHtcbiAgICAgICAgcmVzLnB1c2goaW50ZXJzZWN0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuICB1cGRhdGVJbnRlcnNlY3Rpb25zKHdhbGxzOiBXYWxsW10pIHtcbiAgICB0aGlzLmludGVyc2VjdGlvblBvaW50cyA9IHRoaXMuY2FsY3VsYXRlSW50ZXJzZWN0aW9ucyh3YWxscyk7XG4gIH1cblxuICB1cGRhdGVGYXJFbmQoKTogdm9pZCB7XG4gICAgdGhpcy5mYXJFbmQgPSB0aGlzLm9yaWdpbi5jb3B5KCkuYWRkKHRoaXMuZGlyLmNvcHkoKS5tdWx0KHdpZHRoKSk7XG4gIH1cblxuICB1cGRhdGVXaXRoUm9hbWluZyh3YWxsczogV2FsbFtdLCBtb3VzZVBvczogcDUuVmVjdG9yKTogdm9pZCB7XG4gICAgY29uc3Qgb2Zmc2V0ID0gY3JlYXRlVmVjdG9yKDAsIDApO1xuICAgIG9mZnNldC54ID0gbWFwKFxuICAgICAgbm9pc2UodGhpcy5tb3ZlbWVudFBoYXNlICsgMzMzMzMgKyBmcmFtZUNvdW50IC8gMTAwKSxcbiAgICAgIDAsXG4gICAgICAxLFxuICAgICAgLTEsXG4gICAgICAxXG4gICAgKTtcbiAgICBvZmZzZXQueSA9IG1hcChub2lzZSh0aGlzLm1vdmVtZW50UGhhc2UgKyBmcmFtZUNvdW50IC8gMTAwKSwgMCwgMSwgLTEsIDEpO1xuICAgIGNvbnN0IG5ld1BvcyA9IHRoaXMub3JpZ2luLmNvcHkoKS5hZGQob2Zmc2V0KTtcbiAgICB0aGlzLnNldFBvc2l0aW9uKG5ld1Bvcyk7XG4gICAgdGhpcy5sb29rQXQobW91c2VQb3MpO1xuICAgIHRoaXMudXBkYXRlRGlydHkod2FsbHMpO1xuICB9XG5cbiAgZHJhd1JheVVudGlsRmlyc3RJbnRlcnNlY3Rpb24oKSB7XG4gICAgY29uc3QgbyA9IHRoaXMub3JpZ2luO1xuICAgIGNvbnN0IGVuZCA9IG8uY29weSgpLmFkZCh0aGlzLmRpci5jb3B5KCkubXVsdCg0MCkpO1xuXG4gICAgLy9kcmF3IHRvIGZhciAob2ZmLXNjcmVlbikgZW5kXG4gICAgaWYgKHRoaXMuaXNEcmF3R2hvc3RSYXkpIHtcbiAgICAgIHN0cm9rZSgyNTUsIDI1NSwgMjU1LCAxMCk7XG4gICAgICBzdHJva2VXZWlnaHQoMC4zKTtcbiAgICAgIGxpbmUoby54LCBvLnksIHRoaXMuZmFyRW5kLngsIHRoaXMuZmFyRW5kLnkpO1xuICAgIH1cbiAgICBjb25zdCBuZWFyUHQgPSB0aGlzLm5lYXJlc3RJbnRlcnNlY3Rpb24oKTtcbiAgICBpZiAodGhpcy5pc0RyYXdSYXlUb0ZpcnN0SW50ZXJzZWN0aW9uKSB7XG4gICAgICBpZiAobmVhclB0KSB7XG4gICAgICAgIHN0cm9rZShcIndoaXRlXCIpO1xuICAgICAgICBzdHJva2VXZWlnaHQoMik7XG4gICAgICAgIGxpbmUoby54LCBvLnksIG5lYXJQdC54LCBuZWFyUHQueSk7XG4gICAgICB9XG4gICAgfVxuXG4gICAgaWYgKHRoaXMuaXNEcmF3SW50ZXJzZWN0aW9ucykge1xuICAgICAgZm9yIChsZXQgaVB0IG9mIHRoaXMuaW50ZXJzZWN0aW9uUG9pbnRzKSB7XG4gICAgICAgIGZpbGwoXCJyZWRcIik7XG4gICAgICAgIGNpcmNsZShpUHQueCwgaVB0LnksIDIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBkcmF3QWdlbnRDYW5TZWVQbGF5ZXIoKSB7XG4gICAgY29uc3QgbyA9IHRoaXMub3JpZ2luO1xuICAgIGNvbnN0IGVuZCA9IG8uY29weSgpLmFkZCh0aGlzLmRpci5jb3B5KCkubXVsdCg0MCkpO1xuXG4gICAgY29uc3QgbmVhclB0ID0gdGhpcy5uZWFyZXN0SW50ZXJzZWN0aW9uKCk7XG5cbiAgICAvL2RyYXcgc3RhcnQgcG9pbnRcbiAgICBub1N0cm9rZSgpO1xuICAgIGNvbnN0IGRpc3RUb01vdXNlUG9pbnRlciA9IHRoaXMub3JpZ2luLmRpc3QobW91c2VQb3NBc1ZlY3RvcigpKTtcbiAgICBpZiAobmVhclB0ICYmIHRoaXMub3JpZ2luLmRpc3QobmVhclB0KSA8IGRpc3RUb01vdXNlUG9pbnRlcikge1xuICAgICAgZmlsbCgwLCAwLCAwLCAyMCk7XG4gICAgICBjaXJjbGUoby54LCBvLnksIDgpO1xuICAgIH0gZWxzZSB7XG4gICAgICBjb25zdCBicmlnaHRuZXNzID0gbWFwKGRpc3RUb01vdXNlUG9pbnRlciwgMCwgbWF4KHdpZHRoLCBoZWlnaHQpLCAyNTUsIDApO1xuICAgICAgY29uc3QgbGl0Q29sb3I6IHA1LkNvbG9yID0gY29sb3IoMjU1LCAyNTUsIDI1NSwgYnJpZ2h0bmVzcyk7XG4gICAgICBmaWxsKGxpdENvbG9yKTtcbiAgICAgIGNpcmNsZShvLngsIG8ueSwgOCk7XG4gICAgfVxuICB9XG59XG4iLCJjbGFzcyBTdHJ1Y3R1cmUge1xuICBjZW50ZXI6IHA1LlZlY3RvcjtcbiAgd2FsbHM6IFdhbGxbXTtcblxuICBjb25zdHJ1Y3RvcihjZW50ZXI6IHA1LlZlY3RvciwgcmFkaXVzOiBudW1iZXIsIG51bVNpZGVzOiBudW1iZXIpIHtcbiAgICB0aGlzLmNlbnRlciA9IGNlbnRlci5jb3B5KCk7XG5cbiAgICBjb25zdCB2ZXJ0aWNlcyA9IFtdO1xuICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU2lkZXM7IGkrKykge1xuICAgICAgY29uc3QgYW5nbGUgPSAoaSAqIFRXT19QSSkgLyBudW1TaWRlcztcbiAgICAgIHZlcnRpY2VzLnB1c2goXG4gICAgICAgIHA1LlZlY3Rvci5mcm9tQW5nbGUoYW5nbGUpXG4gICAgICAgICAgLm11bHQocmFkaXVzKVxuICAgICAgICAgIC5hZGQodGhpcy5jZW50ZXIpXG4gICAgICApO1xuICAgIH1cbiAgICBjb25zdCB3YWxsczogV2FsbFtdID0gW107XG4gICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1TaWRlczsgaSsrKSB7XG4gICAgICBjb25zdCB2MSA9IHZlcnRpY2VzW2ldO1xuICAgICAgY29uc3QgdjIgPSBpID09PSBudW1TaWRlcyAtIDEgPyB2ZXJ0aWNlc1swXSA6IHZlcnRpY2VzW2kgKyAxXTtcbiAgICAgIHdhbGxzLnB1c2gobmV3IFdhbGwodjEsIHYyKSk7XG4gICAgfVxuXG4gICAgdGhpcy53YWxscyA9IHdhbGxzO1xuICB9XG5cbiAgZHJhdygpIHtcbiAgICBmb3IgKGxldCB3YWxsIG9mIHRoaXMud2FsbHMpIHtcbiAgICAgIHdhbGwuZHJhdygpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSYW5kb20oKSB7XG4gICAgY29uc3QgY2VudGVyID0gcmFuZG9tU2NyZWVuUG9zaXRpb24oKTtcbiAgICByZXR1cm4gbmV3IFN0cnVjdHVyZShjZW50ZXIsIHJhbmRvbSgyMCwgMjAwKSwgcmFuZG9tKFszLCA0LCA1LCA4XSkpO1xuICB9XG59XG4iLCJmdW5jdGlvbiByZXBlYXQobnVtOiBudW1iZXIsIGZuOiAoaXg6IG51bWJlcikgPT4gdm9pZCkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IG51bTsgaSsrKSB7XG4gICAgZm4oaSk7XG4gIH1cbn1cbmZ1bmN0aW9uIHJhbmRvbVNjcmVlblBvc2l0aW9uKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IocmFuZG9tKHdpZHRoKSwgcmFuZG9tKGhlaWdodCkpO1xufVxuXG5mdW5jdGlvbiByYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIHJvdW5kKHJhbmRvbShtaW4sIG1heCkpO1xufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVUb1ZlYyhwb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICB0cmFuc2xhdGUocG9zLngsIHBvcy55KTtcbn1cblxuZnVuY3Rpb24gY2VudGVyUG9zKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3Iod2lkdGggLyAyLCBoZWlnaHQgLyAyKTtcbn1cblxuLy9UYWtlbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEXG5mdW5jdGlvbiBjb2xsaWRlTGluZUxpbmUoXG4gIHgxOiBudW1iZXIsXG4gIHkxOiBudW1iZXIsXG4gIHgyOiBudW1iZXIsXG4gIHkyOiBudW1iZXIsXG4gIHgzOiBudW1iZXIsXG4gIHkzOiBudW1iZXIsXG4gIHg0OiBudW1iZXIsXG4gIHk0OiBudW1iZXJcbikge1xuICBsZXQgaW50ZXJzZWN0aW9uO1xuXG4gIC8vIGNhbGN1bGF0ZSB0aGUgZGlzdGFuY2UgdG8gaW50ZXJzZWN0aW9uIHBvaW50XG4gIGxldCB1QSA9XG4gICAgKCh4NCAtIHgzKSAqICh5MSAtIHkzKSAtICh5NCAtIHkzKSAqICh4MSAtIHgzKSkgL1xuICAgICgoeTQgLSB5MykgKiAoeDIgLSB4MSkgLSAoeDQgLSB4MykgKiAoeTIgLSB5MSkpO1xuICBsZXQgdUIgPVxuICAgICgoeDIgLSB4MSkgKiAoeTEgLSB5MykgLSAoeTIgLSB5MSkgKiAoeDEgLSB4MykpIC9cbiAgICAoKHk0IC0geTMpICogKHgyIC0geDEpIC0gKHg0IC0geDMpICogKHkyIC0geTEpKTtcblxuICAvLyBpZiB1QSBhbmQgdUIgYXJlIGJldHdlZW4gMC0xLCBsaW5lcyBhcmUgY29sbGlkaW5nXG4gIGlmICh1QSA+PSAwICYmIHVBIDw9IDEgJiYgdUIgPj0gMCAmJiB1QiA8PSAxKSB7XG4gICAgLy8gY2FsYyB0aGUgcG9pbnQgd2hlcmUgdGhlIGxpbmVzIG1lZXRcbiAgICBsZXQgaW50ZXJzZWN0aW9uWCA9IHgxICsgdUEgKiAoeDIgLSB4MSk7XG4gICAgbGV0IGludGVyc2VjdGlvblkgPSB5MSArIHVBICogKHkyIC0geTEpO1xuXG4gICAgaW50ZXJzZWN0aW9uID0ge1xuICAgICAgeDogaW50ZXJzZWN0aW9uWCxcbiAgICAgIHk6IGludGVyc2VjdGlvbllcbiAgICB9O1xuICAgIHJldHVybiBpbnRlcnNlY3Rpb247XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIG1pbkJ5PFQ+KGxpc3Q6IFRbXSwgZm46IChpdGVtOiBUKSA9PiBudW1iZXIpOiBUIHtcbiAgaWYgKGxpc3QubGVuZ3RoIDwgMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGxldCByZWNvcmRJdGVtID0gbGlzdFswXTtcbiAgbGV0IHJlY29yZFdlaWdodCA9IGZuKGxpc3RbMF0pO1xuICBmb3IgKGxldCBpdGVtIG9mIGxpc3QpIHtcbiAgICBjb25zdCB3ZWlnaHQgPSBmbihpdGVtKTtcbiAgICBpZiAod2VpZ2h0ID4gcmVjb3JkV2VpZ2h0KSB7XG4gICAgICByZWNvcmRXZWlnaHQgPSB3ZWlnaHQ7XG4gICAgICByZWNvcmRJdGVtID0gaXRlbTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlY29yZEl0ZW07XG59XG4iLCJjbGFzcyBXYWxsIHtcbiAgYTogcDUuVmVjdG9yO1xuICBiOiBwNS5WZWN0b3I7XG5cbiAgY29uc3RydWN0b3IoYTogcDUuVmVjdG9yLCBiOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLmEgPSBhLmNvcHkoKTtcbiAgICB0aGlzLmIgPSBiLmNvcHkoKTtcbiAgfVxuICBkcmF3KCkge1xuICAgIHN0cm9rZSgyNDMsIDEzNCwgNDgpO1xuICAgIHN0cm9rZVdlaWdodCg0KTtcbiAgICBsaW5lKHRoaXMuYS54LCB0aGlzLmEueSwgdGhpcy5iLngsIHRoaXMuYi55KTtcblxuICAgIG5vU3Ryb2tlKCk7XG4gICAgZmlsbChcIndoaXRlXCIpO1xuICAgIFt0aGlzLmEsIHRoaXMuYl0uZm9yRWFjaChwdCA9PiB7XG4gICAgICBjaXJjbGUocHQueCwgcHQueSwgMyk7XG4gICAgfSk7XG4gIH1cbiAgbGVuZ3RoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIGRpc3QodGhpcy5hLngsIHRoaXMuYS55LCB0aGlzLmIueCwgdGhpcy5iLnkpO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbSgpIHtcbiAgICBjb25zdCBwMSA9IHJhbmRvbVNjcmVlblBvc2l0aW9uKCk7XG4gICAgY29uc3QgcDIgPSBwMS5jb3B5KCkuYWRkKHA1LlZlY3Rvci5yYW5kb20yRCgpLm11bHQocmFuZG9tKDQwLCA0MDApKSk7XG4gICAgcmV0dXJuIG5ldyBXYWxsKHAxLCBwMik7XG4gIH1cbn1cbiJdfQ==