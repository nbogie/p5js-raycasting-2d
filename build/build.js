"use strict";
var Agent = (function () {
    function Agent(pos) {
        this.pos = pos.copy();
        this.movementPhase = random(10000);
        this.ray = new Ray(this.pos, { target: mousePosAsVector() });
    }
    Agent.prototype.draw = function () {
        var targetPos = mousePosAsVector();
        var o = this.pos;
        noStroke();
        push();
        translate(o.x, o.y);
        scale(2);
        var brightness;
        if (!this.ray.canSeePoint(targetPos)) {
            brightness = 20;
        }
        else {
            var distToTarget = this.pos.dist(targetPos);
            brightness = map(distToTarget, 0, max(width, height), 255, 0);
        }
        var litColor = color(224, 228, 204, brightness);
        fill(litColor);
        circle(0, 0, 8);
        fill(0, 0, 0, 40);
        rectMode(CENTER);
        rect(0, 3, 5, 2);
        circle(-2, -1, 1);
        circle(2, -1, 1);
        pop();
    };
    Agent.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Agent.createRandom = function () {
        return new Agent(randomScreenPosition());
    };
    Agent.prototype.update = function (walls, targetPos) {
        var offset = createVector(0, 0);
        offset.x = map(noise(this.movementPhase + 33333 + frameCount / 100), 0, 1, -1, 1);
        offset.y = map(noise(this.movementPhase + frameCount / 100), 0, 1, -1, 1);
        this.setPosition(this.pos.copy().add(offset));
        this.ray = new Ray(this.pos, { target: targetPos, walls: walls });
    };
    return Agent;
}());
var Palette = (function () {
    function Palette() {
    }
    Palette.getColors = function () {
        return [
            color(250, 105, 0),
            color(105, 210, 231),
            color(167, 219, 216),
            color(243, 134, 48)
        ];
    };
    Palette.randomColor = function () {
        return random(Palette.getColors());
    };
    return Palette;
}());
var Particle = (function () {
    function Particle(pos) {
        this.pos = pos.copy();
    }
    Particle.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
    };
    Particle.prototype.update = function () { };
    Particle.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Particle.createRandom = function () {
        return new Particle(randomScreenPosition());
    };
    return Particle;
}());
var Ray = (function () {
    function Ray(origin, _a) {
        var _b = _a.angleRads, angleRads = _b === void 0 ? null : _b, _c = _a.target, target = _c === void 0 ? null : _c, _d = _a.walls, walls = _d === void 0 ? [] : _d;
        this.origin = origin.copy();
        if (target !== null) {
            this.lookAt(target);
        }
        else {
            this.angleRads = p5.Vector.fromAngle(angleRads);
        }
        this.intersectionPoints = [];
        this.recalculateFarEnd();
        if (walls.length > 0) {
            this.recalculateIntersections(walls);
        }
    }
    Ray.prototype.lookAt = function (targetPos) {
        var deltaToTarget = targetPos.copy().sub(this.origin);
        var angleToTarget = atan2(deltaToTarget.y, deltaToTarget.x);
        this.angleRads = p5.Vector.fromAngle(angleToTarget);
        this.recalculateFarEnd();
    };
    Ray.createRandom = function () {
        return new Ray(randomScreenPosition(), { angleRads: random(0, TWO_PI) });
    };
    Ray.prototype.intersectionWithWall = function (wall) {
        var answer = collideLineLine(wall.a.x, wall.a.y, wall.b.x, wall.b.y, this.origin.x, this.origin.y, this.farEnd.x, this.farEnd.y);
        return answer;
    };
    Ray.prototype.nearestIntersection = function () {
        var _this = this;
        if (this.intersectionPoints.length > 0) {
            return minBy(this.intersectionPoints, function (pt) { return -_this.origin.dist(pt); });
        }
        else {
            return undefined;
        }
    };
    Ray.prototype.calculateIntersections = function (walls) {
        var res = [];
        for (var _i = 0, walls_1 = walls; _i < walls_1.length; _i++) {
            var wall = walls_1[_i];
            var intersection = this.intersectionWithWall(wall);
            if (intersection) {
                res.push(intersection);
            }
        }
        return res;
    };
    Ray.prototype.recalculateIntersections = function (walls) {
        this.intersectionPoints = this.calculateIntersections(walls);
    };
    Ray.prototype.recalculateFarEnd = function () {
        this.farEnd = this.origin.copy().add(this.angleRads.copy().mult(width));
    };
    Ray.prototype.drawLitLineSegment = function (a, b) {
        if (Ray.isRenderAsCobweb) {
            for (var i = 0; i < 20; i++) {
                var pt = a.copy().lerp(b, i / 10);
                square(pt.x, pt.y, 1);
            }
        }
        else {
            line(a.x, a.y, b.x, b.y);
        }
    };
    Ray.prototype.drawRayUntilFirstIntersection = function () {
        var o = this.origin;
        var end = o.copy().add(this.angleRads.copy().mult(40));
        if (Ray.isDrawGhostRay) {
            stroke(255, 255, 255, 10);
            strokeWeight(0.3);
            line(o.x, o.y, this.farEnd.x, this.farEnd.y);
        }
        var nearPt = this.nearestIntersection();
        if (Ray.isDrawRayToFirstIntersection) {
            if (nearPt) {
                stroke("white");
                strokeWeight(2);
                this.drawLitLineSegment(o, nearPt);
            }
        }
        if (Ray.isDrawIntersections) {
            for (var _i = 0, _a = this.intersectionPoints; _i < _a.length; _i++) {
                var iPt = _a[_i];
                fill("gray");
                circle(iPt.x, iPt.y, 2);
            }
            var first = this.nearestIntersection();
            if (first) {
                fill("white");
                circle(first.x, first.y, 2);
            }
        }
    };
    Ray.prototype.canSeePoint = function (target) {
        var nearestIsect = this.nearestIntersection();
        var distToTarget = this.origin.dist(target);
        return !(nearestIsect && this.origin.dist(nearestIsect) < distToTarget);
    };
    Ray.isRenderAsCobweb = false;
    Ray.isDrawGhostRay = true;
    Ray.isDrawRayToFirstIntersection = true;
    Ray.isDrawIntersections = false;
    return Ray;
}());
var Structure = (function () {
    function Structure(center, radius, numSides) {
        this.isFilledShape = false;
        this.rotation = random(TWO_PI);
        this.myColor = Palette.randomColor();
        this.movementSpeed = -random(0.2, 2);
        this.rotationSpeed = random(-0.01, 0.01);
        this.abstractVertices = this.createVerticesForShapeWithNumSides(center, radius, numSides);
        this.walls = this.makeWallsFromVertices(this.abstractVertices, this.myColor);
    }
    Structure.prototype.createVerticesForShapeWithNumSides = function (center, radius, numSides) {
        var vertices = [];
        if (numSides === 1) {
            var _a = this.createRandomLineSeg(), a = _a[0], b = _a[1];
            vertices.push(a);
            vertices.push(b);
            this.center = a.copy().lerp(b, 0.5);
        }
        else {
            this.center = center.copy();
            for (var i = 0; i < numSides; i++) {
                var angle = (i * TWO_PI) / numSides;
                vertices.push(p5.Vector.fromAngle(angle)
                    .mult(radius)
                    .add(this.center));
            }
        }
        return vertices;
    };
    Structure.prototype.makeWallsFromVertices = function (vs, myColor) {
        var walls = [];
        if (vs.length === 2) {
            var singleWall = new Wall(vs[0], vs[1]);
            singleWall.myColor = myColor;
            walls.push(singleWall);
        }
        else {
            var numSides = vs.length;
            for (var i = 0; i < numSides; i++) {
                var a = vs[i];
                var b = i === numSides - 1 ? vs[0] : vs[i + 1];
                var wall = new Wall(a, b);
                wall.myColor = myColor;
                walls.push(wall);
            }
        }
        return walls;
    };
    Structure.prototype.createRandomLineSeg = function () {
        var p1 = randomScreenPosition();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(random(40, 400)));
        return [p1, p2];
    };
    Structure.prototype.rotate = function (angleRad) {
        var _this = this;
        this.rotation += angleRad;
        var rotatedVertices = this.abstractVertices.map(function (v) {
            return rotateVertexAround(v, _this.center, _this.rotation);
        });
        this.walls = this.makeWallsFromVertices(rotatedVertices, this.myColor);
    };
    Structure.prototype.update = function () {
        var moveAmt = this.movementSpeed;
        if (this.center.x + moveAmt < 0) {
            moveAmt += width;
        }
        this.center.x += moveAmt;
        this.walls = this.makeWallsFromVertices(this.abstractVertices.map(function (v) { return v.add(createVector(moveAmt, 0)); }), this.myColor);
        this.rotate(this.rotationSpeed);
    };
    Structure.prototype.draw = function () {
        for (var _i = 0, _a = this.walls; _i < _a.length; _i++) {
            var wall = _a[_i];
            wall.draw();
        }
        if (this.isFilledShape) {
            beginShape();
            for (var _b = 0, _c = this.walls; _b < _c.length; _b++) {
                var wall = _c[_b];
                for (var _d = 0, _e = [wall.a, wall.b]; _d < _e.length; _d++) {
                    var pt = _e[_d];
                    vertex(pt.x, pt.y);
                }
            }
            endShape(CLOSE);
        }
    };
    Structure.createRandom = function () {
        var center = randomScreenPosition();
        var numSides = random([1, 1, 1, 3, 4, 5, 6]);
        return new Structure(center, random(20, random(100, 200)), numSides);
    };
    return Structure;
}());
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function centerPos() {
    return createVector(width / 2, height / 2);
}
function rotateVertexAround(vertex, rotOrigin, angleRad) {
    return vertex
        .copy()
        .sub(rotOrigin)
        .rotate(angleRad)
        .add(rotOrigin);
}
function collideLineLine(x1, y1, x2, y2, x3, y3, x4, y4) {
    var uA = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    var uB = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {
        var intersectionX = x1 + uA * (x2 - x1);
        var intersectionY = y1 + uA * (y2 - y1);
        return createVector(intersectionX, intersectionY);
    }
    return null;
}
function minBy(list, fn) {
    if (list.length < 0) {
        return null;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function distributeUpTo(total, max, fn) {
    repeat(total, function (ix) {
        var val = (ix * max) / total;
        fn(val);
    });
}
var Wall = (function () {
    function Wall(a, b) {
        this.a = a.copy();
        this.b = b.copy();
        this.myColor = color(243, 134, 48);
    }
    Wall.prototype.draw = function () {
        stroke(this.myColor);
        strokeWeight(4);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
        noStroke();
        fill(this.myColor);
        [this.a, this.b].forEach(function (pt) {
        });
    };
    Wall.prototype.midPoint = function () {
        return this.a.copy().lerp(this.b, 0.5);
    };
    Wall.prototype.length = function () {
        return dist(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Wall.createRandom = function () {
        var p1 = randomScreenPosition();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(random(40, 400)));
        return new Wall(p1, p2);
    };
    return Wall;
}());
p5.disableFriendlyErrors = true;
var isDebugging = false;
var gAgents = [];
var gPlayerRays = [];
var gPlayer = null;
var gNumWalls = 20;
var gNumAgents = 100;
var gNumPlayerRays = 100;
var gNumStructures = 30;
var gStructures = [];
function setup() {
    createCanvas(windowWidth, windowHeight);
    repeat(gNumStructures, function () {
        var structure = Structure.createRandom();
        gStructures.push(structure);
    });
    repeat(gNumAgents, function () {
        gAgents.push(Agent.createRandom());
    });
    gPlayerRays = createRaysAtPosition(gNumPlayerRays, mousePosAsVector());
    gPlayer = Particle.createRandom();
    mouseX = centerPos().x;
    mouseY = centerPos().y;
}
function getAllWalls() {
    return gStructures.flatMap(function (structure) { return structure.walls; });
}
function createRaysAtPosition(numRays, pos) {
    var rays = [];
    distributeUpTo(numRays, TWO_PI, function (val) {
        return rays.push(new Ray(pos, { angleRads: val, walls: getAllWalls() }));
    });
    return rays;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function update() {
    gPlayer.setPosition(mousePosAsVector());
    gPlayer.update();
    for (var _i = 0, gStructures_1 = gStructures; _i < gStructures_1.length; _i++) {
        var s = gStructures_1[_i];
        if (isMovingStructures) {
            s.update();
        }
    }
    for (var _a = 0, gAgents_1 = gAgents; _a < gAgents_1.length; _a++) {
        var agent = gAgents_1[_a];
        agent.update(getAllWalls(), mousePosAsVector());
    }
    gPlayerRays = createRaysAtPosition(gNumPlayerRays, mousePosAsVector());
}
function draw() {
    update();
    background(0);
    fill("black");
    noStroke();
    for (var _i = 0, gStructures_2 = gStructures; _i < gStructures_2.length; _i++) {
        var s = gStructures_2[_i];
        s.draw();
    }
    for (var _a = 0, _b = getAllWalls(); _a < _b.length; _a++) {
        var wall = _b[_a];
        wall.draw();
    }
    for (var _c = 0, gAgents_2 = gAgents; _c < gAgents_2.length; _c++) {
        var agent = gAgents_2[_c];
        agent.draw();
    }
    for (var _d = 0, gPlayerRays_1 = gPlayerRays; _d < gPlayerRays_1.length; _d++) {
        var ray = gPlayerRays_1[_d];
        ray.drawRayUntilFirstIntersection();
    }
    gPlayer.draw();
}
var isMovingStructures = true;
function toggleMovingStructures() {
    isMovingStructures = !isMovingStructures;
}
function mousePressed() {
    toggleMovingStructures();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiQWdlbnQudHMiLCJQYWxldHRlLnRzIiwiUGFydGljbGUudHMiLCJSYXkudHMiLCJTdHJ1Y3R1cmUudHMiLCJVdGlscy50cyIsIldhbGwudHMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6IkFBQUEsWUFBWSxDQUFDO0FDQWI7SUFLRSxlQUFZLEdBQWM7UUFDeEIsSUFBSSxDQUFDLEdBQUcsR0FBRyxHQUFHLENBQUMsSUFBSSxFQUFFLENBQUM7UUFDdEIsSUFBSSxDQUFDLGFBQWEsR0FBRyxNQUFNLENBQUMsS0FBSyxDQUFDLENBQUM7UUFDbkMsSUFBSSxDQUFDLEdBQUcsR0FBRyxJQUFJLEdBQUcsQ0FBQyxJQUFJLENBQUMsR0FBRyxFQUFFLEVBQUUsTUFBTSxFQUFFLGdCQUFnQixFQUFFLEVBQUUsQ0FBQyxDQUFDO0lBQy9ELENBQUM7SUFFRCxvQkFBSSxHQUFKO1FBQ0UsSUFBTSxTQUFTLEdBQUcsZ0JBQWdCLEVBQUUsQ0FBQztRQUNyQyxJQUFNLENBQUMsR0FBRyxJQUFJLENBQUMsR0FBRyxDQUFDO1FBRW5CLFFBQVEsRUFBRSxDQUFDO1FBQ1gsSUFBSSxFQUFFLENBQUM7UUFDUCxTQUFTLENBQUMsQ0FBQyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQyxDQUFDLENBQUM7UUFDcEIsS0FBSyxDQUFDLENBQUMsQ0FBQyxDQUFDO1FBQ1QsSUFBSSxVQUFVLENBQUM7UUFDZixJQUFJLENBQUMsSUFBSSxDQUFDLEdBQUcsQ0FBQyxXQUFXLENBQUMsU0FBUyxDQUFDLEVBQUU7WUFDcEMsVUFBVSxHQUFHLEVBQUUsQ0FBQztTQUNqQjthQUFNO1lBQ0wsSUFBTSxZQUFZLEdBQUcsSUFBSSxDQUFDLEdBQUcsQ0FBQyxJQUFJLENBQUMsU0FBUyxDQUFDLENBQUM7WUFDOUMsVUFBVSxHQUFHLEdBQUcsQ0FBQyxZQUFZLEVBQUUsQ0FBQyxFQUFFLEdBQUcsQ0FBQyxLQUFL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QUMsU0FBUyxDQUFDO1NBQ2QsTUFBTSxDQUFDLFFBQVEsQ0FBQztTQUNoQixHQUFHLENBQUMsU0FBUyxDQUFDLENBQUM7QUFDcEIsQ0FBQztBQUdELFNBQVMsZUFBZSxDQUN0QixFQUFVLEVBQ1YsRUFBVSxFQUNWLEVBQVUsRUFDVixFQUFVLEVBQ1YsRUFBVSxFQUNWLEVBQVUsRUFDVixFQUFVLEVBQ1YsRUFBVTtJQUdWLElBQUksRUFBRSxHQUNKLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBQ2xELElBQUksRUFBRSxHQUNKLENBQUMsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLEdBQUcsQ0FBQyxFQUFFLEdBQUcsRUFBRSxDQUFDLENBQUM7UUFDL0MsQ0FBQyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsR0FBRyxDQUFDLEVBQUUsR0FBRyxFQUFFLENBQUMsQ0FBQyxDQUFDO0lBR2xELElBQUksRUFBRSxJQUFJLENBQUMsSUFBSSxFQUFFLElBQUksQ0FBQyxJQUFJLEVBQUUsSUFBSSxDQUFDLElBQUksRUFBRSxJQUFJLENBQUMsRUFBRTtRQUU1QyxJQUFJLGFBQWEsR0FBRyxFQUFFLEdBQUcsRUFBRSxHQUFHLENBQUMsRUFBRSxHQUFHLEVBQUUsQ0FBQyxDQUFD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aWN0XCI7XG5cbnA1LmRpc2FibGVGcmllbmRseUVycm9ycyA9IHRydWU7XG5jb25zdCBpc0RlYnVnZ2luZyA9IGZhbHNlO1xubGV0IGdBZ2VudHM6IEFnZW50W10gPSBbXTtcbmxldCBnUGxheWVyUmF5czogUmF5W10gPSBbXTtcbmxldCBnUGxheWVyOiBQYXJ0aWNsZSA9IG51bGw7XG5sZXQgZ051bVdhbGxzOiBudW1iZXIgPSAyMDtcbmxldCBnTnVtQWdlbnRzOiBudW1iZXIgPSAxMDA7XG5sZXQgZ051bVBsYXllclJheXM6IG51bWJlciA9IDEwMDtcbmxldCBnTnVtU3RydWN0dXJlcyA9IDMwO1xuLyogLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tXG4gKiBTRVRVUFxuICovXG5jb25zdCBnU3RydWN0dXJlczogU3RydWN0dXJlW10gPSBbXTtcbmZ1bmN0aW9uIHNldHVwKCkge1xuICBjcmVhdGVDYW52YXMod2luZG93V2lkdGgsIHdpbmRvd0hlaWdodCk7XG5cbiAgcmVwZWF0KGdOdW1TdHJ1Y3R1cmVzLCAoKSA9PiB7XG4gICAgY29uc3Qgc3RydWN0dXJlID0gU3RydWN0dXJlLmNyZWF0ZVJhbmRvbSgpO1xuICAgIGdTdHJ1Y3R1cmVzLnB1c2goc3RydWN0dXJlKTtcbiAgfSk7XG5cbiAgcmVwZWF0KGdOdW1BZ2VudHMsICgpID0+IHtcbiAgICBnQWdlbnRzLnB1c2goQWdlbnQuY3JlYXRlUmFuZG9tKCkpO1xuICB9KTtcblxuICBnUGxheWVyUmF5cyA9IGNyZWF0ZVJheXNBdFBvc2l0aW9uKGdOdW1QbGF5ZXJSYXlzLCBtb3VzZVBvc0FzVmVjdG9yKCkpO1xuXG4gIGdQbGF5ZXIgPSBQYXJ0aWNsZS5jcmVhdGVSYW5kb20oKTtcbiAgbW91c2VYID0gY2VudGVyUG9zKCkueDtcbiAgbW91c2VZID0gY2VudGVyUG9zKCkueTtcbn1cblxuZnVuY3Rpb24gZ2V0QWxsV2FsbHMoKTogV2FsbFtdIHtcbiAgcmV0dXJuIGdTdHJ1Y3R1cmVzLmZsYXRNYXAoKHN0cnVjdHVyZTogU3RydWN0dXJlKSA9PiBzdHJ1Y3R1cmUud2FsbHMpO1xufVxuXG5mdW5jdGlvbiBjcmVhdGVSYXlzQXRQb3NpdGlvbihudW1SYXlzOiBudW1iZXIsIHBvczogcDUuVmVjdG9yKSB7XG4gIGNvbnN0IHJheXM6IFJheVtdID0gW107XG4gIGRpc3RyaWJ1dGVVcFRvKG51bVJheXMsIFRXT19QSSwgdmFsID0+XG4gICAgcmF5cy5wdXNoKG5ldyBSYXkocG9zLCB7IGFuZ2xlUmFkczogdmFsLCB3YWxsczogZ2V0QWxsV2FsbHMoKSB9KSlcbiAgKTtcbiAgcmV0dXJuIHJheXM7XG59XG5cbmZ1bmN0aW9uIG1vdXNlUG9zQXNWZWN0b3IoKSB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IobW91c2VYLCBtb3VzZVkpO1xufVxuZnVuY3Rpb24gdXBkYXRlKCkge1xuICBnUGxheWVyLnNldFBvc2l0aW9uKG1vdXNlUG9zQXNWZWN0b3IoKSk7XG4gIGdQbGF5ZXIudXBkYXRlKCk7XG5cbiAgZm9yIChsZXQgcyBvZiBnU3RydWN0dXJlcykge1xuICAgIGlmIChpc01vdmluZ1N0cnVjdHVyZXMpIHtcbiAgICAgIHMudXBkYXRlKCk7XG4gICAgfVxuICB9XG4gIGZvciAobGV0IGFnZW50IG9mIGdBZ2VudHMpIHtcbiAgICBhZ2VudC51cGRhdGUoZ2V0QWxsV2FsbHMoKSwgbW91c2VQb3NBc1ZlY3RvcigpKTtcbiAgfVxuXG4gIGdQbGF5ZXJSYXlzID0gY3JlYXRlUmF5c0F0UG9zaXRpb24oZ051bVBsYXllclJheXMsIG1vdXNlUG9zQXNWZWN0b3IoKSk7XG59XG4vKlxuICogRFJBV1xuICovXG5mdW5jdGlvbiBkcmF3KCkge1xuICB1cGRhdGUoKTtcbiAgYmFja2dyb3VuZCgwKTtcbiAgZmlsbChcImJsYWNrXCIpO1xuICBub1N0cm9rZSgpO1xuXG4gIGZvciAobGV0IHMgb2YgZ1N0cnVjdHVyZXMpIHtcbiAgICBzLmRyYXcoKTtcbiAgfVxuICBmb3IgKGxldCB3YWxsIG9mIGdldEFsbFdhbGxzKCkpIHtcbiAgICB3YWxsLmRyYXcoKTtcbiAgfVxuICBmb3IgKGxldCBhZ2VudCBvZiBnQWdlbnRzKSB7XG4gICAgYWdlbnQuZHJhdygpO1xuICB9XG4gIGZvciAobGV0IHJheSBvZiBnUGxheWVyUmF5cykge1xuICAgIHJheS5kcmF3UmF5VW50aWxGaXJzdEludGVyc2VjdGlvbigpO1xuICB9XG4gIGdQbGF5ZXIuZHJhdygpO1xufVxubGV0IGlzTW92aW5nU3RydWN0dXJlcyA9IHRydWU7XG5mdW5jdGlvbiB0b2dnbGVNb3ZpbmdTdHJ1Y3R1cmVzKCkge1xuICBpc01vdmluZ1N0cnVjdHVyZXMgPSAhaXNNb3ZpbmdTdHJ1Y3R1cmVzO1xufVxuZnVuY3Rpb24gbW91c2VQcmVzc2VkKCkge1xuICB0b2dnbGVNb3ZpbmdTdHJ1Y3R1cmVzKCk7XG59XG4iLCJjbGFzcyBBZ2VudCB7XG4gIHBvczogcDUuVmVjdG9yO1xuICBtb3ZlbWVudFBoYXNlOiBudW1iZXI7XG4gIHJheTogUmF5O1xuXG4gIGNvbnN0cnVjdG9yKHBvczogcDUuVmVjdG9yKSB7XG4gICAgdGhpcy5wb3MgPSBwb3MuY29weSgpO1xuICAgIHRoaXMubW92ZW1lbnRQaGFzZSA9IHJhbmRvbSgxMDAwMCk7XG4gICAgdGhpcy5yYXkgPSBuZXcgUmF5KHRoaXMucG9zLCB7IHRhcmdldDogbW91c2VQb3NBc1ZlY3RvcigpIH0pO1xuICB9XG5cbiAgZHJhdygpIHtcbiAgICBjb25zdCB0YXJnZXRQb3MgPSBtb3VzZVBvc0FzVmVjdG9yKCk7XG4gICAgY29uc3QgbyA9IHRoaXMucG9zO1xuICAgIC8vZHJhdyBhZ2VudCBzcHJpdGUgKGEgY2lyY2xlKSBhY2NvcmRpbmcgdG8gd2hldGhlciBpdCBoYXMgbC5vLnMuIHRvIHRhcmdldFBvc1xuICAgIG5vU3Ryb2tlKCk7XG4gICAgcHVzaCgpO1xuICAgIHRyYW5zbGF0ZShvLngsIG8ueSk7XG4gICAgc2NhbGUoMik7XG4gICAgbGV0IGJyaWdodG5lc3M7XG4gICAgaWYgKCF0aGlzLnJheS5jYW5TZWVQb2ludCh0YXJnZXRQb3MpKSB7XG4gICAgICBicmlnaHRuZXNzID0gMjA7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGRpc3RUb1RhcmdldCA9IHRoaXMucG9zLmRpc3QodGFyZ2V0UG9zKTtcbiAgICAgIGJyaWdodG5lc3MgPSBtYXAoZGlzdFRvVGFyZ2V0LCAwLCBtYXgod2lkdGgsIGhlaWdodCksIDI1NSwgMCk7XG4gICAgfVxuICAgIGNvbnN0IGxpdENvbG9yOiBwNS5Db2xvciA9IGNvbG9yKDIyNCwgMjI4LCAyMDQsIGJyaWdodG5lc3MpO1xuICAgIGZpbGwobGl0Q29sb3IpO1xuICAgIGNpcmNsZSgwLCAwLCA4KTtcbiAgICBmaWxsKDAsIDAsIDAsIDQwKTtcbiAgICByZWN0TW9kZShDRU5URVIpO1xuICAgIHJlY3QoMCwgMywgNSwgMik7XG4gICAgLy9leWVzXG4gICAgY2lyY2xlKC0yLCAtMSwgMSk7XG4gICAgY2lyY2xlKDIsIC0xLCAxKTtcblxuICAgIHBvcCgpO1xuICB9XG5cbiAgc2V0UG9zaXRpb24ocG9zOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLnBvcy54ID0gcG9zLng7XG4gICAgdGhpcy5wb3MueSA9IHBvcy55O1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbSgpIHtcbiAgICByZXR1cm4gbmV3IEFnZW50KHJhbmRvbVNjcmVlblBvc2l0aW9uKCkpO1xuICB9XG4gIC8qKiBtb3ZlIHRoZSBhZ2VudCBhbmQgcmVjYWxjdWxhdGUgdGhlIHJheSBmcm9tIGl0IHRvIHRoZSB0YXJnZXQgcG9zICovXG4gIHVwZGF0ZSh3YWxsczogV2FsbFtdLCB0YXJnZXRQb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICAgIGNvbnN0IG9mZnNldCA9IGNyZWF0ZVZlY3RvcigwLCAwKTtcbiAgICBvZmZzZXQueCA9IG1hcChcbiAgICAgIG5vaXNlKHRoaXMubW92ZW1lbnRQaGFzZSArIDMzMzMzICsgZnJhbWVDb3VudCAvIDEwMCksXG4gICAgICAwLFxuICAgICAgMSxcbiAgICAgIC0xLFxuICAgICAgMVxuICAgICk7XG4gICAgb2Zmc2V0LnkgPSBtYXAobm9pc2UodGhpcy5tb3ZlbWVudFBoYXNlICsgZnJhbWVDb3VudCAvIDEwMCksIDAsIDEsIC0xLCAxKTtcblxuICAgIHRoaXMuc2V0UG9zaXRpb24odGhpcy5wb3MuY29weSgpLmFkZChvZmZzZXQpKTtcblxuICAgIHRoaXMucmF5ID0gbmV3IFJheSh0aGlzLnBvcywgeyB0YXJnZXQ6IHRhcmdldFBvcywgd2FsbHM6IHdhbGxzIH0pO1xuICB9XG59XG4iLCJjbGFzcyBQYWxldHRlIHtcbiAgc3RhdGljIGdldENvbG9ycygpIHtcbiAgICByZXR1cm4gW1xuICAgICAgY29sb3IoMjUwLCAxMDUsIDApLFxuICAgICAgY29sb3IoMTA1LCAyMTAsIDIzMSksXG4gICAgICBjb2xvcigxNjcsIDIxOSwgMjE2KSxcbiAgICAgIGNvbG9yKDI0MywgMTM0LCA0OClcbiAgICBdO1xuICB9XG4gIHN0YXRpYyByYW5kb21Db2xvcigpOiBwNS5Db2xvciB7XG4gICAgcmV0dXJuIHJhbmRvbShQYWxldHRlLmdldENvbG9ycygpKTtcbiAgfVxufVxuIiwiY2xhc3MgUGFydGljbGUge1xuICBwb3M6IHA1LlZlY3RvcjtcblxuICBjb25zdHJ1Y3Rvcihwb3M6IHA1LlZlY3Rvcikge1xuICAgIHRoaXMucG9zID0gcG9zLmNvcHkoKTtcbiAgfVxuICBkcmF3KCkge1xuICAgIG5vU3Ryb2tlKCk7XG4gICAgZmlsbChcImJsYWNrXCIpO1xuICAgIHJlY3RNb2RlKENFTlRFUik7XG4gICAgc3F1YXJlKHRoaXMucG9zLngsIHRoaXMucG9zLnksIDMpO1xuICAgIGZpbGwoMCwgMjApO1xuICB9XG4gIHVwZGF0ZSgpIHt9XG5cbiAgc2V0UG9zaXRpb24ocG9zOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLnBvcy54ID0gcG9zLng7XG4gICAgdGhpcy5wb3MueSA9IHBvcy55O1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbSgpIHtcbiAgICByZXR1cm4gbmV3IFBhcnRpY2xlKHJhbmRvbVNjcmVlblBvc2l0aW9uKCkpO1xuICB9XG59XG4iLCJpbnRlcmZhY2UgUmF5T3B0aW9ucyB7XG4gIGFuZ2xlUmFkcz86IG51bWJlcjtcbiAgdGFyZ2V0PzogcDUuVmVjdG9yOyAvL1RPRE86IGV4YWN0bHkgb25lIG9mIHRhcmdldCBhbmQgYW5nbGVSYWRzIGlzIHJlcXVpcmVkLlxuICB3YWxscz86IFdhbGxbXTtcbn1cbmNsYXNzIFJheSB7XG4gIC8vVE9ETzogc3BsaXQgdGhpcyBvdXQgaW50byBhbiBhZ2VudCB3aGljaCBoYXMgYW4gb3JpZ2luIGFuZCBhIHJheSwgd2l0aCB0aGUgcmF5IGhhbmRsaW5nIG9ubHkgaGFuZGxpbmcgZGVjaWRpbmcgbGluZSBvZiBzaWdodCBhbmQgaW50ZXJzZWN0aW9uIHBvaW50cy5cbiAgc3RhdGljIGlzUmVuZGVyQXNDb2J3ZWIgPSBmYWxzZTtcbiAgc3RhdGljIGlzRHJhd0dob3N0UmF5OiBib29sZWFuID0gdHJ1ZTtcbiAgc3RhdGljIGlzRHJhd1JheVRvRmlyc3RJbnRlcnNlY3Rpb246IGJvb2xlYW4gPSB0cnVlO1xuICBzdGF0aWMgaXNEcmF3SW50ZXJzZWN0aW9uczogYm9vbGVhbiA9IGZhbHNlO1xuXG4gIG9yaWdpbjogcDUuVmVjdG9yO1xuXG4gIC8vcmF5IGlzIGNvbmNlcHR1YWxseSBpbmZpbml0ZSBsZW5ndGggd2l0aCBvbmx5IG9uZSBlbmQsIGJ1dCB0aGlzIGhhY2sgaXMgdXNlZnVsIGZvciBpbnRlcnNlY3Rpb24gYW5kIHJlbmRlcmluZy5cbiAgZmFyRW5kOiBwNS5WZWN0b3I7IC8vYSBoYWNrLiAgb2Zmc2NyZWVuIFwiZmFyIGVuZFwiLlxuXG4gIGFuZ2xlUmFkczogcDUuVmVjdG9yO1xuICBpbnRlcnNlY3Rpb25Qb2ludHM6IHA1LlZlY3RvcltdO1xuXG4gIGNvbnN0cnVjdG9yKFxuICAgIG9yaWdpbjogcDUuVmVjdG9yLFxuICAgIHsgYW5nbGVSYWRzID0gbnVsbCwgdGFyZ2V0ID0gbnVsbCwgd2FsbHMgPSBbXSB9OiBSYXlPcHRpb25zXG4gICkge1xuICAgIHRoaXMub3JpZ2luID0gb3JpZ2luLmNvcHkoKTtcbiAgICBpZiAodGFyZ2V0ICE9PSBudWxsKSB7XG4gICAgICB0aGlzLmxvb2tBdCh0YXJnZXQpO1xuICAgIH0gZWxzZSB7XG4gICAgICB0aGlzLmFuZ2xlUmFkcyA9IHA1LlZlY3Rvci5mcm9tQW5nbGUoYW5nbGVSYWRzKTtcbiAgICB9XG4gICAgdGhpcy5pbnRlcnNlY3Rpb25Qb2ludHMgPSBbXTtcbiAgICB0aGlzLnJlY2FsY3VsYXRlRmFyRW5kKCk7XG4gICAgaWYgKHdhbGxzLmxlbmd0aCA+IDApIHtcbiAgICAgIHRoaXMucmVjYWxjdWxhdGVJbnRlcnNlY3Rpb25zKHdhbGxzKTtcbiAgICB9XG4gIH1cblxuICBsb29rQXQodGFyZ2V0UG9zOiBwNS5WZWN0b3IpOiB2b2lkIHtcbiAgICBjb25zdCBkZWx0YVRvVGFyZ2V0ID0gdGFyZ2V0UG9zLmNvcHkoKS5zdWIodGhpcy5vcmlnaW4pO1xuICAgIC8vbm90ZTogcGFyYW0gb3JkZXI6IHkgdGhlbiB4XG4gICAgY29uc3QgYW5nbGVUb1RhcmdldCA9IGF0YW4yKGRlbHRhVG9UYXJnZXQueSwgZGVsdGFUb1RhcmdldC54KTtcbiAgICB0aGlzLmFuZ2xlUmFkcyA9IHA1LlZlY3Rvci5mcm9tQW5nbGUoYW5nbGVUb1RhcmdldCk7XG4gICAgdGhpcy5yZWNhbGN1bGF0ZUZhckVuZCgpO1xuICB9XG5cbiAgc3RhdGljIGNyZWF0ZVJhbmRvbSgpOiBSYXkge1xuICAgIHJldHVybiBuZXcgUmF5KHJhbmRvbVNjcmVlblBvc2l0aW9uKCksIHsgYW5nbGVSYWRzOiByYW5kb20oMCwgVFdPX1BJKSB9KTtcbiAgfVxuICBpbnRlcnNlY3Rpb25XaXRoV2FsbCh3YWxsOiBXYWxsKTogcDUuVmVjdG9yIHtcbiAgICAvL1RPRE86IGN1c3RvbWlzZSBhIGZuIHRvIGNvbGxpZGVMaW5lU2VnV2l0aFJheSxcbiAgICAvL3JhdGhlciB0aGFuIExpbmVTZWcgd2l0aCBMaW5lU2VnXG4gICAgY29uc3QgYW5zd2VyID0gY29sbGlkZUxpbmVMaW5lKFxuICAgICAgd2FsbC5hLngsXG4gICAgICB3YWxsLmEueSxcbiAgICAgIHdhbGwuYi54LFxuICAgICAgd2FsbC5iLnksXG4gICAgICB0aGlzLm9yaWdpbi54LFxuICAgICAgdGhpcy5vcmlnaW4ueSxcbiAgICAgIHRoaXMuZmFyRW5kLngsXG4gICAgICB0aGlzLmZhckVuZC55XG4gICAgKTtcblxuICAgIHJldHVybiBhbnN3ZXI7XG4gIH1cblxuICBuZWFyZXN0SW50ZXJzZWN0aW9uKCk6IHA1LlZlY3RvciB7XG4gICAgaWYgKHRoaXMuaW50ZXJzZWN0aW9uUG9pbnRzLmxlbmd0aCA+IDApIHtcbiAgICAgIHJldHVybiBtaW5CeShcbiAgICAgICAgdGhpcy5pbnRlcnNlY3Rpb25Qb2ludHMsXG4gICAgICAgIChwdDogcDUuVmVjdG9yKSA9PiAtdGhpcy5vcmlnaW4uZGlzdChwdClcbiAgICAgICk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHJldHVybiB1bmRlZmluZWQ7XG4gICAgfVxuICB9XG4gIGNhbGN1bGF0ZUludGVyc2VjdGlvbnMod2FsbHM6IFdhbGxbXSk6IHA1LlZlY3RvcltdIHtcbiAgICBjb25zdCByZXM6IHA1LlZlY3RvcltdID0gW107XG4gICAgZm9yIChsZXQgd2FsbCBvZiB3YWxscykge1xuICAgICAgY29uc3QgaW50ZXJzZWN0aW9uID0gdGhpcy5pbnRlcnNlY3Rpb25XaXRoV2FsbCh3YWxsKTtcbiAgICAgIGlmIChpbnRlcnNlY3Rpb24pIHtcbiAgICAgICAgcmVzLnB1c2goaW50ZXJzZWN0aW9uKTtcbiAgICAgIH1cbiAgICB9XG4gICAgcmV0dXJuIHJlcztcbiAgfVxuICByZWNhbGN1bGF0ZUludGVyc2VjdGlvbnMod2FsbHM6IFdhbGxbXSk6IHZvaWQge1xuICAgIHRoaXMuaW50ZXJzZWN0aW9uUG9pbnRzID0gdGhpcy5jYWxjdWxhdGVJbnRlcnNlY3Rpb25zKHdhbGxzKTtcbiAgfVxuXG4gIHJlY2FsY3VsYXRlRmFyRW5kKCk6IHZvaWQge1xuICAgIHRoaXMuZmFyRW5kID0gdGhpcy5vcmlnaW4uY29weSgpLmFkZCh0aGlzLmFuZ2xlUmFkcy5jb3B5KCkubXVsdCh3aWR0aCkpO1xuICB9XG5cbiAgZHJhd0xpdExpbmVTZWdtZW50KGE6IHA1LlZlY3RvciwgYjogcDUuVmVjdG9yKTogdm9pZCB7XG4gICAgaWYgKFJheS5pc1JlbmRlckFzQ29id2ViKSB7XG4gICAgICBmb3IgKGxldCBpID0gMDsgaSA8IDIwOyBpKyspIHtcbiAgICAgICAgY29uc3QgcHQgPSBhLmNvcHkoKS5sZXJwKGIsIGkgLyAxMCk7XG4gICAgICAgIHNxdWFyZShwdC54LCBwdC55LCAxKTtcbiAgICAgIH1cbiAgICB9IGVsc2Uge1xuICAgICAgbGluZShhLngsIGEueSwgYi54LCBiLnkpO1xuICAgIH1cbiAgfVxuXG4gIGRyYXdSYXlVbnRpbEZpcnN0SW50ZXJzZWN0aW9uKCk6IHZvaWQge1xuICAgIGNvbnN0IG8gPSB0aGlzLm9yaWdpbjtcbiAgICBjb25zdCBlbmQgPSBvLmNvcHkoKS5hZGQodGhpcy5hbmdsZVJhZHMuY29weSgpLm11bHQoNDApKTtcblxuICAgIC8vZHJhdyB0byBmYXIgKG9mZi1zY3JlZW4pIGVuZFxuICAgIGlmIChSYXkuaXNEcmF3R2hvc3RSYXkpIHtcbiAgICAgIHN0cm9rZSgyNTUsIDI1NSwgMjU1LCAxMCk7XG4gICAgICBzdHJva2VXZWlnaHQoMC4zKTtcbiAgICAgIGxpbmUoby54LCBvLnksIHRoaXMuZmFyRW5kLngsIHRoaXMuZmFyRW5kLnkpO1xuICAgIH1cbiAgICBjb25zdCBuZWFyUHQgPSB0aGlzLm5lYXJlc3RJbnRlcnNlY3Rpb24oKTtcbiAgICBpZiAoUmF5LmlzRHJhd1JheVRvRmlyc3RJbnRlcnNlY3Rpb24pIHtcbiAgICAgIGlmIChuZWFyUHQpIHtcbiAgICAgICAgc3Ryb2tlKFwid2hpdGVcIik7XG4gICAgICAgIHN0cm9rZVdlaWdodCgyKTtcbiAgICAgICAgdGhpcy5kcmF3TGl0TGluZVNlZ21lbnQobywgbmVhclB0KTtcbiAgICAgIH1cbiAgICB9XG5cbiAgICBpZiAoUmF5LmlzRHJhd0ludGVyc2VjdGlvbnMpIHtcbiAgICAgIGZvciAobGV0IGlQdCBvZiB0aGlzLmludGVyc2VjdGlvblBvaW50cykge1xuICAgICAgICBmaWxsKFwiZ3JheVwiKTtcbiAgICAgICAgY2lyY2xlKGlQdC54LCBpUHQueSwgMik7XG4gICAgICB9XG4gICAgICBjb25zdCBmaXJzdCA9IHRoaXMubmVhcmVzdEludGVyc2VjdGlvbigpO1xuICAgICAgaWYgKGZpcnN0KSB7XG4gICAgICAgIGZpbGwoXCJ3aGl0ZVwiKTtcbiAgICAgICAgY2lyY2xlKGZpcnN0LngsIGZpcnN0LnksIDIpO1xuICAgICAgfVxuICAgIH1cbiAgfVxuICBjYW5TZWVQb2ludCh0YXJnZXQ6IHA1LlZlY3Rvcik6IGJvb2xlYW4ge1xuICAgIGNvbnN0IG5lYXJlc3RJc2VjdDogcDUuVmVjdG9yID0gdGhpcy5uZWFyZXN0SW50ZXJzZWN0aW9uKCk7XG4gICAgY29uc3QgZGlzdFRvVGFyZ2V0ID0gdGhpcy5vcmlnaW4uZGlzdCh0YXJnZXQpO1xuICAgIHJldHVybiAhKG5lYXJlc3RJc2VjdCAmJiB0aGlzLm9yaWdpbi5kaXN0KG5lYXJlc3RJc2VjdCkgPCBkaXN0VG9UYXJnZXQpO1xuICB9XG59XG4iLCJjbGFzcyBTdHJ1Y3R1cmUge1xuICBpc0ZpbGxlZFNoYXBlID0gZmFsc2U7XG4gIGNlbnRlcjogcDUuVmVjdG9yO1xuICBhYnN0cmFjdFZlcnRpY2VzOiBwNS5WZWN0b3JbXTtcbiAgd2FsbHM6IFdhbGxbXTtcbiAgbW92ZW1lbnRTcGVlZDogbnVtYmVyO1xuICBteUNvbG9yOiBwNS5Db2xvcjtcbiAgcm90YXRpb246IG51bWJlcjtcbiAgcm90YXRpb25TcGVlZDogbnVtYmVyO1xuXG4gIGNvbnN0cnVjdG9yKGNlbnRlcjogcDUuVmVjdG9yLCByYWRpdXM6IG51bWJlciwgbnVtU2lkZXM6IG51bWJlcikge1xuICAgIHRoaXMucm90YXRpb24gPSByYW5kb20oVFdPX1BJKTtcbiAgICB0aGlzLm15Q29sb3IgPSBQYWxldHRlLnJhbmRvbUNvbG9yKCk7XG4gICAgdGhpcy5tb3ZlbWVudFNwZWVkID0gLXJhbmRvbSgwLjIsIDIpO1xuICAgIHRoaXMucm90YXRpb25TcGVlZCA9IHJhbmRvbSgtMC4wMSwgMC4wMSk7XG4gICAgdGhpcy5hYnN0cmFjdFZlcnRpY2VzID0gdGhpcy5jcmVhdGVWZXJ0aWNlc0ZvclNoYXBlV2l0aE51bVNpZGVzKFxuICAgICAgY2VudGVyLFxuICAgICAgcmFkaXVzLFxuICAgICAgbnVtU2lkZXNcbiAgICApO1xuXG4gICAgdGhpcy53YWxscyA9IHRoaXMubWFrZVdhbGxzRnJvbVZlcnRpY2VzKFxuICAgICAgdGhpcy5hYnN0cmFjdFZlcnRpY2VzLFxuICAgICAgdGhpcy5teUNvbG9yXG4gICAgKTtcbiAgfVxuXG4gIGNyZWF0ZVZlcnRpY2VzRm9yU2hhcGVXaXRoTnVtU2lkZXMoXG4gICAgY2VudGVyOiBwNS5WZWN0b3IsXG4gICAgcmFkaXVzOiBudW1iZXIsXG4gICAgbnVtU2lkZXM6IG51bWJlclxuICApOiBwNS5WZWN0b3JbXSB7XG4gICAgY29uc3QgdmVydGljZXMgPSBbXTtcbiAgICAvL3NwZWNpYWwgY2FzZSBmb3Igc2luZ2xlIHdhbGxcbiAgICBpZiAobnVtU2lkZXMgPT09IDEpIHtcbiAgICAgIGxldCBbYSwgYl0gPSB0aGlzLmNyZWF0ZVJhbmRvbUxpbmVTZWcoKTtcbiAgICAgIHZlcnRpY2VzLnB1c2goYSk7XG4gICAgICB2ZXJ0aWNlcy5wdXNoKGIpO1xuICAgICAgdGhpcy5jZW50ZXIgPSBhLmNvcHkoKS5sZXJwKGIsIDAuNSk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2VudGVyID0gY2VudGVyLmNvcHkoKTtcblxuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1TaWRlczsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGFuZ2xlID0gKGkgKiBUV09fUEkpIC8gbnVtU2lkZXM7XG4gICAgICAgIHZlcnRpY2VzLnB1c2goXG4gICAgICAgICAgcDUuVmVjdG9yLmZyb21BbmdsZShhbmdsZSlcbiAgICAgICAgICAgIC5tdWx0KHJhZGl1cylcbiAgICAgICAgICAgIC5hZGQodGhpcy5jZW50ZXIpXG4gICAgICAgICk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB2ZXJ0aWNlcztcbiAgfVxuICBtYWtlV2FsbHNGcm9tVmVydGljZXModnM6IHA1LlZlY3RvcltdLCBteUNvbG9yOiBwNS5Db2xvcik6IFdhbGxbXSB7XG4gICAgY29uc3Qgd2FsbHM6IFdhbGxbXSA9IFtdO1xuICAgIGlmICh2cy5sZW5ndGggPT09IDIpIHtcbiAgICAgIGNvbnN0IHNpbmdsZVdhbGwgPSBuZXcgV2FsbCh2c1swXSwgdnNbMV0pO1xuICAgICAgc2luZ2xlV2FsbC5teUNvbG9yID0gbXlDb2xvcjtcbiAgICAgIHdhbGxzLnB1c2goc2luZ2xlV2FsbCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IG51bVNpZGVzID0gdnMubGVuZ3RoO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1TaWRlczsgaSsrKSB7XG4gICAgICAgIGNvbnN0IGEgPSB2c1tpXTtcbiAgICAgICAgY29uc3QgYiA9IGkgPT09IG51bVNpZGVzIC0gMSA/IHZzWzBdIDogdnNbaSArIDFdO1xuICAgICAgICBjb25zdCB3YWxsID0gbmV3IFdhbGwoYSwgYik7XG4gICAgICAgIHdhbGwubXlDb2xvciA9IG15Q29sb3I7XG4gICAgICAgIHdhbGxzLnB1c2god2FsbCk7XG4gICAgICB9XG4gICAgfVxuICAgIHJldHVybiB3YWxscztcbiAgfVxuICBjcmVhdGVSYW5kb21MaW5lU2VnKCk6IHA1LlZlY3RvcltdIHtcbiAgICBjb25zdCBwMSA9IHJhbmRvbVNjcmVlblBvc2l0aW9uKCk7XG4gICAgY29uc3QgcDIgPSBwMS5jb3B5KCkuYWRkKHA1LlZlY3Rvci5yYW5kb20yRCgpLm11bHQocmFuZG9tKDQwLCA0MDApKSk7XG4gICAgcmV0dXJuIFtwMSwgcDJdO1xuICB9XG5cbiAgcm90YXRlKGFuZ2xlUmFkOiBudW1iZXIpOiB2b2lkIHtcbiAgICB0aGlzLnJvdGF0aW9uICs9IGFuZ2xlUmFkO1xuICAgIGNvbnN0IHJvdGF0ZWRWZXJ0aWNlcyA9IHRoaXMuYWJzdHJhY3RWZXJ0aWNlcy5tYXAodiA9PlxuICAgICAgcm90YXRlVmVydGV4QXJvdW5kKHYsIHRoaXMuY2VudGVyLCB0aGlzLnJvdGF0aW9uKVxuICAgICk7XG5cbiAgICAvL3JlbWFrZSB0aGUgd2FsbHNcbiAgICB0aGlzLndhbGxzID0gdGhpcy5tYWtlV2FsbHNGcm9tVmVydGljZXMocm90YXRlZFZlcnRpY2VzLCB0aGlzLm15Q29sb3IpO1xuICB9XG5cbiAgdXBkYXRlKCkge1xuICAgIGxldCBtb3ZlQW10OiBudW1iZXIgPSB0aGlzLm1vdmVtZW50U3BlZWQ7XG4gICAgaWYgKHRoaXMuY2VudGVyLnggKyBtb3ZlQW10IDwgMCkge1xuICAgICAgbW92ZUFtdCArPSB3aWR0aDtcbiAgICB9XG4gICAgdGhpcy5jZW50ZXIueCArPSBtb3ZlQW10O1xuICAgIC8vcmVtYWtlIHRoZSB3YWxsc1xuICAgIHRoaXMud2FsbHMgPSB0aGlzLm1ha2VXYWxsc0Zyb21WZXJ0aWNlcyhcbiAgICAgIHRoaXMuYWJzdHJhY3RWZXJ0aWNlcy5tYXAodiA9PiB2LmFkZChjcmVhdGVWZWN0b3IobW92ZUFtdCwgMCkpKSxcbiAgICAgIHRoaXMubXlDb2xvclxuICAgICk7XG5cbiAgICB0aGlzLnJvdGF0ZSh0aGlzLnJvdGF0aW9uU3BlZWQpO1xuICB9XG4gIGRyYXcoKSB7XG4gICAgZm9yIChsZXQgd2FsbCBvZiB0aGlzLndhbGxzKSB7XG4gICAgICB3YWxsLmRyYXcoKTtcbiAgICB9XG4gICAgLy9jaXJjbGUodGhpcy5jZW50ZXIueCwgdGhpcy5jZW50ZXIueSwgNSk7XG4gICAgaWYgKHRoaXMuaXNGaWxsZWRTaGFwZSkge1xuICAgICAgYmVnaW5TaGFwZSgpO1xuICAgICAgZm9yIChsZXQgd2FsbCBvZiB0aGlzLndhbGxzKSB7XG4gICAgICAgIGZvciAobGV0IHB0IG9mIFt3YWxsLmEsIHdhbGwuYl0pIHtcbiAgICAgICAgICB2ZXJ0ZXgocHQueCwgcHQueSk7XG4gICAgICAgIH1cbiAgICAgIH1cbiAgICAgIGVuZFNoYXBlKENMT1NFKTtcbiAgICB9XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlUmFuZG9tKCkge1xuICAgIGNvbnN0IGNlbnRlciA9IHJhbmRvbVNjcmVlblBvc2l0aW9uKCk7XG4gICAgY29uc3QgbnVtU2lkZXMgPSByYW5kb20oWzEsIDEsIDEsIDMsIDQsIDUsIDZdKTtcbiAgICByZXR1cm4gbmV3IFN0cnVjdHVyZShjZW50ZXIsIHJhbmRvbSgyMCwgcmFuZG9tKDEwMCwgMjAwKSksIG51bVNpZGVzKTtcbiAgfVxufVxuIiwiZnVuY3Rpb24gcmVwZWF0KG51bTogbnVtYmVyLCBmbjogKGl4OiBudW1iZXIpID0+IHZvaWQpIHtcbiAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW07IGkrKykge1xuICAgIGZuKGkpO1xuICB9XG59XG5mdW5jdGlvbiByYW5kb21TY3JlZW5Qb3NpdGlvbigpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKHJhbmRvbSh3aWR0aCksIHJhbmRvbShoZWlnaHQpKTtcbn1cblxuZnVuY3Rpb24gcmFuZG9tSW50KG1pbjogbnVtYmVyLCBtYXg6IG51bWJlcik6IG51bWJlciB7XG4gIHJldHVybiByb3VuZChyYW5kb20obWluLCBtYXgpKTtcbn1cblxuZnVuY3Rpb24gdHJhbnNsYXRlVG9WZWMocG9zOiBwNS5WZWN0b3IpOiB2b2lkIHtcbiAgdHJhbnNsYXRlKHBvcy54LCBwb3MueSk7XG59XG5cbmZ1bmN0aW9uIGNlbnRlclBvcygpOiBwNS5WZWN0b3Ige1xuICByZXR1cm4gY3JlYXRlVmVjdG9yKHdpZHRoIC8gMiwgaGVpZ2h0IC8gMik7XG59XG5mdW5jdGlvbiByb3RhdGVWZXJ0ZXhBcm91bmQoXG4gIHZlcnRleDogcDUuVmVjdG9yLFxuICByb3RPcmlnaW46IHA1LlZlY3RvcixcbiAgYW5nbGVSYWQ6IG51bWJlclxuKTogcDUuVmVjdG9yIHtcbiAgcmV0dXJuIHZlcnRleFxuICAgIC5jb3B5KClcbiAgICAuc3ViKHJvdE9yaWdpbilcbiAgICAucm90YXRlKGFuZ2xlUmFkKVxuICAgIC5hZGQocm90T3JpZ2luKTtcbn1cblxuLy9UYWtlbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEXG5mdW5jdGlvbiBjb2xsaWRlTGluZUxpbmUoXG4gIHgxOiBudW1iZXIsXG4gIHkxOiBudW1iZXIsXG4gIHgyOiBudW1iZXIsXG4gIHkyOiBudW1iZXIsXG4gIHgzOiBudW1iZXIsXG4gIHkzOiBudW1iZXIsXG4gIHg0OiBudW1iZXIsXG4gIHk0OiBudW1iZXJcbikge1xuICAvLyBjYWxjdWxhdGUgdGhlIGRpc3RhbmNlIHRvIGludGVyc2VjdGlvbiBwb2ludFxuICBsZXQgdUEgPVxuICAgICgoeDQgLSB4MykgKiAoeTEgLSB5MykgLSAoeTQgLSB5MykgKiAoeDEgLSB4MykpIC9cbiAgICAoKHk0IC0geTMpICogKHgyIC0geDEpIC0gKHg0IC0geDMpICogKHkyIC0geTEpKTtcbiAgbGV0IHVCID1cbiAgICAoKHgyIC0geDEpICogKHkxIC0geTMpIC0gKHkyIC0geTEpICogKHgxIC0geDMpKSAvXG4gICAgKCh5NCAtIHkzKSAqICh4MiAtIHgxKSAtICh4NCAtIHgzKSAqICh5MiAtIHkxKSk7XG5cbiAgLy8gaWYgdUEgYW5kIHVCIGFyZSBiZXR3ZWVuIDAtMSwgbGluZXMgYXJlIGNvbGxpZGluZ1xuICBpZiAodUEgPj0gMCAmJiB1QSA8PSAxICYmIHVCID49IDAgJiYgdUIgPD0gMSkge1xuICAgIC8vIGNhbGMgdGhlIHBvaW50IHdoZXJlIHRoZSBsaW5lcyBtZWV0XG4gICAgbGV0IGludGVyc2VjdGlvblggPSB4MSArIHVBICogKHgyIC0geDEpO1xuICAgIGxldCBpbnRlcnNlY3Rpb25ZID0geTEgKyB1QSAqICh5MiAtIHkxKTtcblxuICAgIHJldHVybiBjcmVhdGVWZWN0b3IoaW50ZXJzZWN0aW9uWCwgaW50ZXJzZWN0aW9uWSk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIG1pbkJ5PFQ+KGxpc3Q6IFRbXSwgZm46IChpdGVtOiBUKSA9PiBudW1iZXIpOiBUIHtcbiAgaWYgKGxpc3QubGVuZ3RoIDwgMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGxldCByZWNvcmRJdGVtID0gbGlzdFswXTtcbiAgbGV0IHJlY29yZFdlaWdodCA9IGZuKGxpc3RbMF0pO1xuICBmb3IgKGxldCBpdGVtIG9mIGxpc3QpIHtcbiAgICBjb25zdCB3ZWlnaHQgPSBmbihpdGVtKTtcbiAgICBpZiAod2VpZ2h0ID4gcmVjb3JkV2VpZ2h0KSB7XG4gICAgICByZWNvcmRXZWlnaHQgPSB3ZWlnaHQ7XG4gICAgICByZWNvcmRJdGVtID0gaXRlbTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlY29yZEl0ZW07XG59XG5cbmZ1bmN0aW9uIGRpc3RyaWJ1dGVVcFRvKHRvdGFsOiBudW1iZXIsIG1heDogbnVtYmVyLCBmbjogKHY6IG51bWJlcikgPT4gdm9pZCkge1xuICByZXBlYXQodG90YWwsIGl4ID0+IHtcbiAgICBjb25zdCB2YWwgPSAoaXggKiBtYXgpIC8gdG90YWw7XG4gICAgZm4odmFsKTtcbiAgfSk7XG59XG4iLCJjbGFzcyBXYWxsIHtcbiAgYTogcDUuVmVjdG9yO1xuICBiOiBwNS5WZWN0b3I7XG5cbiAgbXlDb2xvcjogcDUuQ29sb3I7XG5cbiAgY29uc3RydWN0b3IoYTogcDUuVmVjdG9yLCBiOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLmEgPSBhLmNvcHkoKTtcbiAgICB0aGlzLmIgPSBiLmNvcHkoKTtcbiAgICB0aGlzLm15Q29sb3IgPSBjb2xvcigyNDMsIDEzNCwgNDgpO1xuICB9XG4gIGRyYXcoKSB7XG4gICAgc3Ryb2tlKHRoaXMubXlDb2xvcik7XG4gICAgc3Ryb2tlV2VpZ2h0KDQpO1xuICAgIGxpbmUodGhpcy5hLngsIHRoaXMuYS55LCB0aGlzLmIueCwgdGhpcy5iLnkpO1xuXG4gICAgbm9TdHJva2UoKTtcbiAgICBmaWxsKHRoaXMubXlDb2xvcik7XG4gICAgW3RoaXMuYSwgdGhpcy5iXS5mb3JFYWNoKHB0ID0+IHtcbiAgICAgIC8vY2lyY2xlKHB0LngsIHB0LnksIDUpO1xuICAgIH0pO1xuICB9XG4gIG1pZFBvaW50KCk6IHA1LlZlY3RvciB7XG4gICAgcmV0dXJuIHRoaXMuYS5jb3B5KCkubGVycCh0aGlzLmIsIDAuNSk7XG4gIH1cblxuICBsZW5ndGgoKTogbnVtYmVyIHtcbiAgICByZXR1cm4gZGlzdCh0aGlzLmEueCwgdGhpcy5hLnksIHRoaXMuYi54LCB0aGlzLmIueSk7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlUmFuZG9tKCkge1xuICAgIGNvbnN0IHAxID0gcmFuZG9tU2NyZWVuUG9zaXRpb24oKTtcbiAgICBjb25zdCBwMiA9IHAxLmNvcHkoKS5hZGQocDUuVmVjdG9yLnJhbmRvbTJEKCkubXVsdChyYW5kb20oNDAsIDQwMCkpKTtcbiAgICByZXR1cm4gbmV3IFdhbGwocDEsIHAyKTtcbiAgfVxufVxuIl19