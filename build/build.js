"use strict";
var Agent = (function () {
    function Agent(pos) {
        this.pos = pos.copy();
        this.movementPhase = random(10000);
        this.speed = 1;
        this.ray = new Ray(this.pos, { target: mousePosAsVector() });
    }
    Agent.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
        this.drawAgentCanSeePosition(mousePosAsVector());
    };
    Agent.prototype.drawAgentCanSeePosition = function (targetPos) {
        var o = this.pos;
        noStroke();
        if (this.ray.canSeePoint(targetPos)) {
            fill(0, 0, 0, 20);
            circle(o.x, o.y, 8);
        }
        else {
            var distToTarget = this.pos.dist(targetPos);
            var brightness_1 = map(distToTarget, 0, max(width, height), 255, 0);
            var litColor = color(255, 255, 255, brightness_1);
            fill(litColor);
            circle(o.x, o.y, 8);
        }
    };
    Agent.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Agent.createRandom = function () {
        return new Agent(randomScreenPosition());
    };
    Agent.prototype.updateWithRoaming = function (walls, targetPos) {
        var newPos = null;
        var offset = createVector(0, 0);
        offset.x = map(noise(this.movementPhase + 33333 + frameCount / 100), 0, 1, -1, 1);
        offset.y = map(noise(this.movementPhase + frameCount / 100), 0, 1, -1, 1);
        var attractVec = this.pos
            .copy()
            .sub(targetPos)
            .normalize();
        newPos = this.pos.copy().add(attractVec.mult(this.speed));
        newPos.add(offset);
        this.setPosition(newPos);
        this.ray = new Ray(this.pos, { target: targetPos });
        this.ray.recalculateIntersections(walls);
        var newSpeed = this.speed + (this.ray.canSeePoint(targetPos) ? -0.1 : 0.1);
        if (Math.abs(newSpeed) < 3) {
            this.speed = newSpeed;
        }
    };
    return Agent;
}());
var Particle = (function () {
    function Particle(pos) {
        this.pos = pos.copy();
    }
    Particle.prototype.draw = function () {
        noStroke();
        fill("black");
        rectMode(CENTER);
        square(this.pos.x, this.pos.y, 3);
        fill(0, 20);
    };
    Particle.prototype.update = function () { };
    Particle.prototype.setPosition = function (pos) {
        this.pos.x = pos.x;
        this.pos.y = pos.y;
    };
    Particle.createRandom = function () {
        return new Particle(randomScreenPosition());
    };
    return Particle;
}());
var Ray = (function () {
    function Ray(origin, _a) {
        var _b = _a.angleRads, angleRads = _b === void 0 ? null : _b, _c = _a.target, target = _c === void 0 ? null : _c, _d = _a.walls, walls = _d === void 0 ? [] : _d;
        this.origin = origin.copy();
        if (target !== null) {
            this.lookAt(target);
        }
        else {
            this.angleRads = p5.Vector.fromAngle(angleRads);
        }
        this.intersectionPoints = [];
        this.recalculateFarEnd();
        if (walls.length > 0) {
            this.recalculateIntersections(walls);
        }
    }
    Ray.prototype.lookAt = function (targetPos) {
        var deltaToTarget = targetPos.copy().sub(this.origin);
        var angleToTarget = atan2(deltaToTarget.y, deltaToTarget.x);
        this.angleRads = p5.Vector.fromAngle(angleToTarget);
        this.recalculateFarEnd();
    };
    Ray.createRandom = function () {
        return new Ray(randomScreenPosition(), { angleRads: random(0, TWO_PI) });
    };
    Ray.prototype.intersectionWithWall = function (wall) {
        var answer = collideLineLine(wall.a.x, wall.a.y, wall.b.x, wall.b.y, this.origin.x, this.origin.y, this.farEnd.x, this.farEnd.y);
        return answer;
    };
    Ray.prototype.nearestIntersection = function () {
        var _this = this;
        if (this.intersectionPoints.length > 0) {
            return minBy(this.intersectionPoints, function (pt) { return -_this.origin.dist(pt); });
        }
        else {
            return undefined;
        }
    };
    Ray.prototype.calculateIntersections = function (walls) {
        var res = [];
        for (var _i = 0, walls_1 = walls; _i < walls_1.length; _i++) {
            var wall = walls_1[_i];
            var intersection = this.intersectionWithWall(wall);
            if (intersection) {
                res.push(intersection);
            }
        }
        return res;
    };
    Ray.prototype.recalculateIntersections = function (walls) {
        this.intersectionPoints = this.calculateIntersections(walls);
    };
    Ray.prototype.recalculateFarEnd = function () {
        this.farEnd = this.origin.copy().add(this.angleRads.copy().mult(width));
    };
    Ray.prototype.drawLitLineSegment = function (a, b) {
        if (Ray.isRenderAsCobweb) {
            for (var i = 0; i < 20; i++) {
                var pt = a.copy().lerp(b, i / 10);
                square(pt.x, pt.y, 1);
            }
        }
        else {
            line(a.x, a.y, b.x, b.y);
        }
    };
    Ray.prototype.drawRayUntilFirstIntersection = function () {
        var o = this.origin;
        var end = o.copy().add(this.angleRads.copy().mult(40));
        if (Ray.isDrawGhostRay) {
            stroke(255, 255, 255, 10);
            strokeWeight(0.3);
            line(o.x, o.y, this.farEnd.x, this.farEnd.y);
        }
        var nearPt = this.nearestIntersection();
        if (Ray.isDrawRayToFirstIntersection) {
            if (nearPt) {
                stroke("white");
                strokeWeight(2);
                this.drawLitLineSegment(o, nearPt);
            }
        }
        if (Ray.isDrawIntersections) {
            for (var _i = 0, _a = this.intersectionPoints; _i < _a.length; _i++) {
                var iPt = _a[_i];
                fill("gray");
                circle(iPt.x, iPt.y, 2);
            }
            var first = this.nearestIntersection();
            if (first) {
                fill("white");
                circle(first.x, first.y, 2);
            }
        }
    };
    Ray.prototype.canSeePoint = function (target) {
        var nearestIsect = this.nearestIntersection();
        var distToTarget = this.origin.dist(target);
        return nearestIsect && this.origin.dist(nearestIsect) < distToTarget;
    };
    Ray.isRenderAsCobweb = false;
    Ray.isDrawGhostRay = true;
    Ray.isDrawRayToFirstIntersection = true;
    Ray.isDrawIntersections = false;
    return Ray;
}());
var Structure = (function () {
    function Structure(center, radius, numSides) {
        this.isFilledShape = false;
        var myColor = this.randomColor();
        this.movementSpeed = -random(1, 5);
        if (numSides === 2) {
            var singleWall = Wall.createRandom();
            singleWall.myColor = myColor;
            this.walls = [singleWall];
            this.center = singleWall.midPoint();
        }
        else {
            this.center = center.copy();
            var vertices = [];
            for (var i = 0; i < numSides; i++) {
                var angle = (i * TWO_PI) / numSides;
                vertices.push(p5.Vector.fromAngle(angle)
                    .mult(radius)
                    .add(this.center));
            }
            var walls = [];
            for (var i = 0; i < numSides; i++) {
                var v1 = vertices[i];
                var v2 = i === numSides - 1 ? vertices[0] : vertices[i + 1];
                var wall = new Wall(v1, v2);
                wall.myColor = myColor;
                walls.push(wall);
            }
            this.walls = walls;
        }
    }
    Structure.prototype.randomColor = function () {
        return random([
            color(250, 105, 0),
            color(105, 210, 231),
            color(167, 219, 216),
            color(243, 134, 48)
        ]);
    };
    Structure.prototype.update = function () {
        var move = this.movementSpeed;
        if (this.center.x + move < 0) {
            move += width;
        }
        this.center.x += move;
        for (var _i = 0, _a = this.walls; _i < _a.length; _i++) {
            var wall = _a[_i];
            wall.translate(createVector(move, 0));
        }
    };
    Structure.prototype.draw = function () {
        for (var _i = 0, _a = this.walls; _i < _a.length; _i++) {
            var wall = _a[_i];
            wall.draw();
        }
        if (this.isFilledShape) {
            beginShape();
            for (var _b = 0, _c = this.walls; _b < _c.length; _b++) {
                var wall = _c[_b];
                for (var _d = 0, _e = [wall.a, wall.b]; _d < _e.length; _d++) {
                    var pt = _e[_d];
                    vertex(pt.x, pt.y);
                }
            }
            endShape(CLOSE);
        }
    };
    Structure.createRandom = function () {
        var center = randomScreenPosition();
        var numSides = random([2, 2, 2, 3, 4, 5, 8]);
        return new Structure(center, random(20, random(100, 200)), numSides);
    };
    return Structure;
}());
function repeat(num, fn) {
    for (var i = 0; i < num; i++) {
        fn(i);
    }
}
function randomScreenPosition() {
    return createVector(random(width), random(height));
}
function randomInt(min, max) {
    return round(random(min, max));
}
function translateToVec(pos) {
    translate(pos.x, pos.y);
}
function centerPos() {
    return createVector(width / 2, height / 2);
}
function collideLineLine(x1, y1, x2, y2, x3, y3, x4, y4) {
    var uA = ((x4 - x3) * (y1 - y3) - (y4 - y3) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    var uB = ((x2 - x1) * (y1 - y3) - (y2 - y1) * (x1 - x3)) /
        ((y4 - y3) * (x2 - x1) - (x4 - x3) * (y2 - y1));
    if (uA >= 0 && uA <= 1 && uB >= 0 && uB <= 1) {
        var intersectionX = x1 + uA * (x2 - x1);
        var intersectionY = y1 + uA * (y2 - y1);
        return createVector(intersectionX, intersectionY);
    }
    return null;
}
function minBy(list, fn) {
    if (list.length < 0) {
        return null;
    }
    var recordItem = list[0];
    var recordWeight = fn(list[0]);
    for (var _i = 0, list_1 = list; _i < list_1.length; _i++) {
        var item = list_1[_i];
        var weight = fn(item);
        if (weight > recordWeight) {
            recordWeight = weight;
            recordItem = item;
        }
    }
    return recordItem;
}
function distributeUpTo(total, max, fn) {
    repeat(total, function (ix) {
        var val = (ix * max) / total;
        fn(val);
    });
}
var Wall = (function () {
    function Wall(a, b) {
        this.a = a.copy();
        this.b = b.copy();
        this.myColor = color(243, 134, 48);
    }
    Wall.prototype.draw = function () {
        stroke(this.myColor);
        strokeWeight(4);
        line(this.a.x, this.a.y, this.b.x, this.b.y);
        noStroke();
        fill(this.myColor);
        [this.a, this.b].forEach(function (pt) {
            circle(pt.x, pt.y, 5);
        });
    };
    Wall.prototype.midPoint = function () {
        return this.a.copy().lerp(this.b, 0.5);
    };
    Wall.prototype.length = function () {
        return dist(this.a.x, this.a.y, this.b.x, this.b.y);
    };
    Wall.prototype.translate = function (offset) {
        for (var _i = 0, _a = [this.a, this.b]; _i < _a.length; _i++) {
            var pt = _a[_i];
            pt.x += offset.x;
            pt.y += offset.y;
        }
    };
    Wall.createRandom = function () {
        var p1 = randomScreenPosition();
        var p2 = p1.copy().add(p5.Vector.random2D().mult(random(40, 400)));
        return new Wall(p1, p2);
    };
    return Wall;
}());
p5.disableFriendlyErrors = true;
var isDebugging = false;
var gWalls = [];
var gAgents = [];
var gPlayerRays = [];
var gPlayer = null;
var gNumWalls = 20;
var gNumAgents = 100;
var gNumPlayerRays = 100;
var gNumStructures = 30;
var gStructures = [];
function setup() {
    createCanvas(windowWidth, windowHeight);
    repeat(gNumStructures, function () {
        var structure = Structure.createRandom();
        gStructures.push(structure);
        gWalls = gWalls.concat(structure.walls);
    });
    repeat(gNumAgents, function () {
        gAgents.push(Agent.createRandom());
    });
    gPlayerRays = createRaysAtPosition(gNumPlayerRays, mousePosAsVector());
    gPlayer = Particle.createRandom();
    mouseX = centerPos().x;
    mouseY = centerPos().y;
}
function createRaysAtPosition(numRays, pos) {
    var rays = [];
    distributeUpTo(numRays, TWO_PI, function (val) {
        return rays.push(new Ray(pos, { angleRads: val, walls: gWalls }));
    });
    return rays;
}
function mousePosAsVector() {
    return createVector(mouseX, mouseY);
}
function update() {
    gPlayer.setPosition(mousePosAsVector());
    gPlayer.update();
    for (var _i = 0, gStructures_1 = gStructures; _i < gStructures_1.length; _i++) {
        var s = gStructures_1[_i];
        s.update();
    }
    for (var _a = 0, gAgents_1 = gAgents; _a < gAgents_1.length; _a++) {
        var agent = gAgents_1[_a];
        agent.updateWithRoaming(gWalls, mousePosAsVector());
    }
    gPlayerRays = createRaysAtPosition(gNumPlayerRays, mousePosAsVector());
}
function draw() {
    update();
    background(0);
    fill("black");
    noStroke();
    for (var _i = 0, gStructures_2 = gStructures; _i < gStructures_2.length; _i++) {
        var s = gStructures_2[_i];
        s.draw();
    }
    for (var _a = 0, gWalls_1 = gWalls; _a < gWalls_1.length; _a++) {
        var wall = gWalls_1[_a];
        wall.draw();
    }
    for (var _b = 0, gAgents_2 = gAgents; _b < gAgents_2.length; _b++) {
        var agent = gAgents_2[_b];
        agent.draw();
    }
    for (var _c = 0, gPlayerRays_1 = gPlayerRays; _c < gPlayerRays_1.length; _c++) {
        var ray = gPlayerRays_1[_c];
        ray.drawRayUntilFirstIntersection();
    }
    gPlayer.draw();
}
//# sourceMappingURL=data:application/json;base64,eyJ2ZXJzaW9uIjozLCJmaWxlIjoiYnVpbGQuanMiLCJzb3VyY2VSb290IjoiLi9qcy8iLCJzb3VyY2VzIjpbImluZGV4LnRzIiwiQWdlbnQudHMiLCJQYXJ0aWNsZS50cyIsIlJheS50cyIsIlN0cnVjdHVyZS50cyIsIlV0aWxzLnRzIiwiV2FsbC50cyJdLCJuYW1lcyI6W10sIm1hcHBpbmdzIjoiQUFBQSxZQUFZLENBQUM7QUNBYjtJQU1FLGVBQVksR0FBYztRQUN4QixJQUFJLENBQUMsR0FBRyxHQUFHLEdBQUcsQ0FBQyxJQUFJLEVBQUUsQ0FBQztRQUN0QixJQUFJLENBQUMsYUFBYSxHQUFHLE1BQU0sQ0FBQyxLQUFLLENBQUMsQ0FBQztRQUNuQyxJQUFJLENBQUMsS0FBSyxHQUFHLENBQUMsQ0FBQztRQUNmLElBQUksQ0FBQyxHQUFHLEdBQUcsSUFBSSxHQUFHLENBQUMsSUFBSSxDQUFDLEdBQUcsRUFBRSxFQUFFLE1BQU0sRUFBRSxnQkFBZ0IsRUFBRSxFQUFFLENBQUMsQ0FBQztJQUMvRCxDQUFDO0lBRUQsb0JBQUksR0FBSjtRQUNFLFFBQVEsRUFBRSxDQUFDO1FBQ1gsSUFBSSxDQUFDLE9BQU8sQ0FBQyxDQUFDO1FBQ2QsUUFBUSxDQUFDLE1BQU0sQ0FBQyxDQUFDO1FBQ2pCLE1BQU0sQ0FBQyxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxJQUFJLENBQUMsR0FBRyxDQUFDLENBQUMsRUFBRSxDQUFDLENBQUMsQ0FBQztRQUNsQyxJQUFJLENBQUMsQ0FBQyxFQUFFLEVBQUUsQ0FBQyxDQUFDO1FBRVosSUFBSSxDQUFDLHVCQUF1QixDQUFDLGdCQUFnQixFQUFFLENBQUMsQ0FBQztJQUNuRCxDQUFDO0lBRUQsdUNBQXVCLEdBQXZCLFVBQXdCLFNBQW9CO1FBQzFDLElBQU0sQ0FBQyxHQUFHLElBQUksQ0FBQyxHQUFHLENBQUM7UUFHbkIsUUFBUSxFQUFFLENBQUM7UUFDWCxJQUFJLElBQUksQ0FBQyxHQUFHLENBQUMsV0FBVyxDQUFDLFNBQVMsQ0FBQyxFQUFFO1lBQ25DLElBQUks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QUMsQ0FBQztLQUNyRDtJQUVELFdBQVcsR0FBRyxvQkFBb0IsQ0FBQyxjQUFjLEVBQUUsZ0JBQWdCLEVBQUUsQ0FBQyxDQUFDO0FBQ3pFLENBQUM7QUFJRCxTQUFTLElBQUk7SUFDWCxNQUFNLEVBQUUsQ0FBQztJQUNULFVBQVUsQ0FBQyxDQUFDLENBQUMsQ0FBQztJQUNkLElBQUksQ0FBQyxPQUFPLENBQUMsQ0FBQztJQUNkLFFBQVEsRUFBRSxDQUFDO0lBRVgsS0FBYyxVQUFXLEVBQVgsMkJBQVcsRUFBWCx5QkFBVyxFQUFYLElBQVcsRUFBRTtRQUF0QixJQUFJLENBQUMsb0JBQUE7UUFDUixDQUFDLENBQUMsSUFBSSxFQUFFLENBQUM7S0FDVjtJQUNELEtBQWlCLFVBQU0sRUFBTixpQkFBTSxFQUFOLG9CQUFNLEVBQU4sSUFBTSxFQUFFO1FBQXBCLElBQUksSUFBSSxlQUFBO1FBQ1gsSUFBSSxDQUFDLElBQUksRUFBRSxDQUFDO0tBQ2I7SUFDRCxLQUFrQixVQUFPLEVBQVAsbUJBQU8sRUFBUCxxQkFBTyxFQUFQLElBQU8sRUFBRTtRQUF0QixJQUFJLEtBQUssZ0JBQUE7UUFDWixLQUFLLENBQUMsSUFBSSxFQUFFLENBQUM7S0FDZDtJQUNELEtBQWdCLFVBQVcsRUFBWCwyQkFBVyxFQUFYLHlCQUFXLEVBQVgsSUFBVyxFQUFFO1FBQXhCLElBQUksR0FBRyxvQkFBQTtRQUNWLEdBQUcsQ0FBQyw2QkFBNkIsRUFBRSxDQUFDO0tBQ3JDO0lBQ0QsT0FBTyxDQUFDLElBQUksRUFBRSxDQUFDO0FBQ2pCLENBQUMiLCJzb3VyY2VzQ29udGVudCI6WyJcInVzZSBzdHJpY3RcIjtcblxucDUuZGlzYWJsZUZyaWVuZGx5RXJyb3JzID0gdHJ1ZTtcbmNvbnN0IGlzRGVidWdnaW5nID0gZmFsc2U7XG5sZXQgZ1dhbGxzOiBXYWxsW10gPSBbXTtcbmxldCBnQWdlbnRzOiBBZ2VudFtdID0gW107XG5sZXQgZ1BsYXllclJheXM6IFJheVtdID0gW107XG5sZXQgZ1BsYXllcjogUGFydGljbGUgPSBudWxsO1xubGV0IGdOdW1XYWxsczogbnVtYmVyID0gMjA7XG5sZXQgZ051bUFnZW50czogbnVtYmVyID0gMTAwO1xubGV0IGdOdW1QbGF5ZXJSYXlzOiBudW1iZXIgPSAxMDA7XG5sZXQgZ051bVN0cnVjdHVyZXMgPSAzMDtcbi8qIC0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLS0tLVxuICogU0VUVVBcbiAqL1xuY29uc3QgZ1N0cnVjdHVyZXM6IFN0cnVjdHVyZVtdID0gW107XG5mdW5jdGlvbiBzZXR1cCgpIHtcbiAgY3JlYXRlQ2FudmFzKHdpbmRvd1dpZHRoLCB3aW5kb3dIZWlnaHQpO1xuXG4gIHJlcGVhdChnTnVtU3RydWN0dXJlcywgKCkgPT4ge1xuICAgIGNvbnN0IHN0cnVjdHVyZSA9IFN0cnVjdHVyZS5jcmVhdGVSYW5kb20oKTtcbiAgICBnU3RydWN0dXJlcy5wdXNoKHN0cnVjdHVyZSk7XG4gICAgZ1dhbGxzID0gZ1dhbGxzLmNvbmNhdChzdHJ1Y3R1cmUud2FsbHMpO1xuICB9KTtcblxuICByZXBlYXQoZ051bUFnZW50cywgKCkgPT4ge1xuICAgIGdBZ2VudHMucHVzaChBZ2VudC5jcmVhdGVSYW5kb20oKSk7XG4gIH0pO1xuXG4gIGdQbGF5ZXJSYXlzID0gY3JlYXRlUmF5c0F0UG9zaXRpb24oZ051bVBsYXllclJheXMsIG1vdXNlUG9zQXNWZWN0b3IoKSk7XG5cbiAgZ1BsYXllciA9IFBhcnRpY2xlLmNyZWF0ZVJhbmRvbSgpO1xuICBtb3VzZVggPSBjZW50ZXJQb3MoKS54O1xuICBtb3VzZVkgPSBjZW50ZXJQb3MoKS55O1xufVxuXG5mdW5jdGlvbiBjcmVhdGVSYXlzQXRQb3NpdGlvbihudW1SYXlzOiBudW1iZXIsIHBvczogcDUuVmVjdG9yKSB7XG4gIGNvbnN0IHJheXM6IFJheVtdID0gW107XG4gIGRpc3RyaWJ1dGVVcFRvKG51bVJheXMsIFRXT19QSSwgdmFsID0+XG4gICAgcmF5cy5wdXNoKG5ldyBSYXkocG9zLCB7IGFuZ2xlUmFkczogdmFsLCB3YWxsczogZ1dhbGxzIH0pKVxuICApO1xuICByZXR1cm4gcmF5cztcbn1cblxuZnVuY3Rpb24gbW91c2VQb3NBc1ZlY3RvcigpIHtcbiAgcmV0dXJuIGNyZWF0ZVZlY3Rvcihtb3VzZVgsIG1vdXNlWSk7XG59XG5mdW5jdGlvbiB1cGRhdGUoKSB7XG4gIGdQbGF5ZXIuc2V0UG9zaXRpb24obW91c2VQb3NBc1ZlY3RvcigpKTtcbiAgZ1BsYXllci51cGRhdGUoKTtcblxuICBmb3IgKGxldCBzIG9mIGdTdHJ1Y3R1cmVzKSB7XG4gICAgcy51cGRhdGUoKTtcbiAgfVxuICBmb3IgKGxldCBhZ2VudCBvZiBnQWdlbnRzKSB7XG4gICAgYWdlbnQudXBkYXRlV2l0aFJvYW1pbmcoZ1dhbGxzLCBtb3VzZVBvc0FzVmVjdG9yKCkpO1xuICB9XG5cbiAgZ1BsYXllclJheXMgPSBjcmVhdGVSYXlzQXRQb3NpdGlvbihnTnVtUGxheWVyUmF5cywgbW91c2VQb3NBc1ZlY3RvcigpKTtcbn1cbi8qXG4gKiBEUkFXXG4gKi9cbmZ1bmN0aW9uIGRyYXcoKSB7XG4gIHVwZGF0ZSgpO1xuICBiYWNrZ3JvdW5kKDApO1xuICBmaWxsKFwiYmxhY2tcIik7XG4gIG5vU3Ryb2tlKCk7XG5cbiAgZm9yIChsZXQgcyBvZiBnU3RydWN0dXJlcykge1xuICAgIHMuZHJhdygpO1xuICB9XG4gIGZvciAobGV0IHdhbGwgb2YgZ1dhbGxzKSB7XG4gICAgd2FsbC5kcmF3KCk7XG4gIH1cbiAgZm9yIChsZXQgYWdlbnQgb2YgZ0FnZW50cykge1xuICAgIGFnZW50LmRyYXcoKTtcbiAgfVxuICBmb3IgKGxldCByYXkgb2YgZ1BsYXllclJheXMpIHtcbiAgICByYXkuZHJhd1JheVVudGlsRmlyc3RJbnRlcnNlY3Rpb24oKTtcbiAgfVxuICBnUGxheWVyLmRyYXcoKTtcbn1cbiIsImNsYXNzIEFnZW50IHtcbiAgcG9zOiBwNS5WZWN0b3I7XG4gIG1vdmVtZW50UGhhc2U6IG51bWJlcjtcbiAgc3BlZWQ6IG51bWJlcjtcbiAgcmF5OiBSYXk7XG5cbiAgY29uc3RydWN0b3IocG9zOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLnBvcyA9IHBvcy5jb3B5KCk7XG4gICAgdGhpcy5tb3ZlbWVudFBoYXNlID0gcmFuZG9tKDEwMDAwKTtcbiAgICB0aGlzLnNwZWVkID0gMTtcbiAgICB0aGlzLnJheSA9IG5ldyBSYXkodGhpcy5wb3MsIHsgdGFyZ2V0OiBtb3VzZVBvc0FzVmVjdG9yKCkgfSk7XG4gIH1cblxuICBkcmF3KCkge1xuICAgIG5vU3Ryb2tlKCk7XG4gICAgZmlsbChcImJsYWNrXCIpO1xuICAgIHJlY3RNb2RlKENFTlRFUik7XG4gICAgc3F1YXJlKHRoaXMucG9zLngsIHRoaXMucG9zLnksIDMpO1xuICAgIGZpbGwoMCwgMjApO1xuXG4gICAgdGhpcy5kcmF3QWdlbnRDYW5TZWVQb3NpdGlvbihtb3VzZVBvc0FzVmVjdG9yKCkpO1xuICB9XG5cbiAgZHJhd0FnZW50Q2FuU2VlUG9zaXRpb24odGFyZ2V0UG9zOiBwNS5WZWN0b3IpIHtcbiAgICBjb25zdCBvID0gdGhpcy5wb3M7XG5cbiAgICAvL2RyYXcgYWdlbnQgc3ByaXRlIChhIGNpcmNsZSkgYWNjb3JkaW5nIHRvIHdoZXRoZXIgaXQgaGFzIGwuby5zLiB0byB0YXJnZXRQb3NcbiAgICBub1N0cm9rZSgpO1xuICAgIGlmICh0aGlzLnJheS5jYW5TZWVQb2ludCh0YXJnZXRQb3MpKSB7XG4gICAgICBmaWxsKDAsIDAsIDAsIDIwKTtcbiAgICAgIGNpcmNsZShvLngsIG8ueSwgOCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIGNvbnN0IGRpc3RUb1RhcmdldCA9IHRoaXMucG9zLmRpc3QodGFyZ2V0UG9zKTtcbiAgICAgIGNvbnN0IGJyaWdodG5lc3MgPSBtYXAoZGlzdFRvVGFyZ2V0LCAwLCBtYXgod2lkdGgsIGhlaWdodCksIDI1NSwgMCk7XG4gICAgICBjb25zdCBsaXRDb2xvcjogcDUuQ29sb3IgPSBjb2xvcigyNTUsIDI1NSwgMjU1LCBicmlnaHRuZXNzKTtcbiAgICAgIGZpbGwobGl0Q29sb3IpO1xuICAgICAgY2lyY2xlKG8ueCwgby55LCA4KTtcbiAgICB9XG4gIH1cblxuICBzZXRQb3NpdGlvbihwb3M6IHA1LlZlY3Rvcikge1xuICAgIHRoaXMucG9zLnggPSBwb3MueDtcbiAgICB0aGlzLnBvcy55ID0gcG9zLnk7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlUmFuZG9tKCkge1xuICAgIHJldHVybiBuZXcgQWdlbnQocmFuZG9tU2NyZWVuUG9zaXRpb24oKSk7XG4gIH1cblxuICB1cGRhdGVXaXRoUm9hbWluZyh3YWxsczogV2FsbFtdLCB0YXJnZXRQb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICAgIGxldCBuZXdQb3M6IHA1LlZlY3RvciA9IG51bGw7XG5cbiAgICBjb25zdCBvZmZzZXQgPSBjcmVhdGVWZWN0b3IoMCwgMCk7XG4gICAgb2Zmc2V0LnggPSBtYXAoXG4gICAgICBub2lzZSh0aGlzLm1vdmVtZW50UGhhc2UgKyAzMzMzMyArIGZyYW1lQ291bnQgLyAxMDApLFxuICAgICAgMCxcbiAgICAgIDEsXG4gICAgICAtMSxcbiAgICAgIDFcbiAgICApO1xuICAgIG9mZnNldC55ID0gbWFwKG5vaXNlKHRoaXMubW92ZW1lbnRQaGFzZSArIGZyYW1lQ291bnQgLyAxMDApLCAwLCAxLCAtMSwgMSk7XG5cbiAgICBjb25zdCBhdHRyYWN0VmVjID0gdGhpcy5wb3NcbiAgICAgIC5jb3B5KClcbiAgICAgIC5zdWIodGFyZ2V0UG9zKVxuICAgICAgLm5vcm1hbGl6ZSgpO1xuICAgIG5ld1BvcyA9IHRoaXMucG9zLmNvcHkoKS5hZGQoYXR0cmFjdFZlYy5tdWx0KHRoaXMuc3BlZWQpKTtcblxuICAgIG5ld1Bvcy5hZGQob2Zmc2V0KTtcblxuICAgIHRoaXMuc2V0UG9zaXRpb24obmV3UG9zKTtcbiAgICB0aGlzLnJheSA9IG5ldyBSYXkodGhpcy5wb3MsIHsgdGFyZ2V0OiB0YXJnZXRQb3MgfSk7XG4gICAgdGhpcy5yYXkucmVjYWxjdWxhdGVJbnRlcnNlY3Rpb25zKHdhbGxzKTtcblxuICAgIGNvbnN0IG5ld1NwZWVkID1cbiAgICAgIHRoaXMuc3BlZWQgKyAodGhpcy5yYXkuY2FuU2VlUG9pbnQodGFyZ2V0UG9zKSA/IC0wLjEgOiAwLjEpO1xuICAgIGlmIChNYXRoLmFicyhuZXdTcGVlZCkgPCAzKSB7XG4gICAgICB0aGlzLnNwZWVkID0gbmV3U3BlZWQ7XG4gICAgfVxuICB9XG59XG4iLCJjbGFzcyBQYXJ0aWNsZSB7XG4gIHBvczogcDUuVmVjdG9yO1xuXG4gIGNvbnN0cnVjdG9yKHBvczogcDUuVmVjdG9yKSB7XG4gICAgdGhpcy5wb3MgPSBwb3MuY29weSgpO1xuICB9XG4gIGRyYXcoKSB7XG4gICAgbm9TdHJva2UoKTtcbiAgICBmaWxsKFwiYmxhY2tcIik7XG4gICAgcmVjdE1vZGUoQ0VOVEVSKTtcbiAgICBzcXVhcmUodGhpcy5wb3MueCwgdGhpcy5wb3MueSwgMyk7XG4gICAgZmlsbCgwLCAyMCk7XG4gIH1cbiAgdXBkYXRlKCkge31cblxuICBzZXRQb3NpdGlvbihwb3M6IHA1LlZlY3Rvcikge1xuICAgIHRoaXMucG9zLnggPSBwb3MueDtcbiAgICB0aGlzLnBvcy55ID0gcG9zLnk7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlUmFuZG9tKCkge1xuICAgIHJldHVybiBuZXcgUGFydGljbGUocmFuZG9tU2NyZWVuUG9zaXRpb24oKSk7XG4gIH1cbn1cbiIsImludGVyZmFjZSBSYXlPcHRpb25zIHtcbiAgYW5nbGVSYWRzPzogbnVtYmVyO1xuICB0YXJnZXQ/OiBwNS5WZWN0b3I7IC8vVE9ETzogZXhhY3RseSBvbmUgb2YgdGFyZ2V0IGFuZCBhbmdsZVJhZHMgaXMgcmVxdWlyZWQuXG4gIHdhbGxzPzogV2FsbFtdO1xufVxuY2xhc3MgUmF5IHtcbiAgLy9UT0RPOiBzcGxpdCB0aGlzIG91dCBpbnRvIGFuIGFnZW50IHdoaWNoIGhhcyBhbiBvcmlnaW4gYW5kIGEgcmF5LCB3aXRoIHRoZSByYXkgaGFuZGxpbmcgb25seSBoYW5kbGluZyBkZWNpZGluZyBsaW5lIG9mIHNpZ2h0IGFuZCBpbnRlcnNlY3Rpb24gcG9pbnRzLlxuICBzdGF0aWMgaXNSZW5kZXJBc0NvYndlYiA9IGZhbHNlO1xuICBzdGF0aWMgaXNEcmF3R2hvc3RSYXk6IGJvb2xlYW4gPSB0cnVlO1xuICBzdGF0aWMgaXNEcmF3UmF5VG9GaXJzdEludGVyc2VjdGlvbjogYm9vbGVhbiA9IHRydWU7XG4gIHN0YXRpYyBpc0RyYXdJbnRlcnNlY3Rpb25zOiBib29sZWFuID0gZmFsc2U7XG5cbiAgb3JpZ2luOiBwNS5WZWN0b3I7XG5cbiAgLy9yYXkgaXMgY29uY2VwdHVhbGx5IGluZmluaXRlIGxlbmd0aCB3aXRoIG9ubHkgb25lIGVuZCwgYnV0IHRoaXMgaGFjayBpcyB1c2VmdWwgZm9yIGludGVyc2VjdGlvbiBhbmQgcmVuZGVyaW5nLlxuICBmYXJFbmQ6IHA1LlZlY3RvcjsgLy9hIGhhY2suICBvZmZzY3JlZW4gXCJmYXIgZW5kXCIuXG5cbiAgYW5nbGVSYWRzOiBwNS5WZWN0b3I7XG4gIGludGVyc2VjdGlvblBvaW50czogcDUuVmVjdG9yW107XG5cbiAgY29uc3RydWN0b3IoXG4gICAgb3JpZ2luOiBwNS5WZWN0b3IsXG4gICAgeyBhbmdsZVJhZHMgPSBudWxsLCB0YXJnZXQgPSBudWxsLCB3YWxscyA9IFtdIH06IFJheU9wdGlvbnNcbiAgKSB7XG4gICAgdGhpcy5vcmlnaW4gPSBvcmlnaW4uY29weSgpO1xuICAgIGlmICh0YXJnZXQgIT09IG51bGwpIHtcbiAgICAgIHRoaXMubG9va0F0KHRhcmdldCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuYW5nbGVSYWRzID0gcDUuVmVjdG9yLmZyb21BbmdsZShhbmdsZVJhZHMpO1xuICAgIH1cbiAgICB0aGlzLmludGVyc2VjdGlvblBvaW50cyA9IFtdO1xuICAgIHRoaXMucmVjYWxjdWxhdGVGYXJFbmQoKTtcbiAgICBpZiAod2FsbHMubGVuZ3RoID4gMCkge1xuICAgICAgdGhpcy5yZWNhbGN1bGF0ZUludGVyc2VjdGlvbnMod2FsbHMpO1xuICAgIH1cbiAgfVxuXG4gIGxvb2tBdCh0YXJnZXRQb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICAgIGNvbnN0IGRlbHRhVG9UYXJnZXQgPSB0YXJnZXRQb3MuY29weSgpLnN1Yih0aGlzLm9yaWdpbik7XG4gICAgLy9ub3RlOiBwYXJhbSBvcmRlcjogeSB0aGVuIHhcbiAgICBjb25zdCBhbmdsZVRvVGFyZ2V0ID0gYXRhbjIoZGVsdGFUb1RhcmdldC55LCBkZWx0YVRvVGFyZ2V0LngpO1xuICAgIHRoaXMuYW5nbGVSYWRzID0gcDUuVmVjdG9yLmZyb21BbmdsZShhbmdsZVRvVGFyZ2V0KTtcbiAgICB0aGlzLnJlY2FsY3VsYXRlRmFyRW5kKCk7XG4gIH1cblxuICBzdGF0aWMgY3JlYXRlUmFuZG9tKCk6IFJheSB7XG4gICAgcmV0dXJuIG5ldyBSYXkocmFuZG9tU2NyZWVuUG9zaXRpb24oKSwgeyBhbmdsZVJhZHM6IHJhbmRvbSgwLCBUV09fUEkpIH0pO1xuICB9XG4gIGludGVyc2VjdGlvbldpdGhXYWxsKHdhbGw6IFdhbGwpOiBwNS5WZWN0b3Ige1xuICAgIC8vVE9ETzogY3VzdG9taXNlIGEgZm4gdG8gY29sbGlkZUxpbmVTZWdXaXRoUmF5LFxuICAgIC8vcmF0aGVyIHRoYW4gTGluZVNlZyB3aXRoIExpbmVTZWdcbiAgICBjb25zdCBhbnN3ZXIgPSBjb2xsaWRlTGluZUxpbmUoXG4gICAgICB3YWxsLmEueCxcbiAgICAgIHdhbGwuYS55LFxuICAgICAgd2FsbC5iLngsXG4gICAgICB3YWxsLmIueSxcbiAgICAgIHRoaXMub3JpZ2luLngsXG4gICAgICB0aGlzLm9yaWdpbi55LFxuICAgICAgdGhpcy5mYXJFbmQueCxcbiAgICAgIHRoaXMuZmFyRW5kLnlcbiAgICApO1xuXG4gICAgcmV0dXJuIGFuc3dlcjtcbiAgfVxuXG4gIG5lYXJlc3RJbnRlcnNlY3Rpb24oKTogcDUuVmVjdG9yIHtcbiAgICBpZiAodGhpcy5pbnRlcnNlY3Rpb25Qb2ludHMubGVuZ3RoID4gMCkge1xuICAgICAgcmV0dXJuIG1pbkJ5KFxuICAgICAgICB0aGlzLmludGVyc2VjdGlvblBvaW50cyxcbiAgICAgICAgKHB0OiBwNS5WZWN0b3IpID0+IC10aGlzLm9yaWdpbi5kaXN0KHB0KVxuICAgICAgKTtcbiAgICB9IGVsc2Uge1xuICAgICAgcmV0dXJuIHVuZGVmaW5lZDtcbiAgICB9XG4gIH1cbiAgY2FsY3VsYXRlSW50ZXJzZWN0aW9ucyh3YWxsczogV2FsbFtdKTogcDUuVmVjdG9yW10ge1xuICAgIGNvbnN0IHJlczogcDUuVmVjdG9yW10gPSBbXTtcbiAgICBmb3IgKGxldCB3YWxsIG9mIHdhbGxzKSB7XG4gICAgICBjb25zdCBpbnRlcnNlY3Rpb24gPSB0aGlzLmludGVyc2VjdGlvbldpdGhXYWxsKHdhbGwpO1xuICAgICAgaWYgKGludGVyc2VjdGlvbikge1xuICAgICAgICByZXMucHVzaChpbnRlcnNlY3Rpb24pO1xuICAgICAgfVxuICAgIH1cbiAgICByZXR1cm4gcmVzO1xuICB9XG4gIHJlY2FsY3VsYXRlSW50ZXJzZWN0aW9ucyh3YWxsczogV2FsbFtdKTogdm9pZCB7XG4gICAgdGhpcy5pbnRlcnNlY3Rpb25Qb2ludHMgPSB0aGlzLmNhbGN1bGF0ZUludGVyc2VjdGlvbnMod2FsbHMpO1xuICB9XG5cbiAgcmVjYWxjdWxhdGVGYXJFbmQoKTogdm9pZCB7XG4gICAgdGhpcy5mYXJFbmQgPSB0aGlzLm9yaWdpbi5jb3B5KCkuYWRkKHRoaXMuYW5nbGVSYWRzLmNvcHkoKS5tdWx0KHdpZHRoKSk7XG4gIH1cblxuICBkcmF3TGl0TGluZVNlZ21lbnQoYTogcDUuVmVjdG9yLCBiOiBwNS5WZWN0b3IpOiB2b2lkIHtcbiAgICBpZiAoUmF5LmlzUmVuZGVyQXNDb2J3ZWIpIHtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgMjA7IGkrKykge1xuICAgICAgICBjb25zdCBwdCA9IGEuY29weSgpLmxlcnAoYiwgaSAvIDEwKTtcbiAgICAgICAgc3F1YXJlKHB0LngsIHB0LnksIDEpO1xuICAgICAgfVxuICAgIH0gZWxzZSB7XG4gICAgICBsaW5lKGEueCwgYS55LCBiLngsIGIueSk7XG4gICAgfVxuICB9XG5cbiAgZHJhd1JheVVudGlsRmlyc3RJbnRlcnNlY3Rpb24oKTogdm9pZCB7XG4gICAgY29uc3QgbyA9IHRoaXMub3JpZ2luO1xuICAgIGNvbnN0IGVuZCA9IG8uY29weSgpLmFkZCh0aGlzLmFuZ2xlUmFkcy5jb3B5KCkubXVsdCg0MCkpO1xuXG4gICAgLy9kcmF3IHRvIGZhciAob2ZmLXNjcmVlbikgZW5kXG4gICAgaWYgKFJheS5pc0RyYXdHaG9zdFJheSkge1xuICAgICAgc3Ryb2tlKDI1NSwgMjU1LCAyNTUsIDEwKTtcbiAgICAgIHN0cm9rZVdlaWdodCgwLjMpO1xuICAgICAgbGluZShvLngsIG8ueSwgdGhpcy5mYXJFbmQueCwgdGhpcy5mYXJFbmQueSk7XG4gICAgfVxuICAgIGNvbnN0IG5lYXJQdCA9IHRoaXMubmVhcmVzdEludGVyc2VjdGlvbigpO1xuICAgIGlmIChSYXkuaXNEcmF3UmF5VG9GaXJzdEludGVyc2VjdGlvbikge1xuICAgICAgaWYgKG5lYXJQdCkge1xuICAgICAgICBzdHJva2UoXCJ3aGl0ZVwiKTtcbiAgICAgICAgc3Ryb2tlV2VpZ2h0KDIpO1xuICAgICAgICB0aGlzLmRyYXdMaXRMaW5lU2VnbWVudChvLCBuZWFyUHQpO1xuICAgICAgfVxuICAgIH1cblxuICAgIGlmIChSYXkuaXNEcmF3SW50ZXJzZWN0aW9ucykge1xuICAgICAgZm9yIChsZXQgaVB0IG9mIHRoaXMuaW50ZXJzZWN0aW9uUG9pbnRzKSB7XG4gICAgICAgIGZpbGwoXCJncmF5XCIpO1xuICAgICAgICBjaXJjbGUoaVB0LngsIGlQdC55LCAyKTtcbiAgICAgIH1cbiAgICAgIGNvbnN0IGZpcnN0ID0gdGhpcy5uZWFyZXN0SW50ZXJzZWN0aW9uKCk7XG4gICAgICBpZiAoZmlyc3QpIHtcbiAgICAgICAgZmlsbChcIndoaXRlXCIpO1xuICAgICAgICBjaXJjbGUoZmlyc3QueCwgZmlyc3QueSwgMik7XG4gICAgICB9XG4gICAgfVxuICB9XG4gIGNhblNlZVBvaW50KHRhcmdldDogcDUuVmVjdG9yKTogYm9vbGVhbiB7XG4gICAgY29uc3QgbmVhcmVzdElzZWN0OiBwNS5WZWN0b3IgPSB0aGlzLm5lYXJlc3RJbnRlcnNlY3Rpb24oKTtcbiAgICBjb25zdCBkaXN0VG9UYXJnZXQgPSB0aGlzLm9yaWdpbi5kaXN0KHRhcmdldCk7XG4gICAgcmV0dXJuIG5lYXJlc3RJc2VjdCAmJiB0aGlzLm9yaWdpbi5kaXN0KG5lYXJlc3RJc2VjdCkgPCBkaXN0VG9UYXJnZXQ7XG4gIH1cbn1cbiIsImNsYXNzIFN0cnVjdHVyZSB7XG4gIHJhbmRvbUNvbG9yKCk6IHA1LkNvbG9yIHtcbiAgICByZXR1cm4gcmFuZG9tKFtcbiAgICAgIGNvbG9yKDI1MCwgMTA1LCAwKSxcbiAgICAgIGNvbG9yKDEwNSwgMjEwLCAyMzEpLFxuICAgICAgY29sb3IoMTY3LCAyMTksIDIxNiksXG4gICAgICBjb2xvcigyNDMsIDEzNCwgNDgpXG4gICAgXSk7XG4gIH1cbiAgaXNGaWxsZWRTaGFwZSA9IGZhbHNlO1xuICBjZW50ZXI6IHA1LlZlY3RvcjtcbiAgd2FsbHM6IFdhbGxbXTtcbiAgbW92ZW1lbnRTcGVlZDogbnVtYmVyO1xuICBjb25zdHJ1Y3RvcihjZW50ZXI6IHA1LlZlY3RvciwgcmFkaXVzOiBudW1iZXIsIG51bVNpZGVzOiBudW1iZXIpIHtcbiAgICBjb25zdCBteUNvbG9yID0gdGhpcy5yYW5kb21Db2xvcigpO1xuICAgIHRoaXMubW92ZW1lbnRTcGVlZCA9IC1yYW5kb20oMSwgNSk7XG4gICAgaWYgKG51bVNpZGVzID09PSAyKSB7XG4gICAgICBjb25zdCBzaW5nbGVXYWxsID0gV2FsbC5jcmVhdGVSYW5kb20oKTtcbiAgICAgIHNpbmdsZVdhbGwubXlDb2xvciA9IG15Q29sb3I7XG4gICAgICB0aGlzLndhbGxzID0gW3NpbmdsZVdhbGxdO1xuICAgICAgdGhpcy5jZW50ZXIgPSBzaW5nbGVXYWxsLm1pZFBvaW50KCk7XG4gICAgfSBlbHNlIHtcbiAgICAgIHRoaXMuY2VudGVyID0gY2VudGVyLmNvcHkoKTtcblxuICAgICAgY29uc3QgdmVydGljZXMgPSBbXTtcbiAgICAgIGZvciAobGV0IGkgPSAwOyBpIDwgbnVtU2lkZXM7IGkrKykge1xuICAgICAgICBjb25zdCBhbmdsZSA9IChpICogVFdPX1BJKSAvIG51bVNpZGVzO1xuICAgICAgICB2ZXJ0aWNlcy5wdXNoKFxuICAgICAgICAgIHA1LlZlY3Rvci5mcm9tQW5nbGUoYW5nbGUpXG4gICAgICAgICAgICAubXVsdChyYWRpdXMpXG4gICAgICAgICAgICAuYWRkKHRoaXMuY2VudGVyKVxuICAgICAgICApO1xuICAgICAgfVxuICAgICAgY29uc3Qgd2FsbHM6IFdhbGxbXSA9IFtdO1xuICAgICAgZm9yIChsZXQgaSA9IDA7IGkgPCBudW1TaWRlczsgaSsrKSB7XG4gICAgICAgIGNvbnN0IHYxID0gdmVydGljZXNbaV07XG4gICAgICAgIGNvbnN0IHYyID0gaSA9PT0gbnVtU2lkZXMgLSAxID8gdmVydGljZXNbMF0gOiB2ZXJ0aWNlc1tpICsgMV07XG4gICAgICAgIGNvbnN0IHdhbGwgPSBuZXcgV2FsbCh2MSwgdjIpO1xuICAgICAgICB3YWxsLm15Q29sb3IgPSBteUNvbG9yO1xuICAgICAgICB3YWxscy5wdXNoKHdhbGwpO1xuICAgICAgfVxuXG4gICAgICB0aGlzLndhbGxzID0gd2FsbHM7XG4gICAgfVxuICB9XG4gIHVwZGF0ZSgpIHtcbiAgICBsZXQgbW92ZTogbnVtYmVyID0gdGhpcy5tb3ZlbWVudFNwZWVkO1xuICAgIGlmICh0aGlzLmNlbnRlci54ICsgbW92ZSA8IDApIHtcbiAgICAgIG1vdmUgKz0gd2lkdGg7XG4gICAgfVxuXG4gICAgdGhpcy5jZW50ZXIueCArPSBtb3ZlO1xuICAgIGZvciAobGV0IHdhbGwgb2YgdGhpcy53YWxscykge1xuICAgICAgd2FsbC50cmFuc2xhdGUoY3JlYXRlVmVjdG9yKG1vdmUsIDApKTtcbiAgICB9XG4gIH1cbiAgZHJhdygpIHtcbiAgICBmb3IgKGxldCB3YWxsIG9mIHRoaXMud2FsbHMpIHtcbiAgICAgIHdhbGwuZHJhdygpO1xuICAgIH1cbiAgICBpZiAodGhpcy5pc0ZpbGxlZFNoYXBlKSB7XG4gICAgICBiZWdpblNoYXBlKCk7XG4gICAgICBmb3IgKGxldCB3YWxsIG9mIHRoaXMud2FsbHMpIHtcbiAgICAgICAgZm9yIChsZXQgcHQgb2YgW3dhbGwuYSwgd2FsbC5iXSkge1xuICAgICAgICAgIHZlcnRleChwdC54LCBwdC55KTtcbiAgICAgICAgfVxuICAgICAgfVxuICAgICAgZW5kU2hhcGUoQ0xPU0UpO1xuICAgIH1cbiAgfVxuXG4gIHN0YXRpYyBjcmVhdGVSYW5kb20oKSB7XG4gICAgY29uc3QgY2VudGVyID0gcmFuZG9tU2NyZWVuUG9zaXRpb24oKTtcbiAgICBjb25zdCBudW1TaWRlcyA9IHJhbmRvbShbMiwgMiwgMiwgMywgNCwgNSwgOF0pO1xuICAgIHJldHVybiBuZXcgU3RydWN0dXJlKGNlbnRlciwgcmFuZG9tKDIwLCByYW5kb20oMTAwLCAyMDApKSwgbnVtU2lkZXMpO1xuICB9XG59XG4iLCJmdW5jdGlvbiByZXBlYXQobnVtOiBudW1iZXIsIGZuOiAoaXg6IG51bWJlcikgPT4gdm9pZCkge1xuICBmb3IgKGxldCBpID0gMDsgaSA8IG51bTsgaSsrKSB7XG4gICAgZm4oaSk7XG4gIH1cbn1cbmZ1bmN0aW9uIHJhbmRvbVNjcmVlblBvc2l0aW9uKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3IocmFuZG9tKHdpZHRoKSwgcmFuZG9tKGhlaWdodCkpO1xufVxuXG5mdW5jdGlvbiByYW5kb21JbnQobWluOiBudW1iZXIsIG1heDogbnVtYmVyKTogbnVtYmVyIHtcbiAgcmV0dXJuIHJvdW5kKHJhbmRvbShtaW4sIG1heCkpO1xufVxuXG5mdW5jdGlvbiB0cmFuc2xhdGVUb1ZlYyhwb3M6IHA1LlZlY3Rvcik6IHZvaWQge1xuICB0cmFuc2xhdGUocG9zLngsIHBvcy55KTtcbn1cblxuZnVuY3Rpb24gY2VudGVyUG9zKCk6IHA1LlZlY3RvciB7XG4gIHJldHVybiBjcmVhdGVWZWN0b3Iod2lkdGggLyAyLCBoZWlnaHQgLyAyKTtcbn1cblxuLy9UYWtlbiBmcm9tIGh0dHBzOi8vZ2l0aHViLmNvbS9ibW9yZW4vcDUuY29sbGlkZTJEXG5mdW5jdGlvbiBjb2xsaWRlTGluZUxpbmUoXG4gIHgxOiBudW1iZXIsXG4gIHkxOiBudW1iZXIsXG4gIHgyOiBudW1iZXIsXG4gIHkyOiBudW1iZXIsXG4gIHgzOiBudW1iZXIsXG4gIHkzOiBudW1iZXIsXG4gIHg0OiBudW1iZXIsXG4gIHk0OiBudW1iZXJcbikge1xuICAvLyBjYWxjdWxhdGUgdGhlIGRpc3RhbmNlIHRvIGludGVyc2VjdGlvbiBwb2ludFxuICBsZXQgdUEgPVxuICAgICgoeDQgLSB4MykgKiAoeTEgLSB5MykgLSAoeTQgLSB5MykgKiAoeDEgLSB4MykpIC9cbiAgICAoKHk0IC0geTMpICogKHgyIC0geDEpIC0gKHg0IC0geDMpICogKHkyIC0geTEpKTtcbiAgbGV0IHVCID1cbiAgICAoKHgyIC0geDEpICogKHkxIC0geTMpIC0gKHkyIC0geTEpICogKHgxIC0geDMpKSAvXG4gICAgKCh5NCAtIHkzKSAqICh4MiAtIHgxKSAtICh4NCAtIHgzKSAqICh5MiAtIHkxKSk7XG5cbiAgLy8gaWYgdUEgYW5kIHVCIGFyZSBiZXR3ZWVuIDAtMSwgbGluZXMgYXJlIGNvbGxpZGluZ1xuICBpZiAodUEgPj0gMCAmJiB1QSA8PSAxICYmIHVCID49IDAgJiYgdUIgPD0gMSkge1xuICAgIC8vIGNhbGMgdGhlIHBvaW50IHdoZXJlIHRoZSBsaW5lcyBtZWV0XG4gICAgbGV0IGludGVyc2VjdGlvblggPSB4MSArIHVBICogKHgyIC0geDEpO1xuICAgIGxldCBpbnRlcnNlY3Rpb25ZID0geTEgKyB1QSAqICh5MiAtIHkxKTtcblxuICAgIHJldHVybiBjcmVhdGVWZWN0b3IoaW50ZXJzZWN0aW9uWCwgaW50ZXJzZWN0aW9uWSk7XG4gIH1cbiAgcmV0dXJuIG51bGw7XG59XG5cbmZ1bmN0aW9uIG1pbkJ5PFQ+KGxpc3Q6IFRbXSwgZm46IChpdGVtOiBUKSA9PiBudW1iZXIpOiBUIHtcbiAgaWYgKGxpc3QubGVuZ3RoIDwgMCkge1xuICAgIHJldHVybiBudWxsO1xuICB9XG4gIGxldCByZWNvcmRJdGVtID0gbGlzdFswXTtcbiAgbGV0IHJlY29yZFdlaWdodCA9IGZuKGxpc3RbMF0pO1xuICBmb3IgKGxldCBpdGVtIG9mIGxpc3QpIHtcbiAgICBjb25zdCB3ZWlnaHQgPSBmbihpdGVtKTtcbiAgICBpZiAod2VpZ2h0ID4gcmVjb3JkV2VpZ2h0KSB7XG4gICAgICByZWNvcmRXZWlnaHQgPSB3ZWlnaHQ7XG4gICAgICByZWNvcmRJdGVtID0gaXRlbTtcbiAgICB9XG4gIH1cbiAgcmV0dXJuIHJlY29yZEl0ZW07XG59XG5cbmZ1bmN0aW9uIGRpc3RyaWJ1dGVVcFRvKHRvdGFsOiBudW1iZXIsIG1heDogbnVtYmVyLCBmbjogKHY6IG51bWJlcikgPT4gdm9pZCkge1xuICByZXBlYXQodG90YWwsIGl4ID0+IHtcbiAgICBjb25zdCB2YWwgPSAoaXggKiBtYXgpIC8gdG90YWw7XG4gICAgZm4odmFsKTtcbiAgfSk7XG59XG4iLCJjbGFzcyBXYWxsIHtcbiAgYTogcDUuVmVjdG9yO1xuICBiOiBwNS5WZWN0b3I7XG5cbiAgbXlDb2xvcjogcDUuQ29sb3I7XG5cbiAgY29uc3RydWN0b3IoYTogcDUuVmVjdG9yLCBiOiBwNS5WZWN0b3IpIHtcbiAgICB0aGlzLmEgPSBhLmNvcHkoKTtcbiAgICB0aGlzLmIgPSBiLmNvcHkoKTtcbiAgICB0aGlzLm15Q29sb3IgPSBjb2xvcigyNDMsIDEzNCwgNDgpO1xuICB9XG4gIGRyYXcoKSB7XG4gICAgc3Ryb2tlKHRoaXMubXlDb2xvcik7XG4gICAgc3Ryb2tlV2VpZ2h0KDQpO1xuICAgIGxpbmUodGhpcy5hLngsIHRoaXMuYS55LCB0aGlzLmIueCwgdGhpcy5iLnkpO1xuXG4gICAgbm9TdHJva2UoKTtcbiAgICBmaWxsKHRoaXMubXlDb2xvcik7XG4gICAgW3RoaXMuYSwgdGhpcy5iXS5mb3JFYWNoKHB0ID0+IHtcbiAgICAgIGNpcmNsZShwdC54LCBwdC55LCA1KTtcbiAgICB9KTtcbiAgfVxuICBtaWRQb2ludCgpOiBwNS5WZWN0b3Ige1xuICAgIHJldHVybiB0aGlzLmEuY29weSgpLmxlcnAodGhpcy5iLCAwLjUpO1xuICB9XG5cbiAgbGVuZ3RoKCk6IG51bWJlciB7XG4gICAgcmV0dXJuIGRpc3QodGhpcy5hLngsIHRoaXMuYS55LCB0aGlzLmIueCwgdGhpcy5iLnkpO1xuICB9XG5cbiAgdHJhbnNsYXRlKG9mZnNldDogcDUuVmVjdG9yKSB7XG4gICAgZm9yIChsZXQgcHQgb2YgW3RoaXMuYSwgdGhpcy5iXSkge1xuICAgICAgcHQueCArPSBvZmZzZXQueDtcbiAgICAgIHB0LnkgKz0gb2Zmc2V0Lnk7XG4gICAgfVxuICB9XG4gIHN0YXRpYyBjcmVhdGVSYW5kb20oKSB7XG4gICAgY29uc3QgcDEgPSByYW5kb21TY3JlZW5Qb3NpdGlvbigpO1xuICAgIGNvbnN0IHAyID0gcDEuY29weSgpLmFkZChwNS5WZWN0b3IucmFuZG9tMkQoKS5tdWx0KHJhbmRvbSg0MCwgNDAwKSkpO1xuICAgIHJldHVybiBuZXcgV2FsbChwMSwgcDIpO1xuICB9XG59XG4iXX0=